(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,4621,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TARGET_URL_HEADER=void 0,n.withMiddleware=function(...e){return t=>e.reduce((e,t)=>e.then(e=>t(e)),Promise.resolve(t))},n.withProxy=function(e){return"undefined"==typeof window?e=>Promise.resolve(e):t=>Promise.resolve(Object.assign(Object.assign({},t),{url:e.targetUrl,headers:Object.assign(Object.assign({},t.headers||{}),{[n.TARGET_URL_HEADER]:t.url})}))},n.TARGET_URL_HEADER="x-fal-target-url"},66522,(e,t,n)=>{"use strict";var i=e.e&&e.e.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function l(e){try{a(i.next(e))}catch(e){o(e)}}function s(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(l,s)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.ValidationError=n.ApiError=void 0,n.defaultResponseHandler=function(e){return i(this,void 0,void 0,function*(){var t;let{status:n,statusText:i}=e,l=null!=(t=e.headers.get("Content-Type"))?t:"";if(!e.ok){if(l.includes("application/json")){let t=yield e.json();throw new(422===n?o:r)({message:t.message||i,status:n,body:t})}throw new r({message:`HTTP ${n}: ${i}`,status:n})}return l.includes("application/json")?e.json():l.includes("text/html")?e.text():l.includes("application/octet-stream")?e.arrayBuffer():e.text()})};class r extends Error{constructor({message:e,status:t,body:n}){super(e),this.name="ApiError",this.status=t,this.body=n}}n.ApiError=r;class o extends r{constructor(e){super(e),this.name="ValidationError"}get fieldErrors(){return"string"==typeof this.body.detail?[{loc:["body"],msg:this.body.detail,type:"value_error"}]:this.body.detail||[]}getFieldErrors(e){return this.fieldErrors.filter(t=>t.loc[t.loc.length-1]===e)}}n.ValidationError=o},43799,(e,t,n)=>{"use strict";let i;var r=e.i(47167);Object.defineProperty(n,"__esModule",{value:!0}),n.credentialsFromEnv=void 0,n.resolveDefaultFetch=s,n.config=function(e){var t;i=Object.assign(Object.assign(Object.assign({},a),e),{fetch:null!=(t=e.fetch)?t:s()}),e.proxyUrl&&(i=Object.assign(Object.assign({},i),{requestMiddleware:(0,o.withMiddleware)((0,o.withProxy)({targetUrl:e.proxyUrl}),i.requestMiddleware)}));let{credentials:n,suppressLocalCredentialsWarning:r}=i,l="function"==typeof n?n():n;"undefined"!=typeof window&&l&&!r&&console.warn("The fal credentials are exposed in the browser's environment. That's not recommended for production use cases.")},n.getConfig=function(){return i||(console.info("Using default configuration for the fal client"),Object.assign(Object.assign({},a),{fetch:s()}))},n.getRestApiUrl=function(){return"https://rest.alpha.fal.ai"};let o=e.r(4621),l=e.r(66522);function s(){if("undefined"==typeof fetch)throw Error("Your environment does not support fetch. Please provide your own fetch implementation.");return fetch}n.credentialsFromEnv=()=>{if(void 0!==r.default&&r.default.env&&(void 0!==r.default.env.FAL_KEY||void 0!==r.default.env.FAL_KEY_ID&&void 0!==r.default.env.FAL_KEY_SECRET))return void 0!==r.default.env.FAL_KEY?r.default.env.FAL_KEY:`${r.default.env.FAL_KEY_ID}:${r.default.env.FAL_KEY_SECRET}`};let a={credentials:n.credentialsFromEnv,suppressLocalCredentialsWarning:!1,requestMiddleware:e=>Promise.resolve(e),responseHandler:l.defaultResponseHandler}},25493,e=>{e.v({name:"@fal-ai/serverless-client",description:"Deprecation note: this library has been deprecated in favor of @fal-ai/client",version:"0.15.0",license:"MIT",repository:{type:"git",url:"https://github.com/fal-ai/fal-js.git",directory:"libs/client"},keywords:["fal","serverless","client","ai","ml"],dependencies:{"@msgpack/msgpack":"^3.0.0-beta2","eventsource-parser":"^1.1.2",robot3:"^0.4.1"},engines:{node:">=18.0.0"},main:"./src/index.js",type:"commonjs"})},47898,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isBrowser=function(){return"undefined"!=typeof window&&void 0!==window.document},n.getUserAgent=function(){if(null!==i)return i;let t=e.r(25493);return i=`${t.name}/${t.version}`};let i=null},81463,(e,t,n)=>{"use strict";var i=e.e&&e.e.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function l(e){try{a(i.next(e))}catch(e){o(e)}}function s(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(l,s)}a((i=i.apply(e,t||[])).next())})},r=e.e&&e.e.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)0>t.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};Object.defineProperty(n,"__esModule",{value:!0}),n.dispatchRequest=function(e,t,n){return i(this,arguments,void 0,function*(e,t,n,i={}){var a;let{credentials:u,requestMiddleware:d,responseHandler:p,fetch:c}=(0,o.getConfig)(),h=(0,l.isBrowser)()?{}:{"User-Agent":(0,l.getUserAgent)()},f="function"==typeof u?u():u,{url:m,headers:g}=yield d({url:t,method:e.toUpperCase()}),y=Object.assign(Object.assign(Object.assign(Object.assign({},f?{Authorization:`Key ${f}`}:{}),{Accept:"application/json","Content-Type":"application/json"}),h),null!=g?g:{}),{responseHandler:v}=i,E=r(i,["responseHandler"]),A=yield c(m,Object.assign(Object.assign(Object.assign(Object.assign({},E),{method:e,headers:Object.assign(Object.assign({},y),null!=(a=E.headers)?a:{})}),!s&&{mode:"cors"}),{body:"get"!==e.toLowerCase()&&n?JSON.stringify(n):void 0}));return yield(null!=v?v:p)(A)})};let o=e.r(43799),l=e.r(47898),s="undefined"!=typeof navigator&&(null==navigator?void 0:navigator.userAgent)==="Cloudflare-Workers"},39750,(e,t,n)=>{"use strict";let i;function r(e){if(e.split("/").length>1)return e;let[,t,n]=/^([0-9]+)-([a-zA-Z0-9-]+)$/.exec(e)||[];if(t&&n)return`${t}/${n}`;throw Error(`Invalid app id: ${e}. Must be in the format <appOwner>/<appId>`)}Object.defineProperty(n,"__esModule",{value:!0}),n.ensureAppIdFormat=r,n.parseAppId=function(e){let t=r(e).split("/");return o.includes(t[0])?{owner:t[1],alias:t[2],path:t.slice(3).join("/")||void 0,namespace:t[0]}:{owner:t[0],alias:t[1],path:t.slice(2).join("/")||void 0}},n.isValidUrl=function(e){try{let{host:t}=new URL(e);return/(fal\.(ai|run))$/.test(t)}catch(e){return!1}},n.throttle=function(e,t,n=!1){let i,r;return(...o)=>{!r&&n?(e(...o),r=Date.now()):(i&&clearTimeout(i),i=setTimeout(()=>{Date.now()-r>=t&&(e(...o),r=Date.now())},t-(Date.now()-r)))}},n.isReact=function(){if(void 0===i){let e=Error().stack;i=!!e&&(e.includes("node_modules/react-dom/")||e.includes("node_modules/next/"))}return i},n.isPlainObject=function(e){return!!e&&Object.getPrototypeOf(e)===Object.prototype};let o=["workflows","comfy"]},32910,(e,t,n)=>{"use strict";var i=e.e&&e.e.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function l(e){try{a(i.next(e))}catch(e){o(e)}}function s(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(l,s)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.storageImpl=void 0;let r=e.r(43799),o=e.r(81463),l=e.r(39750);n.storageImpl={upload:e=>i(void 0,void 0,void 0,function*(){let{fetch:t}=(0,r.getConfig)(),{upload_url:n,file_url:l}=yield function(e){return i(this,void 0,void 0,function*(){let t=e.type||"application/octet-stream",n=e.name||`${Date.now()}.${function(e){var t;let[n,i]=e.split("/");return null!=(t=i.split(/[-;]/)[0])?t:"bin"}(t)}`;return yield(0,o.dispatchRequest)("POST",`${(0,r.getRestApiUrl)()}/storage/upload/initiate`,{content_type:t,file_name:n})})}(e),s=yield t(n,{method:"PUT",body:e,headers:{"Content-Type":e.type||"application/octet-stream"}}),{responseHandler:a}=(0,r.getConfig)();return yield a(s),l}),transformInput:e=>i(void 0,void 0,void 0,function*(){if(Array.isArray(e))return Promise.all(e.map(e=>n.storageImpl.transformInput(e)));if(e instanceof Blob)return yield n.storageImpl.upload(e);if((0,l.isPlainObject)(e)){let t=Object.entries(e).map(e=>i(void 0,[e],void 0,function*([e,t]){return[e,(yield n.storageImpl.transformInput(t))]}));return Object.fromEntries((yield Promise.all(t)))}return e})}},11584,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});let i=[239,187,191];n.createParser=function(e){let t,n,r,o,l,s,a;return u(),{feed:function(u){var d;n=n?n+u:u,t&&(d=n,i.every((e,t)=>d.charCodeAt(t)===e))&&(n=n.slice(i.length)),t=!1;let p=n.length,c=0,h=!1;for(;c<p;){let t;h&&("\n"===n[c]&&++c,h=!1);let i=-1,u=o;for(let e=r;i<0&&e<p;++e)":"===(t=n[e])&&u<0?u=e-c:"\r"===t?(h=!0,i=e-c):"\n"===t&&(i=e-c);if(i<0){r=p-c,o=u;break}r=0,o=-1,function(t,n,i,r){if(0===r){a.length>0&&(e({type:"event",id:l,event:s||void 0,data:a.slice(0,-1)}),a="",l=void 0),s=void 0;return}let o=i<0,u=t.slice(n,n+(o?r:i)),d=0;d=o?r:" "===t[n+i+1]?i+2:i+1;let p=n+d,c=r-d,h=t.slice(p,p+c).toString();if("data"===u)a+=h?"".concat(h,"\n"):"\n";else if("event"===u)s=h;else if("id"!==u||h.includes("\0")){if("retry"===u){let t=parseInt(h,10);Number.isNaN(t)||e({type:"reconnect-interval",value:t})}}else l=h}(n,c,u,i),c+=i+1}c===p?n="":c>0&&(n=n.slice(c))},reset:u};function u(){t=!0,n="",r=0,o=-1,l=void 0,s=void 0,a=""}}},96643,(e,t,n)=>{"use strict";var i=e.e&&e.e.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function l(e){try{a(i.next(e))}catch(e){o(e)}}function s(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(l,s)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.TOKEN_EXPIRATION_SECONDS=void 0,n.getTemporaryAuthToken=function(e){return i(this,void 0,void 0,function*(){let t=(0,l.parseAppId)(e),i=yield(0,o.dispatchRequest)("POST",`${(0,r.getRestApiUrl)()}/tokens/`,{allowed_apps:[t.alias],token_expiration:n.TOKEN_EXPIRATION_SECONDS});return"string"!=typeof i&&i.detail?i.detail:i})};let r=e.r(43799),o=e.r(81463),l=e.r(39750);n.TOKEN_EXPIRATION_SECONDS=120},17230,(e,t,n)=>{"use strict";var i=e.e&&e.e.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function l(e){try{a(i.next(e))}catch(e){o(e)}}function s(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(l,s)}a((i=i.apply(e,t||[])).next())})},r=e.e&&e.e.__await||function(e){return this instanceof r?(this.v=e,this):new r(e)},o=e.e&&e.e.__asyncGenerator||function(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var i,o=n.apply(e,t||[]),l=[];return i={},s("next"),s("throw"),s("return",function(e){return function(t){return Promise.resolve(t).then(e,d)}}),i[Symbol.asyncIterator]=function(){return this},i;function s(e,t){o[e]&&(i[e]=function(t){return new Promise(function(n,i){l.push([e,t,n,i])>1||a(e,t)})},t&&(i[e]=t(i[e])))}function a(e,t){try{var n;(n=o[e](t)).value instanceof r?Promise.resolve(n.value.v).then(u,d):p(l[0][2],n)}catch(e){p(l[0][3],e)}}function u(e){a("next",e)}function d(e){a("throw",e)}function p(e,t){e(t),l.shift(),l.length&&a(l[0][0],l[0][1])}};Object.defineProperty(n,"__esModule",{value:!0}),n.FalStream=void 0,n.stream=function(e,t){return i(this,void 0,void 0,function*(){let n=t.input&&!1!==t.autoUpload?yield c.storageImpl.transformInput(t.input):t.input;return new f(e,Object.assign(Object.assign({},t),{input:n}))})};let l=e.r(11584),s=e.r(96643),a=e.r(43799),u=e.r(704),d=e.r(81463),p=e.r(66522),c=e.r(32910),h="text/event-stream";class f{constructor(e,t){var n;this.listeners=new Map,this.buffer=[],this.currentData=void 0,this.lastEventTimestamp=0,this.streamClosed=!1,this.abortController=new AbortController,this.start=()=>i(this,void 0,void 0,function*(){var e,t;let{endpointId:n,options:i}=this,{input:r,method:o="post",connectionMode:l="server"}=i;try{if("client"===l){let t=yield(0,s.getTemporaryAuthToken)(n),{fetch:l}=(0,a.getConfig)(),u=new URL(this.url);u.searchParams.set("fal_jwt_token",t);let d=yield l(u.toString(),{method:o.toUpperCase(),headers:{accept:null!=(e=i.accept)?e:h,"content-type":"application/json"},body:r&&"get"!==o?JSON.stringify(r):void 0,signal:this.abortController.signal});return yield this.handleResponse(d)}return yield(0,d.dispatchRequest)(o.toUpperCase(),this.url,r,{headers:{accept:null!=(t=i.accept)?t:h},responseHandler:this.handleResponse,signal:this.abortController.signal})}catch(e){this.handleError(e)}}),this.handleResponse=e=>i(this,void 0,void 0,function*(){var t;if(!e.ok){try{yield(0,p.defaultResponseHandler)(e)}catch(e){this.emit("error",e)}return}let n=e.body;if(!n)return void this.emit("error",new p.ApiError({message:"Response body is empty.",status:400,body:void 0}));if(!e.headers.get("content-type").startsWith(h)){let e=n.getReader(),t=()=>{e.read().then(({done:e,value:n})=>{e?this.emit("done",this.currentData):(this.currentData=n,this.emit("data",n),t())})};t();return}let r=new TextDecoder("utf-8"),o=e.body.getReader(),s=(0,l.createParser)(e=>{if("event"===e.type){let t=e.data;try{let e=JSON.parse(t);this.buffer.push(e),this.currentData=e,this.emit("data",e),this.emit("message",e)}catch(e){this.emit("error",e)}}}),a=null!=(t=this.options.timeout)?t:15e3,u=()=>i(this,void 0,void 0,function*(){let{value:e,done:t}=yield o.read();this.lastEventTimestamp=Date.now(),s.feed(r.decode(e)),Date.now()-this.lastEventTimestamp>a&&this.emit("error",new p.ApiError({message:`Event stream timed out after ${(a/1e3).toFixed(0)} seconds with no messages.`,status:408})),t?this.emit("done",this.currentData):u().catch(this.handleError)});u().catch(this.handleError)}),this.handleError=e=>{var t;let n=e instanceof p.ApiError?e:new p.ApiError({message:null!=(t=e.message)?t:"An unknown error occurred",status:500});this.emit("error",n)},this.on=(e,t)=>{var n;this.listeners.has(e)||this.listeners.set(e,[]),null==(n=this.listeners.get(e))||n.push(t)},this.emit=(e,t)=>{for(let n of this.listeners.get(e)||[])n(t)},this.done=()=>i(this,void 0,void 0,function*(){return this.donePromise}),this.abort=()=>{this.abortController.abort()},this.endpointId=e,this.url=null!=(n=t.url)?n:(0,u.buildUrl)(e,{path:"/stream",query:t.queryParams}),this.options=t,this.donePromise=new Promise((e,t)=>{this.streamClosed&&t(new p.ApiError({message:"Streaming connection is already closed.",status:400,body:void 0})),this.on("done",t=>{this.streamClosed=!0,e(t)}),this.on("error",e=>{this.streamClosed=!0,t(e)})}),this.start().catch(this.handleError)}[Symbol.asyncIterator](){return o(this,arguments,function*(){let e=!0,t=()=>e=!1;for(this.on("error",t),this.on("done",t);e;){let e=this.buffer.shift();e&&(yield yield r(e)),yield r(new Promise(e=>setTimeout(e,16)))}})}}n.FalStream=f},704,(e,t,n)=>{"use strict";var i=e.e&&e.e.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function l(e){try{a(i.next(e))}catch(e){o(e)}}function s(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(l,s)}a((i=i.apply(e,t||[])).next())})},r=e.e&&e.e.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)0>t.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};Object.defineProperty(n,"__esModule",{value:!0}),n.queue=void 0,n.buildUrl=u,n.send=d,n.run=function(e){return i(this,arguments,void 0,function*(e,t={}){return d(e,t)})},n.subscribe=function(e){return i(this,arguments,void 0,function*(e,t={}){let{request_id:i}=yield n.queue.submit(e,t);return t.onEnqueue&&t.onEnqueue(i),yield n.queue.subscribeToStatus(e,Object.assign({requestId:i},t)),n.queue.result(e,{requestId:i})})};let o=e.r(81463),l=e.r(32910),s=e.r(17230),a=e.r(39750);function u(e,t={}){var n,i;let r=(null!=(n=t.method)?n:"post").toLowerCase(),o=(null!=(i=t.path)?i:"").replace(/^\//,"").replace(/\/{2,}/,"/"),l=t.input,s=Object.assign(Object.assign({},t.query||{}),"get"===r?l:{}),d=Object.keys(s).length>0?`?${new URLSearchParams(s).toString()}`:"";if((0,a.isValidUrl)(e)){let t=e.endsWith("/")?e:`${e}/`;return`${t}${o}${d}`}let p=(0,a.ensureAppIdFormat)(e),c=t.subdomain?`${t.subdomain}.`:"",h=`https://${c}fal.run/${p}/${o}`;return`${h.replace(/\/$/,"")}${d}`}function d(e){return i(this,arguments,void 0,function*(e,t={}){var n;let i=t.input&&!1!==t.autoUpload?yield l.storageImpl.transformInput(t.input):t.input;return(0,o.dispatchRequest)(null!=(n=t.method)?n:"post",u(e,t),i)})}n.queue={submit(e,t){return i(this,void 0,void 0,function*(){let{webhookUrl:n,path:i=""}=t;return d(e,Object.assign(Object.assign({},r(t,["webhookUrl","path"])),{subdomain:"queue",method:"post",path:i,query:n?{fal_webhook:n}:void 0}))})},status(e,t){return i(this,arguments,void 0,function*(e,{requestId:t,logs:n=!1}){let i=(0,a.parseAppId)(e),r=i.namespace?`${i.namespace}/`:"";return d(`${r}${i.owner}/${i.alias}`,{subdomain:"queue",method:"get",path:`/requests/${t}/status`,input:{logs:n?"1":"0"}})})},streamStatus(e,t){return i(this,arguments,void 0,function*(e,{requestId:t,logs:n=!1,connectionMode:i}){let r=(0,a.parseAppId)(e),o=r.namespace?`${r.namespace}/`:"",l={logs:n?"1":"0"},d=u(`${o}${r.owner}/${r.alias}`,{subdomain:"queue",path:`/requests/${t}/status/stream`,query:l});return new s.FalStream(e,{url:d,method:"get",connectionMode:i,queryParams:l})})},subscribeToStatus(e,t){return i(this,void 0,void 0,function*(){let r,o=t.requestId,l=t.timeout,s=()=>{};if("streaming"===t.mode){let i=yield n.queue.streamStatus(e,{requestId:o,logs:t.logs,connectionMode:"connectionMode"in t?t.connectionMode:void 0}),a=[];l&&(r=setTimeout(()=>{throw i.abort(),n.queue.cancel(e,{requestId:o}).catch(s),Error(`Client timed out waiting for the request to complete after ${l}ms`)},l)),i.on("data",e=>{t.onQueueUpdate&&("logs"in e&&Array.isArray(e.logs)&&e.logs.length>0&&a.push(...e.logs),t.onQueueUpdate("logs"in e?Object.assign(Object.assign({},e),{logs:a}):e))});let u=yield i.done();return r&&clearTimeout(r),u}return new Promise((a,u)=>{var d;let p,c="pollInterval"in t&&"number"==typeof t.pollInterval&&null!=(d=t.pollInterval)?d:500,h=()=>{r&&clearTimeout(r),p&&clearTimeout(p)};l&&(r=setTimeout(()=>{h(),n.queue.cancel(e,{requestId:o}).catch(s),u(Error(`Client timed out waiting for the request to complete after ${l}ms`))},l));let f=()=>i(this,void 0,void 0,function*(){var i;try{let r=yield n.queue.status(e,{requestId:o,logs:null!=(i=t.logs)&&i});if(t.onQueueUpdate&&t.onQueueUpdate(r),"COMPLETED"===r.status){h(),a(r);return}p=setTimeout(f,c)}catch(e){h(),u(e)}});f().catch(u)})})},result(e,t){return i(this,arguments,void 0,function*(e,{requestId:t}){let n=(0,a.parseAppId)(e),i=n.namespace?`${n.namespace}/`:"";return d(`${i}${n.owner}/${n.alias}`,{subdomain:"queue",method:"get",path:`/requests/${t}`})})},cancel(e,t){return i(this,arguments,void 0,function*(e,{requestId:t}){let n=(0,a.parseAppId)(e),i=n.namespace?`${n.namespace}/`:"";yield d(`${i}${n.owner}/${n.alias}`,{subdomain:"queue",method:"put",path:`/requests/${t}/cancel`})})}}},91714,e=>{"use strict";let t=new TextEncoder;function n(e,t,n){let i=t,r=i+n,o=[],l="";for(;i<r;){let t=e[i++];if((128&t)==0)o.push(t);else if((224&t)==192){let n=63&e[i++];o.push((31&t)<<6|n)}else if((240&t)==224){let n=63&e[i++],r=63&e[i++];o.push((31&t)<<12|n<<6|r)}else if((248&t)==240){let n=(7&t)<<18|(63&e[i++])<<12|(63&e[i++])<<6|63&e[i++];n>65535&&(n-=65536,o.push(n>>>10&1023|55296),n=56320|1023&n),o.push(n)}else o.push(t);o.length>=4096&&(l+=String.fromCharCode(...o),o.length=0)}return o.length>0&&(l+=String.fromCharCode(...o)),l}let i=new TextDecoder;class r{constructor(e,t){this.type=e,this.data=t}}class o extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Object.create(o.prototype)),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:o.name})}}function l(e,t,n){let i=Math.floor(n/0x100000000);e.setUint32(t,i),e.setUint32(t+4,n)}function s(e,t){return 0x100000000*e.getInt32(t)+e.getUint32(t+4)}function a({sec:e,nsec:t}){if(e>=0&&t>=0&&e<=0x3ffffffff)if(0===t&&e<=0xffffffff){let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e),t}else{let n=e/0x100000000,i=new Uint8Array(8),r=new DataView(i.buffer);return r.setUint32(0,t<<2|3&n),r.setUint32(4,0|e),i}{let n=new Uint8Array(12),i=new DataView(n.buffer);return i.setUint32(0,t),l(i,4,e),n}}function u(e){let t=e.getTime(),n=Math.floor(t/1e3),i=(t-1e3*n)*1e6,r=Math.floor(i/1e9);return{sec:n+r,nsec:i-1e9*r}}function d(e){return e instanceof Date?a(u(e)):null}function p(e){let t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:return{sec:t.getUint32(0),nsec:0};case 8:{let e=t.getUint32(0);return{sec:(3&e)*0x100000000+t.getUint32(4),nsec:e>>>2}}case 12:return{sec:s(t,4),nsec:t.getUint32(0)};default:throw new o(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${e.length}`)}}function c(e){let t=p(e);return new Date(1e3*t.sec+t.nsec/1e6)}let h={type:-1,encode:d,decode:c};class f{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(h)}register({type:e,encode:t,decode:n}){if(e>=0)this.encoders[e]=t,this.decoders[e]=n;else{let i=-1-e;this.builtInEncoders[i]=t,this.builtInDecoders[i]=n}}tryToEncode(e,t){for(let n=0;n<this.builtInEncoders.length;n++){let i=this.builtInEncoders[n];if(null!=i){let o=i(e,t);if(null!=o)return new r(-1-n,o)}}for(let n=0;n<this.encoders.length;n++){let i=this.encoders[n];if(null!=i){let o=i(e,t);if(null!=o)return new r(n,o)}}return e instanceof r?e:null}decode(e,t,n){let i=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return i?i(e,t,n):new r(t,e)}}function m(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer?new Uint8Array(e):Uint8Array.from(e)}f.defaultCodec=new f;class g{constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??f.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??100,this.initialBufferSize=e?.initialBufferSize??2048,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new g({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,t){if(t>this.maxDepth)throw Error(`Too deep objects in depth ${t}`);null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.useBigInt64&&"bigint"==typeof e?this.encodeBigInt64(e):this.encodeObject(e,t)}ensureBufferSizeToWrite(e){let t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)}resizeBuffer(e){let t=new ArrayBuffer(e),n=new Uint8Array(t),i=new DataView(t);n.set(this.bytes),this.view=i,this.bytes=n}encodeNil(){this.writeU8(192)}encodeBoolean(e){!1===e?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<0x100000000?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-0x80000000?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<0x100000000)this.writeU8(219),this.writeU32(e);else throw Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){let n=function(e){let t=e.length,n=0,i=0;for(;i<t;){let r=e.charCodeAt(i++);if((0xffffff80&r)==0){n++;continue}if((0xfffff800&r)==0)n+=2;else{if(r>=55296&&r<=56319&&i<t){let t=e.charCodeAt(i);(64512&t)==56320&&(++i,r=((1023&r)<<10)+(1023&t)+65536)}(0xffff0000&r)==0?n+=3:n+=4}}return n}(e);this.ensureBufferSizeToWrite(5+n),this.writeStringHeader(n),function(e,n,i){if(e.length>50)t.encodeInto(e,n.subarray(i));else!function(e,t,n){let i=e.length,r=n,o=0;for(;o<i;){let n=e.charCodeAt(o++);if((0xffffff80&n)==0){t[r++]=n;continue}if((0xfffff800&n)==0)t[r++]=n>>6&31|192;else{if(n>=55296&&n<=56319&&o<i){let t=e.charCodeAt(o);(64512&t)==56320&&(++o,n=((1023&n)<<10)+(1023&t)+65536)}(0xffff0000&n)==0?t[r++]=n>>12&15|224:(t[r++]=n>>18&7|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128}t[r++]=63&n|128}}(e,n,i)}(e,this.bytes,this.pos),this.pos+=n}encodeObject(e,t){let n=this.extensionCodec.tryToEncode(e,this.context);if(null!=n)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if("object"==typeof e)this.encodeMap(e,t);else throw Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){let t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<0x100000000)this.writeU8(198),this.writeU32(t);else throw Error(`Too large binary: ${t}`);let n=m(e);this.writeU8a(n)}encodeArray(e,t){let n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<0x100000000)this.writeU8(221),this.writeU32(n);else throw Error(`Too large array: ${n}`);for(let n of e)this.doEncode(n,t+1)}countWithoutUndefined(e,t){let n=0;for(let i of t)void 0!==e[i]&&n++;return n}encodeMap(e,t){let n=Object.keys(e);this.sortKeys&&n.sort();let i=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<0x100000000)this.writeU8(223),this.writeU32(i);else throw Error(`Too large map object: ${i}`);for(let i of n){let n=e[i];this.ignoreUndefined&&void 0===n||(this.encodeString(i),this.doEncode(n,t+1))}}encodeExtension(e){if("function"==typeof e.data){let t=e.data(this.pos+6),n=t.length;if(n>=0x100000000)throw Error(`Too large extension object: ${n}`);this.writeU8(201),this.writeU32(n),this.writeI8(e.type),this.writeU8a(t);return}let t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<0x100000000)this.writeU8(201),this.writeU32(t);else throw Error(`Too large extension object: ${t}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){let t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){var t,n;this.ensureBufferSizeToWrite(8),t=this.view,n=this.pos,t.setUint32(n,e/0x100000000),t.setUint32(n+4,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),l(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}}function y(e,t){return new g(t).encodeSharedRef(e)}function v(e){return`${e<0?"-":""}0x${Math.abs(e).toString(16).padStart(2,"0")}`}let E="array",A="map_key",I="map_value",T=e=>{if("string"==typeof e||"number"==typeof e)return e;throw new o("The type of key must be string or number but "+typeof e)};class _{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){let t=this.getUninitializedStateFromPool();t.type=E,t.position=0,t.size=e,t.array=Array(e)}pushMapState(e){let t=this.getUninitializedStateFromPool();t.type=A,t.readCount=0,t.size=e,t.map={}}getUninitializedStateFromPool(){return this.stackHeadPosition++,this.stackHeadPosition===this.stack.length&&this.stack.push({type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null}),this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw Error("Invalid stack state. Released state is not on top of the stack.");e.type===E&&(e.size=0,e.array=void 0,e.position=0,e.type=void 0),(e.type===A||e.type===I)&&(e.size=0,e.map=void 0,e.readCount=0,e.type=void 0),this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}let b=new DataView(new ArrayBuffer(0)),O=new Uint8Array(b.buffer);try{b.getInt8(0)}catch(e){if(!(e instanceof RangeError))throw Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}let C=RangeError("Insufficient data"),S=new class{constructor(e=16,t=16){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=t,this.caches=[];for(let e=0;e<this.maxKeyLength;e++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,t,n){let i=this.caches[n-1];e:for(let r of i){let i=r.bytes;for(let r=0;r<n;r++)if(i[r]!==e[t+r])continue e;return r.str}return null}store(e,t){let n=this.caches[e.length-1],i={bytes:e,str:t};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=i:n.push(i)}decode(e,t,i){let r=this.find(e,t,i);if(null!=r)return this.hit++,r;this.miss++;let o=n(e,t,i),l=Uint8Array.prototype.slice.call(e,t,t+i);return this.store(l,o),o}};class w{constructor(e){this.totalPos=0,this.pos=0,this.view=b,this.bytes=O,this.headByte=-1,this.stack=new _,this.entered=!1,this.extensionCodec=e?.extensionCodec??f.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??0xffffffff,this.maxBinLength=e?.maxBinLength??0xffffffff,this.maxArrayLength=e?.maxArrayLength??0xffffffff,this.maxMapLength=e?.maxMapLength??0xffffffff,this.maxExtLength=e?.maxExtLength??0xffffffff,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:S,this.mapKeyConverter=e?.mapKeyConverter??T}clone(){return new w({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=-1,this.stack.reset()}setBuffer(e){let t=m(e);this.bytes=t,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.pos=0}appendBuffer(e){if(-1!==this.headByte||this.hasRemaining(1)){let t=this.bytes.subarray(this.pos),n=m(e),i=new Uint8Array(t.length+n.length);i.set(t),i.set(n,t.length),this.setBuffer(i)}else this.setBuffer(e)}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){let{view:t,pos:n}=this;return RangeError(`Extra ${t.byteLength-n} of ${t.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);let t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){let t=this.clone();yield*t.decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{let t;this.entered=!0;let n=!1;for await(let i of e){if(n)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(i);try{t=this.doDecodeSync(),n=!0}catch(e){if(!(e instanceof RangeError))throw e}this.totalPos+=this.pos}if(n){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return t}let{headByte:i,pos:r,totalPos:o}=this;throw RangeError(`Insufficient data in parsing ${v(i)} at ${o} (${r} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async *decodeMultiAsync(e,t){if(this.entered){let n=this.clone();yield*n.decodeMultiAsync(e,t);return}try{this.entered=!0;let n=t,i=-1;for await(let r of e){if(t&&0===i)throw this.createExtraByteError(this.totalPos);this.appendBuffer(r),n&&(i=this.readArraySize(),n=!1,this.complete());try{for(;yield this.doDecodeSync(),0!=--i;);}catch(e){if(!(e instanceof RangeError))throw e}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){t:for(;;){let e,t=this.readHeadByte();if(t>=224)e=t-256;else if(t<192)if(t<128)e=t;else if(t<144){let n=t-128;if(0!==n){this.pushMapState(n),this.complete();continue}e={}}else if(t<160){let n=t-144;if(0!==n){this.pushArrayState(n),this.complete();continue}e=[]}else{let n=t-160;e=this.decodeString(n,0)}else if(192===t)e=null;else if(194===t)e=!1;else if(195===t)e=!0;else if(202===t)e=this.readF32();else if(203===t)e=this.readF64();else if(204===t)e=this.readU8();else if(205===t)e=this.readU16();else if(206===t)e=this.readU32();else if(207===t)e=this.useBigInt64?this.readU64AsBigInt():this.readU64();else if(208===t)e=this.readI8();else if(209===t)e=this.readI16();else if(210===t)e=this.readI32();else if(211===t)e=this.useBigInt64?this.readI64AsBigInt():this.readI64();else if(217===t){let t=this.lookU8();e=this.decodeString(t,1)}else if(218===t){let t=this.lookU16();e=this.decodeString(t,2)}else if(219===t){let t=this.lookU32();e=this.decodeString(t,4)}else if(220===t){let t=this.readU16();if(0!==t){this.pushArrayState(t),this.complete();continue}e=[]}else if(221===t){let t=this.readU32();if(0!==t){this.pushArrayState(t),this.complete();continue}e=[]}else if(222===t){let t=this.readU16();if(0!==t){this.pushMapState(t),this.complete();continue}e={}}else if(223===t){let t=this.readU32();if(0!==t){this.pushMapState(t),this.complete();continue}e={}}else if(196===t){let t=this.lookU8();e=this.decodeBinary(t,1)}else if(197===t){let t=this.lookU16();e=this.decodeBinary(t,2)}else if(198===t){let t=this.lookU32();e=this.decodeBinary(t,4)}else if(212===t)e=this.decodeExtension(1,0);else if(213===t)e=this.decodeExtension(2,0);else if(214===t)e=this.decodeExtension(4,0);else if(215===t)e=this.decodeExtension(8,0);else if(216===t)e=this.decodeExtension(16,0);else if(199===t){let t=this.lookU8();e=this.decodeExtension(t,1)}else if(200===t){let t=this.lookU16();e=this.decodeExtension(t,2)}else if(201===t){let t=this.lookU32();e=this.decodeExtension(t,4)}else throw new o(`Unrecognized type byte: ${v(t)}`);this.complete();let n=this.stack;for(;n.length>0;){let t=n.top();if(t.type===E)if(t.array[t.position]=e,t.position++,t.position===t.size)e=t.array,n.release(t);else continue t;else if(t.type===A){if("__proto__"===e)throw new o("The key __proto__ is not allowed");t.key=this.mapKeyConverter(e),t.type=I;continue t}else if(t.map[t.key]=e,t.readCount++,t.readCount===t.size)e=t.map,n.release(t);else{t.key=null,t.type=A;continue t}}return e}}readHeadByte(){return -1===this.headByte&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=-1}readArraySize(){let e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new o(`Unrecognized array type byte: ${v(e)}`)}}pushMapState(e){if(e>this.maxMapLength)throw new o(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new o(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,t){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,t):this.decodeBinary(e,t)}decodeUtf8String(e,t){let r;if(e>this.maxStrLength)throw new o(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+t+e)throw C;let l=this.pos+t;return r=this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?this.keyDecoder.decode(this.bytes,l,e):function(e,t,r){let o;if(!(r>200))return n(e,t,r);return o=e.subarray(t,t+r),i.decode(o)}(this.bytes,l,e),this.pos+=t+e,r}stateIsMapKey(){return this.stack.length>0&&this.stack.top().type===A}decodeBinary(e,t){if(e>this.maxBinLength)throw new o(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+t))throw C;let n=this.pos+t,i=this.bytes.subarray(n,n+e);return this.pos+=t+e,i}decodeExtension(e,t){if(e>this.maxExtLength)throw new o(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);let n=this.view.getInt8(this.pos+t),i=this.decodeBinary(e,t+1);return this.extensionCodec.decode(i,n,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){let e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){let e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){let e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){let e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){let e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){let e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){var e,t;let n=(e=this.view,t=this.pos,0x100000000*e.getUint32(t)+e.getUint32(t+4));return this.pos+=8,n}readI64(){let e=s(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){let e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){let e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){let e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){let e=this.view.getFloat64(this.pos);return this.pos+=8,e}}function R(e,t){return new w(t).decode(e)}function P(e,t){return new w(t).decodeMulti(e)}async function*N(e){let t=e.getReader();try{for(;;){let{done:e,value:n}=await t.read();if(e)return;yield n}}finally{t.releaseLock()}}function x(e){return null!=e[Symbol.asyncIterator]?e:N(e)}async function U(e,t){let n=x(e);return new w(t).decodeAsync(n)}function M(e,t){let n=x(e);return new w(t).decodeArrayStream(n)}function D(e,t){let n=x(e);return new w(t).decodeStream(n)}e.s([],88333),e.i(88333),e.s(["DecodeError",()=>o,"Decoder",()=>w,"EXT_TIMESTAMP",0,-1,"Encoder",()=>g,"ExtData",()=>r,"ExtensionCodec",()=>f,"decode",()=>R,"decodeArrayStream",()=>M,"decodeAsync",()=>U,"decodeMulti",()=>P,"decodeMultiStream",()=>D,"decodeTimestampExtension",()=>c,"decodeTimestampToTimeSpec",()=>p,"encode",()=>y,"encodeDateToTimeSpec",()=>u,"encodeTimeSpecToTimestamp",()=>a,"encodeTimestampExtension",()=>d],91714)},69575,(e,t,n)=>{"use strict";function i(e){return{enumerable:!0,value:e}}function r(e){return{enumerable:!0,writable:!0,value:e}}Object.defineProperty(n,"__esModule",{value:!0});let o={},l=()=>!0,s=()=>({}),a=e=>e,u=(e,t,n,i)=>e.apply(n,i)&&t.apply(n,i),d=(e,t,n,[i,r])=>t.call(n,e.call(n,i,r),r),p=(e,t)=>Object.freeze(Object.create(e,t));function c(e,t,n){return e.reduce((e,t)=>function(...i){return n(e,t,this,i)},t)}function h(e){return p(this,{fn:i(e)})}let f={},m=h.bind(f),g={},y=h.bind(g);function v(e,t){return t.filter(t=>e.isPrototypeOf(t))}function E(e,t,...n){let r=c(v(g,n).map(e=>e.fn),l,u),o=c(v(f,n).map(e=>e.fn),a,d);return p(this,{from:i(e),to:i(t),guards:i(r),reducers:i(o)})}let A={},I={},T=E.bind(A),_=E.bind(I,null);function b(e,t,n){return P(t,e,n,this.immediates)||e}function O(e){let t=new Map;for(let n of e)t.has(n.from)||t.set(n.from,[]),t.get(n.from).push(n);return t}let C={enter:a},S={enter(e,t,n){let r=this.fn.call(t,t.context,n);return R.isPrototypeOf(r)?p(w,{machine:i(r),transitions:i(this.transitions)}).enter(e,t,n):(r.then(e=>t.send({type:"done",data:e})).catch(e=>t.send({type:"error",error:e})),e)}},w={enter(e,t,n){if(t.child=x(this.machine,e=>{t.onChange(e),t.child==e&&e.machine.state.value.final&&(delete t.child,t.send({type:"done",data:e.context}))},t.context,n),t.child.machine.state.value.final){let n=t.child.context;return delete t.child,P(t,e,{type:"done",data:n},this.transitions.get("done"))}return e}},R={get state(){return{name:this.current,value:this.states[this.current]}}};function P(e,t,n,r){let{context:l}=e;for(let{to:s,guards:a,reducers:u}of r)if(a(l,n)){e.context=u.call(e,l,n);let r=t.original||t,a=p(r,{current:i(s),original:{value:r}});return o._onEnter&&o._onEnter(t,s,e.context,l,n),a.state.value.enter(a,e,n)}}let N={send(e){this.machine=function(e,t){let n=t.type||t,{machine:i}=e,{value:r,name:l}=i.state;return r.transitions.has(n)?P(e,i,t,r.transitions.get(n))||i:(o._send&&o._send(n,l),i)}(this,e),this.onChange(this)}};function x(e,t,n,o){let l=Object.create(N,{machine:r(e),context:r(e.context(n,o)),onChange:i(t)});return l.send=l.send.bind(l),l.machine=l.machine.state.value.enter(l.machine,l,o),l}n.action=e=>m((t,n)=>!!~e(t,n)&&t),n.createMachine=function(e,t,n=s){return"string"!=typeof e&&(n=t||s,e=Object.keys(t=e)[0]),o._create&&o._create(e,t),p(R,{context:i(n),current:i(e),states:i(t)})},n.d=o,n.guard=y,n.immediate=_,n.interpret=x,n.invoke=function(e,...t){let n=i(O(t));return R.isPrototypeOf(e)?p(w,{machine:i(e),transitions:n}):p(S,{fn:i(e),transitions:n})},n.reduce=m,n.state=function(...e){let t=v(A,e),n=v(I,e),r={final:i(0===e.length),transitions:i(O(t))};return n.length&&(r.immediates=i(n),r.enter=i(b)),p(C,r)},n.transition=T},68959,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.realtimeImpl=void 0;let i=e.r(91714),r=e.r(69575),o=e.r(96643),l=e.r(66522),s=e.r(47898),a=e.r(39750);function u(e,t){return Object.assign(Object.assign({},e),{enqueuedMessage:t.message})}function d(e){return e.websocket&&e.websocket.readyState===WebSocket.OPEN&&e.websocket.close(),Object.assign(Object.assign({},e),{websocket:void 0})}function p(e){return Object.assign(Object.assign({},e),{token:void 0})}let c=(0,r.createMachine)("idle",{idle:(0,r.state)((0,r.transition)("send","connecting",(0,r.reduce)(u)),(0,r.transition)("expireToken","idle",(0,r.reduce)(p)),(0,r.transition)("close","idle",(0,r.reduce)(d))),connecting:(0,r.state)((0,r.transition)("connecting","connecting"),(0,r.transition)("connected","active",(0,r.reduce)(function(e,t){return Object.assign(Object.assign({},e),{websocket:t.websocket})})),(0,r.transition)("connectionClosed","idle",(0,r.reduce)(d)),(0,r.transition)("send","connecting",(0,r.reduce)(u)),(0,r.transition)("close","idle",(0,r.reduce)(d)),(0,r.immediate)("authRequired",(0,r.guard)(function(e){return void 0===e.token}))),authRequired:(0,r.state)((0,r.transition)("initiateAuth","authInProgress"),(0,r.transition)("send","authRequired",(0,r.reduce)(u)),(0,r.transition)("close","idle",(0,r.reduce)(d))),authInProgress:(0,r.state)((0,r.transition)("authenticated","connecting",(0,r.reduce)(function(e,t){return Object.assign(Object.assign({},e),{token:t.token})})),(0,r.transition)("unauthorized","idle",(0,r.reduce)(p),(0,r.reduce)(d)),(0,r.transition)("send","authInProgress",(0,r.reduce)(u)),(0,r.transition)("close","idle",(0,r.reduce)(d))),active:(0,r.state)((0,r.transition)("send","active",(0,r.reduce)(function(e,t){return e.websocket&&e.websocket.readyState===WebSocket.OPEN?(t.message instanceof Uint8Array?e.websocket.send(t.message):e.websocket.send((0,i.encode)(t.message)),Object.assign(Object.assign({},e),{enqueuedMessage:void 0})):Object.assign(Object.assign({},e),{enqueuedMessage:t.message})})),(0,r.transition)("unauthorized","idle",(0,r.reduce)(p)),(0,r.transition)("connectionClosed","idle",(0,r.reduce)(d)),(0,r.transition)("close","idle",(0,r.reduce)(d))),failed:(0,r.state)((0,r.transition)("send","failed"),(0,r.transition)("close","idle",(0,r.reduce)(d)))},()=>({enqueuedMessage:void 0})),h=new Map,f=new Map,m=()=>{},g={send:m,close:m};function y(e){return"x-fal-error"===e.type}n.realtimeImpl={connect(e,t){let n,{clientOnly:u=(0,a.isReact)()&&!(0,s.isBrowser)(),connectionKey:d=crypto.randomUUID(),maxBuffering:p,throttleInterval:v=128}=t;if(u&&!(0,s.isBrowser)())return g;f.set(d,{onError:t.onError,onResult:t.onResult});let E=function(e,t,n){if(!h.has(e)){let i=(0,r.interpret)(c,n);h.set(e,Object.assign(Object.assign({},i),{throttledSend:t>0?(0,a.throttle)(i.send,t,!0):i.send}))}return h.get(e)}(d,v,({context:t,machine:r,send:s})=>{let{enqueuedMessage:u,token:c}=t;if("active"===r.current&&u&&s({type:"send",message:u}),"authRequired"===r.current&&void 0===c&&n!==r.current&&(s({type:"initiateAuth"}),(0,o.getTemporaryAuthToken)(e).then(e=>{s({type:"authenticated",token:e}),setTimeout(()=>{s({type:"expireToken"})},Math.round(.9*o.TOKEN_EXPIRATION_SECONDS*1e3))}).catch(e=>{s({type:"unauthorized",error:e})})),"connecting"===r.current&&n!==r.current&&void 0!==c){let t=new WebSocket(function(e,{token:t,maxBuffering:n}){if(void 0!==n&&(n<1||n>60))throw Error("The `maxBuffering` must be between 1 and 60 (inclusive)");let i=new URLSearchParams({fal_jwt_token:t});void 0!==n&&i.set("max_buffering",n.toFixed(0));let r=(0,a.ensureAppIdFormat)(e);return`wss://fal.run/${r}/realtime?${i.toString()}`}(e,{token:c,maxBuffering:p}));t.onopen=()=>{s({type:"connected",websocket:t})},t.onclose=e=>{if(1e3!==e.code){let{onError:t=m}=f.get(d);t(new l.ApiError({message:`Error closing the connection: ${e.reason}`,status:e.code}))}s({type:"connectionClosed",code:e.code})},t.onerror=e=>{let{onError:t=m}=f.get(d);t(new l.ApiError({message:"Unknown error",status:500}))},t.onmessage=e=>{let{onResult:t}=f.get(d);if(e.data instanceof ArrayBuffer)return void t((0,i.decode)(new Uint8Array(e.data)));if(e.data instanceof Uint8Array)return void t((0,i.decode)(e.data));if(e.data instanceof Blob)return void e.data.arrayBuffer().then(e=>{t((0,i.decode)(new Uint8Array(e)))});let n=JSON.parse(e.data);if("error"===n.status&&"Unauthorized"===n.error)return void s({type:"unauthorized",error:Error("Unauthorized")});if("error"!==n.status&&"x-fal-message"!==n.type&&!y(n))return void t(n);if(y(n)){if("TIMEOUT"===n.error)return;let{onError:e=m}=f.get(d);e(new l.ApiError({message:`${n.error}: ${n.reason}`,status:400,body:n}));return}}}n=r.current});return{send:e=>{var t;let n=e instanceof Uint8Array?e:Object.assign(Object.assign({},e),{request_id:null!=(t=e.request_id)?t:crypto.randomUUID()});E.throttledSend({type:"send",message:n})},close:()=>{E.send({type:"close"})}}}}},16847,(e,t,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.parseAppId=n.stream=n.storage=n.ValidationError=n.ApiError=n.realtime=n.withProxy=n.withMiddleware=n.subscribe=n.run=n.queue=n.getConfig=n.config=void 0;var i=e.r(43799);Object.defineProperty(n,"config",{enumerable:!0,get:function(){return i.config}}),Object.defineProperty(n,"getConfig",{enumerable:!0,get:function(){return i.getConfig}});var r=e.r(704);Object.defineProperty(n,"queue",{enumerable:!0,get:function(){return r.queue}}),Object.defineProperty(n,"run",{enumerable:!0,get:function(){return r.run}}),Object.defineProperty(n,"subscribe",{enumerable:!0,get:function(){return r.subscribe}});var o=e.r(4621);Object.defineProperty(n,"withMiddleware",{enumerable:!0,get:function(){return o.withMiddleware}}),Object.defineProperty(n,"withProxy",{enumerable:!0,get:function(){return o.withProxy}});var l=e.r(68959);Object.defineProperty(n,"realtime",{enumerable:!0,get:function(){return l.realtimeImpl}});var s=e.r(66522);Object.defineProperty(n,"ApiError",{enumerable:!0,get:function(){return s.ApiError}}),Object.defineProperty(n,"ValidationError",{enumerable:!0,get:function(){return s.ValidationError}});var a=e.r(32910);Object.defineProperty(n,"storage",{enumerable:!0,get:function(){return a.storageImpl}});var u=e.r(17230);Object.defineProperty(n,"stream",{enumerable:!0,get:function(){return u.stream}});var d=e.r(39750);Object.defineProperty(n,"parseAppId",{enumerable:!0,get:function(){return d.parseAppId}})},13292,e=>{"use strict";let t,n;var i,r,o,l,s,a,u,d,p,c,h,f,m,g,y,v,E,A,I,T,_,b,O,C,S,w,R,P,N,x,U,M,D,k,L,j,q,G,F,B,H,V,$,J,Y,W,K,z,X,Z,Q,ee,et,en,ei,er,eo,el,es,ea,eu,ed,ep,ec,eh,ef,em,eg,ey,ev,eE,eA,eI,eT,e_,eb,eO,eC,eS,ew,eR,eP,eN,ex,eU,eM,eD,ek,eL,ej,eq,eG,eF,eB,eH,eV,e$,eJ,eY,eW,eK=e.i(43476),ez=e.i(71645);class eX{}function eZ(e,t){return e.replace(/\{([^}]+)\}/g,(e,n)=>{if(Object.prototype.hasOwnProperty.call(t,n)){let e=t[n];return null!=e?String(e):""}throw Error(`Key '${n}' not found in valueMap.`)})}function eQ(e,t,n){for(let i=0;i<t.length-1;i++){let r=t[i];if(r.endsWith("[]")){let o=r.slice(0,-2);if(!(o in e))if(Array.isArray(n))e[o]=Array.from({length:n.length},()=>({}));else throw Error(`Value must be a list given an array path ${r}`);if(Array.isArray(e[o])){let r=e[o];if(Array.isArray(n))for(let e=0;e<r.length;e++)eQ(r[e],t.slice(i+1),n[e]);else for(let e of r)eQ(e,t.slice(i+1),n)}return}if(r.endsWith("[0]")){let o=r.slice(0,-3);o in e||(e[o]=[{}]),eQ(e[o][0],t.slice(i+1),n);return}e[r]&&"object"==typeof e[r]||(e[r]={}),e=e[r]}let i=t[t.length-1],r=e[i];if(void 0!==r){if(!n||"object"==typeof n&&0===Object.keys(n).length||n===r)return;if("object"==typeof r&&"object"==typeof n&&null!==r&&null!==n)Object.assign(r,n);else throw Error(`Cannot set value for an existing key. Key: ${i}`)}else"_self"!==i||"object"!=typeof n||null===n||Array.isArray(n)?e[i]=n:Object.assign(e,n)}function e0(e,t,n){try{if(1===t.length&&"_self"===t[0])return e;for(let i=0;i<t.length;i++){if("object"!=typeof e||null===e)return n;let r=t[i];if(r.endsWith("[]")){let o=r.slice(0,-2);if(!(o in e))return n;{let r=e[o];if(!Array.isArray(r))return n;return r.map(e=>e0(e,t.slice(i+1),n))}}e=e[r]}return e}catch(e){if(e instanceof TypeError)return n;throw e}}function e1(e){if("string"!=typeof e)throw Error("fromImageBytes must be a string");return e}(i=Q||(Q={})).OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",i.OUTCOME_OK="OUTCOME_OK",i.OUTCOME_FAILED="OUTCOME_FAILED",i.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED",(r=ee||(ee={})).LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",r.PYTHON="PYTHON",(o=et||(et={})).SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",o.SILENT="SILENT",o.WHEN_IDLE="WHEN_IDLE",o.INTERRUPT="INTERRUPT",(l=en||(en={})).TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",l.STRING="STRING",l.NUMBER="NUMBER",l.INTEGER="INTEGER",l.BOOLEAN="BOOLEAN",l.ARRAY="ARRAY",l.OBJECT="OBJECT",l.NULL="NULL",(s=ei||(ei={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",s.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",s.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",s.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",s.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",s.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",s.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",s.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",s.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK",(a=er||(er={})).HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",a.SEVERITY="SEVERITY",a.PROBABILITY="PROBABILITY",(u=eo||(eo={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",u.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",u.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",u.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",u.BLOCK_NONE="BLOCK_NONE",u.OFF="OFF",(d=el||(el={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",d.MODE_DYNAMIC="MODE_DYNAMIC",(p=es||(es={})).AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",p.NO_AUTH="NO_AUTH",p.API_KEY_AUTH="API_KEY_AUTH",p.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",p.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",p.OAUTH="OAUTH",p.OIDC_AUTH="OIDC_AUTH",(c=ea||(ea={})).API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",c.SIMPLE_SEARCH="SIMPLE_SEARCH",c.ELASTIC_SEARCH="ELASTIC_SEARCH",(h=eu||(eu={})).URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",h.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",h.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",h.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",h.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE",(f=ed||(ed={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",f.STOP="STOP",f.MAX_TOKENS="MAX_TOKENS",f.SAFETY="SAFETY",f.RECITATION="RECITATION",f.LANGUAGE="LANGUAGE",f.OTHER="OTHER",f.BLOCKLIST="BLOCKLIST",f.PROHIBITED_CONTENT="PROHIBITED_CONTENT",f.SPII="SPII",f.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",f.IMAGE_SAFETY="IMAGE_SAFETY",f.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",f.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",f.NO_IMAGE="NO_IMAGE",(m=ep||(ep={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",m.NEGLIGIBLE="NEGLIGIBLE",m.LOW="LOW",m.MEDIUM="MEDIUM",m.HIGH="HIGH",(g=ec||(ec={})).HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",g.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",g.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",g.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",g.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH",(y=eh||(eh={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",y.SAFETY="SAFETY",y.OTHER="OTHER",y.BLOCKLIST="BLOCKLIST",y.PROHIBITED_CONTENT="PROHIBITED_CONTENT",y.IMAGE_SAFETY="IMAGE_SAFETY",y.MODEL_ARMOR="MODEL_ARMOR",y.JAILBREAK="JAILBREAK",(v=ef||(ef={})).TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",v.ON_DEMAND="ON_DEMAND",v.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT",(E=em||(em={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",E.TEXT="TEXT",E.IMAGE="IMAGE",E.AUDIO="AUDIO",(A=eg||(eg={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",A.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",A.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",A.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",(I=ey||(ey={})).JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",I.JOB_STATE_QUEUED="JOB_STATE_QUEUED",I.JOB_STATE_PENDING="JOB_STATE_PENDING",I.JOB_STATE_RUNNING="JOB_STATE_RUNNING",I.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",I.JOB_STATE_FAILED="JOB_STATE_FAILED",I.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",I.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",I.JOB_STATE_PAUSED="JOB_STATE_PAUSED",I.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",I.JOB_STATE_UPDATING="JOB_STATE_UPDATING",I.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED",(T=ev||(ev={})).TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",T.TUNING_MODE_FULL="TUNING_MODE_FULL",T.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER",(_=eE||(eE={})).ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",_.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",_.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",_.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",_.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",_.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",_.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO",(b=eA||(eA={})).TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",b.TUNING_TASK_I2V="TUNING_TASK_I2V",b.TUNING_TASK_T2V="TUNING_TASK_T2V",(O=eI||(eI={})).FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",O.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",O.BALANCED="BALANCED",O.PRIORITIZE_COST="PRIORITIZE_COST",(C=eT||(eT={})).UNSPECIFIED="UNSPECIFIED",C.BLOCKING="BLOCKING",C.NON_BLOCKING="NON_BLOCKING",(S=e_||(e_={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",S.MODE_DYNAMIC="MODE_DYNAMIC",(w=eb||(eb={})).ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",w.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER",(R=eO||(eO={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",R.AUTO="AUTO",R.ANY="ANY",R.NONE="NONE",R.VALIDATED="VALIDATED",(P=eC||(eC={})).BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",P.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",P.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",P.BLOCK_NONE="BLOCK_NONE",(N=eS||(eS={})).DONT_ALLOW="DONT_ALLOW",N.ALLOW_ADULT="ALLOW_ADULT",N.ALLOW_ALL="ALLOW_ALL",(x=ew||(ew={})).auto="auto",x.en="en",x.ja="ja",x.ko="ko",x.hi="hi",x.zh="zh",x.pt="pt",x.es="es",(U=eR||(eR={})).MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",U.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",U.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",U.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",U.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC",(M=eP||(eP={})).CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",M.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",M.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",M.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH",(D=eN||(eN={})).SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",D.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",D.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",D.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT",(k=ex||(ex={})).EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",k.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",k.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",k.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",k.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",k.EDIT_MODE_STYLE="EDIT_MODE_STYLE",k.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",k.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE",(L=eU||(eU={})).FOREGROUND="FOREGROUND",L.BACKGROUND="BACKGROUND",L.PROMPT="PROMPT",L.SEMANTIC="SEMANTIC",L.INTERACTIVE="INTERACTIVE",(j=eM||(eM={})).ASSET="ASSET",j.STYLE="STYLE",(q=eD||(eD={})).INSERT="INSERT",q.REMOVE="REMOVE",q.REMOVE_STATIC="REMOVE_STATIC",q.OUTPAINT="OUTPAINT",(G=ek||(ek={})).OPTIMIZED="OPTIMIZED",G.LOSSLESS="LOSSLESS",(F=eL||(eL={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",F.PROCESSING="PROCESSING",F.ACTIVE="ACTIVE",F.FAILED="FAILED",(B=ej||(ej={})).SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",B.UPLOADED="UPLOADED",B.GENERATED="GENERATED",(H=eq||(eq={})).TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",H.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",H.RESPONSE_REJECTED="RESPONSE_REJECTED",H.NEED_MORE_INPUT="NEED_MORE_INPUT",(V=eG||(eG={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",V.TEXT="TEXT",V.IMAGE="IMAGE",V.VIDEO="VIDEO",V.AUDIO="AUDIO",V.DOCUMENT="DOCUMENT",($=eF||(eF={})).START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",$.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",$.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW",(J=eB||(eB={})).END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",J.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",J.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW",(Y=eH||(eH={})).ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",Y.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",Y.NO_INTERRUPTION="NO_INTERRUPTION",(W=eV||(eV={})).TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",W.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",W.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT",(K=e$||(e$={})).SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",K.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",K.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",K.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",K.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",K.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",K.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",K.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",K.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",K.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",K.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",K.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",K.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR",(z=eJ||(eJ={})).MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",z.QUALITY="QUALITY",z.DIVERSITY="DIVERSITY",z.VOCALIZATION="VOCALIZATION",(X=eY||(eY={})).PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",X.PLAY="PLAY",X.PAUSE="PAUSE",X.STOP="STOP",X.RESET_CONTEXT="RESET_CONTEXT";class e2{constructor(e){const t={};for(const n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class e6{get text(){var e,t,n,i,r,o,l,s;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let a="",u=!1,d=[];for(let e of null!=(s=null==(l=null==(o=null==(r=this.candidates)?void 0:r[0])?void 0:o.content)?void 0:l.parts)?s:[]){for(let[t,n]of Object.entries(e))"text"!==t&&"thought"!==t&&(null!==n||void 0!==n)&&d.push(t);if("string"==typeof e.text){if("boolean"==typeof e.thought&&e.thought)continue;u=!0,a+=e.text}}return d.length>0&&console.warn(`there are non-text parts ${d} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?a:void 0}get data(){var e,t,n,i,r,o,l,s;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let a="",u=[];for(let e of null!=(s=null==(l=null==(o=null==(r=this.candidates)?void 0:r[0])?void 0:o.content)?void 0:l.parts)?s:[]){for(let[t,n]of Object.entries(e))"inlineData"!==t&&(null!==n||void 0!==n)&&u.push(t);e.inlineData&&"string"==typeof e.inlineData.data&&(a+=atob(e.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),a.length>0?btoa(a):void 0}get functionCalls(){var e,t,n,i,r,o,l,s;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let a=null==(s=null==(l=null==(o=null==(r=this.candidates)?void 0:r[0])?void 0:o.content)?void 0:l.parts)?void 0:s.filter(e=>e.functionCall).map(e=>e.functionCall).filter(e=>void 0!==e);if((null==a?void 0:a.length)!==0)return a}get executableCode(){var e,t,n,i,r,o,l,s,a;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let u=null==(s=null==(l=null==(o=null==(r=this.candidates)?void 0:r[0])?void 0:o.content)?void 0:l.parts)?void 0:s.filter(e=>e.executableCode).map(e=>e.executableCode).filter(e=>void 0!==e);if((null==u?void 0:u.length)!==0)return null==(a=null==u?void 0:u[0])?void 0:a.code}get codeExecutionResult(){var e,t,n,i,r,o,l,s,a;if((null==(i=null==(n=null==(t=null==(e=this.candidates)?void 0:e[0])?void 0:t.content)?void 0:n.parts)?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let u=null==(s=null==(l=null==(o=null==(r=this.candidates)?void 0:r[0])?void 0:o.content)?void 0:l.parts)?void 0:s.filter(e=>e.codeExecutionResult).map(e=>e.codeExecutionResult).filter(e=>void 0!==e);if((null==u?void 0:u.length)!==0)return null==(a=null==u?void 0:u[0])?void 0:a.output}}class e4{}class e8{}class e3{}class e5{}class e9{}class e7{}class te{}class tt{}class tn{}class ti{}class tr{_fromAPIResponse({apiResponse:e,isVertexAI:t}){let n,i=new tr;if(t){let t,i,r,o,l,s;t={},null!=(i=e0(e,["name"]))&&eQ(t,["name"],i),null!=(r=e0(e,["metadata"]))&&eQ(t,["metadata"],r),null!=(o=e0(e,["done"]))&&eQ(t,["done"],o),null!=(l=e0(e,["error"]))&&eQ(t,["error"],l),null!=(s=e0(e,["response"]))&&eQ(t,["response"],function(e){let t={},n=e0(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s;return n={},null!=(i=e0(e,["_self"]))&&eQ(n,["video"],(r={},null!=(o=e0(t=i,["gcsUri"]))&&eQ(r,["uri"],o),null!=(l=e0(t,["bytesBase64Encoded"]))&&eQ(r,["videoBytes"],e1(l)),null!=(s=e0(t,["mimeType"]))&&eQ(r,["mimeType"],s),r)),n})),eQ(t,["generatedVideos"],e)}let i=e0(e,["raiMediaFilteredCount"]);null!=i&&eQ(t,["raiMediaFilteredCount"],i);let r=e0(e,["raiMediaFilteredReasons"]);return null!=r&&eQ(t,["raiMediaFilteredReasons"],r),t}(s)),n=t}else{let t,i,r,o,l,s;t={},null!=(i=e0(e,["name"]))&&eQ(t,["name"],i),null!=(r=e0(e,["metadata"]))&&eQ(t,["metadata"],r),null!=(o=e0(e,["done"]))&&eQ(t,["done"],o),null!=(l=e0(e,["error"]))&&eQ(t,["error"],l),null!=(s=e0(e,["response","generateVideoResponse"]))&&eQ(t,["response"],function(e){let t={},n=e0(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s;return n={},null!=(i=e0(e,["video"]))&&eQ(n,["video"],(r={},null!=(o=e0(t=i,["uri"]))&&eQ(r,["uri"],o),null!=(l=e0(t,["encodedVideo"]))&&eQ(r,["videoBytes"],e1(l)),null!=(s=e0(t,["encoding"]))&&eQ(r,["mimeType"],s),r)),n})),eQ(t,["generatedVideos"],e)}let i=e0(e,["raiMediaFilteredCount"]);null!=i&&eQ(t,["raiMediaFilteredCount"],i);let r=e0(e,["raiMediaFilteredReasons"]);return null!=r&&eQ(t,["raiMediaFilteredReasons"],r),t}(s)),n=t}return Object.assign(i,n),i}}class to{}class tl{}class ts{}class ta{}class tu{}class td{}class tp{}class tc{get text(){var e,t,n;let i="",r=!1,o=[];for(let l of null!=(n=null==(t=null==(e=this.serverContent)?void 0:e.modelTurn)?void 0:t.parts)?n:[]){for(let[e,t]of Object.entries(l))"text"!==e&&"thought"!==e&&null!==t&&o.push(e);if("string"==typeof l.text){if("boolean"==typeof l.thought&&l.thought)continue;r=!0,i+=l.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?i:void 0}get data(){var e,t,n;let i="",r=[];for(let o of null!=(n=null==(t=null==(e=this.serverContent)?void 0:e.modelTurn)?void 0:t.parts)?n:[]){for(let[e,t]of Object.entries(o))"inlineData"!==e&&null!==t&&r.push(e);o.inlineData&&"string"==typeof o.inlineData.data&&(i+=atob(o.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class th{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}function tf(e,t){if(!t||"string"!=typeof t)throw Error("model is required and must be a string");if(e.isVertexAI())if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;else{if(!(t.indexOf("/")>=0))return`publishers/google/models/${t}`;let e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function tm(e,t){let n=tf(e,t);return n?n.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}`:n.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${n}`:n:""}function tg(e){return Array.isArray(e)?e.map(e=>ty(e)):[ty(e)]}function ty(e){if("object"==typeof e&&null!==e)return e;throw Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function tv(e){let t=ty(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function tE(e){let t=ty(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function tA(e){if(null==e)throw Error("PartUnion is required");if("object"==typeof e)return e;if("string"==typeof e)return{text:e};throw Error(`Unsupported part type: ${typeof e}`)}function tI(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("PartListUnion is required");return Array.isArray(e)?e.map(e=>tA(e)):[tA(e)]}function tT(e){return null!=e&&"object"==typeof e&&"parts"in e&&Array.isArray(e.parts)}function t_(e){return null!=e&&"object"==typeof e&&"functionCall"in e}function tb(e){return null!=e&&"object"==typeof e&&"functionResponse"in e}function tO(e){if(null==e)throw Error("ContentUnion is required");return tT(e)?e:{role:"user",parts:tI(e)}}function tC(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{let t=tO(e);return t.parts&&t.parts.length>0&&void 0!==t.parts[0].text?[t.parts[0].text]:[]});if(e.isVertexAI()){let e=tO(t);return e.parts&&e.parts.length>0&&void 0!==e.parts[0].text?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>tO(e)):[tO(t)]}function tS(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("contents are required");if(!Array.isArray(e)){if(t_(e)||tb(e))throw Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[tO(e)]}let t=[],n=[],i=tT(e[0]);for(let r of e){let e=tT(r);if(e!=i)throw Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(e)t.push(r);else if(t_(r)||tb(r))throw Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");else n.push(r)}return i||t.push({role:"user",parts:tI(n)}),t}function tw(e){let t={},n=["items"],i=["anyOf"],r=["properties"];if(e.type&&e.anyOf)throw Error("type and anyOf cannot be both populated.");let o=e.anyOf;for(let[l,s]of(null!=o&&2==o.length&&("null"===o[0].type?(t.nullable=!0,e=o[1]):"null"===o[1].type&&(t.nullable=!0,e=o[0])),e.type instanceof Array&&function(e,t){e.includes("null")&&(t.nullable=!0);let n=e.filter(e=>"null"!==e);if(1===n.length)t.type=Object.values(en).includes(n[0].toUpperCase())?n[0].toUpperCase():en.TYPE_UNSPECIFIED;else for(let e of(t.anyOf=[],n))t.anyOf.push({type:Object.values(en).includes(e.toUpperCase())?e.toUpperCase():en.TYPE_UNSPECIFIED})}(e.type,t),Object.entries(e)))if(null!=s)if("type"==l){if("null"===s)throw Error("type: null can not be the only possible type for the field.");if(s instanceof Array)continue;t.type=Object.values(en).includes(s.toUpperCase())?s.toUpperCase():en.TYPE_UNSPECIFIED}else if(n.includes(l))t[l]=tw(s);else if(i.includes(l)){let e=[];for(let n of s){if("null"==n.type){t.nullable=!0;continue}e.push(tw(n))}t[l]=e}else if(r.includes(l)){let e={};for(let[t,n]of Object.entries(s))e[t]=tw(n);t[l]=e}else{if("additionalProperties"===l)continue;t[l]=s}return t}function tR(e){if("object"==typeof e)return e;if("string"==typeof e)return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw Error(`Unsupported speechConfig type: ${typeof e}`)}function tP(e){if("multiSpeakerVoiceConfig"in e)throw Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function tN(e){if(e.functionDeclarations)for(let t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=tw(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=tw(t.response));return e}function tx(e){if(null==e)throw Error("tools is required");if(!Array.isArray(e))throw Error("tools is required and must be an array of Tools");let t=[];for(let n of e)t.push(n);return t}function tU(e,t){if("string"!=typeof t)throw Error("name must be a string");return function(e,t,n,i=1){let r=!t.startsWith(`${n}/`)&&t.split("/").length===i;if(e.isVertexAI())if(t.startsWith("projects/"))return t;else if(t.startsWith("locations/"))return`projects/${e.getProject()}/${t}`;else if(t.startsWith(`${n}/`))return`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`;else if(r)return`projects/${e.getProject()}/locations/${e.getLocation()}/${n}/${t}`;else return t;return r?`${n}/${t}`:t}(e,t,"cachedContents")}function tM(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function tD(e){var t;let n;if(null!=e&&"object"==typeof e&&"name"in e&&(n=e.name),null==e||"object"!=typeof e||!("uri"in e)||void 0!==(n=e.uri)){if(null==e||"object"!=typeof e||!("video"in e)||void 0!==(n=null==(t=e.video)?void 0:t.uri)){if("string"==typeof e&&(n=e),void 0===n)throw Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){let e=n.split("files/")[1].match(/[a-z0-9]+/);if(null===e)throw Error(`Could not extract file name from URI ${n}`);n=e[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}}function tk(e,t){return e.isVertexAI()?t?"publishers/google/models":"models":t?"models":"tunedModels"}function tL(e){for(let i of["models","tunedModels","publisherModels"]){var t,n;if(t=e,n=i,null!==t&&"object"==typeof t&&n in t)return e[i]}return[]}function tj(e,t){let n;if("string"==typeof t)if(e.isVertexAI())if(t.startsWith("gs://"))n={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))n={format:"bigquery",bigqueryUri:t};else throw Error(`Unsupported string source for Vertex AI: ${t}`);else if(t.startsWith("files/"))n={fileName:t};else throw Error(`Unsupported string source for Gemini API: ${t}`);else if(Array.isArray(t)){if(e.isVertexAI())throw Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:t}}else n=t;let i=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,r=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(e.isVertexAI()){if(r>0||1!==i)throw Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(i>0||1!==r)throw Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function tq(e){if("object"!=typeof e||null===e)return{};let t=e.inlinedResponses;if("object"!=typeof t||null===t)return e;let n=t.inlinedResponses;if(!Array.isArray(n)||0===n.length)return e;let i=!1;for(let e of n){if("object"!=typeof e||null===e)continue;let t=e.response;if("object"==typeof t&&null!==t&&void 0!==t.embedding){i=!0;break}}return i&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),e}function tG(e,t){if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw Error(`Invalid batch job name: ${t}.`)}function tF(e){if("BATCH_STATE_UNSPECIFIED"===e)return"JOB_STATE_UNSPECIFIED";if("BATCH_STATE_PENDING"===e)return"JOB_STATE_PENDING";if("BATCH_STATE_RUNNING"===e)return"JOB_STATE_RUNNING";if("BATCH_STATE_SUCCEEDED"===e)return"JOB_STATE_SUCCEEDED";if("BATCH_STATE_FAILED"===e)return"JOB_STATE_FAILED";else if("BATCH_STATE_CANCELLED"===e)return"JOB_STATE_CANCELLED";else if("BATCH_STATE_EXPIRED"===e)return"JOB_STATE_EXPIRED";else return e}function tB(e){let t={},n=e0(e,["name"]);null!=n&&eQ(t,["name"],n);let i=e0(e,["metadata","displayName"]);null!=i&&eQ(t,["displayName"],i);let r=e0(e,["metadata","state"]);null!=r&&eQ(t,["state"],tF(r));let o=e0(e,["metadata","createTime"]);null!=o&&eQ(t,["createTime"],o);let l=e0(e,["metadata","endTime"]);null!=l&&eQ(t,["endTime"],l);let s=e0(e,["metadata","updateTime"]);null!=s&&eQ(t,["updateTime"],s);let a=e0(e,["metadata","model"]);null!=a&&eQ(t,["model"],a);let u=e0(e,["metadata","output"]);return null!=u&&eQ(t,["dest"],function(e){let t={},n=e0(e,["responsesFile"]);null!=n&&eQ(t,["fileName"],n);let i=e0(e,["inlinedResponses","inlinedResponses"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r;return n={},null!=(i=e0(t=e,["response"]))&&eQ(n,["response"],function(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["candidates"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=e0(e,["content"]);null!=n&&eQ(t,["content"],n);let i=e0(e,["citationMetadata"]);null!=i&&eQ(t,["citationMetadata"],function(e){let t={},n=e0(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["citations"],e)}return t}(i));let r=e0(e,["tokenCount"]);null!=r&&eQ(t,["tokenCount"],r);let o=e0(e,["finishReason"]);null!=o&&eQ(t,["finishReason"],o);let l=e0(e,["urlContextMetadata"]);null!=l&&eQ(t,["urlContextMetadata"],l);let s=e0(e,["avgLogprobs"]);null!=s&&eQ(t,["avgLogprobs"],s);let a=e0(e,["groundingMetadata"]);null!=a&&eQ(t,["groundingMetadata"],a);let u=e0(e,["index"]);null!=u&&eQ(t,["index"],u);let d=e0(e,["logprobsResult"]);null!=d&&eQ(t,["logprobsResult"],d);let p=e0(e,["safetyRatings"]);if(null!=p){let e=p;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["safetyRatings"],e)}return t})(e))),eQ(t,["candidates"],e)}let r=e0(e,["modelVersion"]);null!=r&&eQ(t,["modelVersion"],r);let o=e0(e,["promptFeedback"]);null!=o&&eQ(t,["promptFeedback"],o);let l=e0(e,["responseId"]);null!=l&&eQ(t,["responseId"],l);let s=e0(e,["usageMetadata"]);return null!=s&&eQ(t,["usageMetadata"],s),t}(i)),null!=(r=e0(t,["error"]))&&eQ(n,["error"],r),n})),eQ(t,["inlinedResponses"],e)}let r=e0(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["inlinedEmbedContentResponses"],e)}return t}(tq(u))),t}function tH(e){var t,n;let i,r,o,l,s,a,u,d,p={},c=e0(e,["name"]);null!=c&&eQ(p,["name"],c);let h=e0(e,["displayName"]);null!=h&&eQ(p,["displayName"],h);let f=e0(e,["state"]);null!=f&&eQ(p,["state"],tF(f));let m=e0(e,["error"]);null!=m&&eQ(p,["error"],m);let g=e0(e,["createTime"]);null!=g&&eQ(p,["createTime"],g);let y=e0(e,["startTime"]);null!=y&&eQ(p,["startTime"],y);let v=e0(e,["endTime"]);null!=v&&eQ(p,["endTime"],v);let E=e0(e,["updateTime"]);null!=E&&eQ(p,["updateTime"],E);let A=e0(e,["model"]);null!=A&&eQ(p,["model"],A);let I=e0(e,["inputConfig"]);null!=I&&eQ(p,["src"],(i={},null!=(r=e0(n=I,["instancesFormat"]))&&eQ(i,["format"],r),null!=(o=e0(n,["gcsSource","uris"]))&&eQ(i,["gcsUri"],o),null!=(l=e0(n,["bigquerySource","inputUri"]))&&eQ(i,["bigqueryUri"],l),i));let T=e0(e,["outputConfig"]);return null!=T&&eQ(p,["dest"],(t=tq(T),s={},null!=(a=e0(t,["predictionsFormat"]))&&eQ(s,["format"],a),null!=(u=e0(t,["gcsDestination","outputUriPrefix"]))&&eQ(s,["gcsUri"],u),null!=(d=e0(t,["bigqueryDestination","outputUri"]))&&eQ(s,["bigqueryUri"],d),s)),p}function tV(e){let t={},n=e0(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s,a,u,d,p,c;return n={},null!=(i=e0(t=e,["videoMetadata"]))&&eQ(n,["videoMetadata"],i),null!=(r=e0(t,["thought"]))&&eQ(n,["thought"],r),null!=(o=e0(t,["inlineData"]))&&eQ(n,["inlineData"],function(e){let t={};if(void 0!==e0(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=e0(e,["data"]);null!=n&&eQ(t,["data"],n);let i=e0(e,["mimeType"]);return null!=i&&eQ(t,["mimeType"],i),t}(o)),null!=(l=e0(t,["fileData"]))&&eQ(n,["fileData"],function(e){let t={};if(void 0!==e0(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=e0(e,["fileUri"]);null!=n&&eQ(t,["fileUri"],n);let i=e0(e,["mimeType"]);return null!=i&&eQ(t,["mimeType"],i),t}(l)),null!=(s=e0(t,["thoughtSignature"]))&&eQ(n,["thoughtSignature"],s),null!=(a=e0(t,["functionCall"]))&&eQ(n,["functionCall"],a),null!=(u=e0(t,["codeExecutionResult"]))&&eQ(n,["codeExecutionResult"],u),null!=(d=e0(t,["executableCode"]))&&eQ(n,["executableCode"],d),null!=(p=e0(t,["functionResponse"]))&&eQ(n,["functionResponse"],p),null!=(c=e0(t,["text"]))&&eQ(n,["text"],c),n})),eQ(t,["parts"],e)}let i=e0(e,["role"]);return null!=i&&eQ(t,["role"],i),t}function t$(e,t){let n={},i=e0(t,["model"]);null!=i&&eQ(n,["_url","model"],tf(e,i));let r=e0(t,["src"]);null!=r&&eQ(n,["batch","inputConfig"],function(e,t){let n={};if(void 0!==e0(t,["format"]))throw Error("format parameter is not supported in Gemini API.");if(void 0!==e0(t,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==e0(t,["bigqueryUri"]))throw Error("bigqueryUri parameter is not supported in Gemini API.");let i=e0(t,["fileName"]);null!=i&&eQ(n,["fileName"],i);let r=e0(t,["inlinedRequests"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},i=e0(t,["model"]);null!=i&&eQ(n,["request","model"],tf(e,i));let r=e0(t,["contents"]);if(null!=r){let e=tS(r);Array.isArray(e)&&(e=e.map(e=>tV(e))),eQ(n,["request","contents"],e)}let o=e0(t,["metadata"]);null!=o&&eQ(n,["metadata"],o);let l=e0(t,["config"]);return null!=l&&eQ(n,["request","generationConfig"],function(e,t,n){let i={},r=e0(t,["systemInstruction"]);void 0!==n&&null!=r&&eQ(n,["systemInstruction"],tV(tO(r)));let o=e0(t,["temperature"]);null!=o&&eQ(i,["temperature"],o);let l=e0(t,["topP"]);null!=l&&eQ(i,["topP"],l);let s=e0(t,["topK"]);null!=s&&eQ(i,["topK"],s);let a=e0(t,["candidateCount"]);null!=a&&eQ(i,["candidateCount"],a);let u=e0(t,["maxOutputTokens"]);null!=u&&eQ(i,["maxOutputTokens"],u);let d=e0(t,["stopSequences"]);null!=d&&eQ(i,["stopSequences"],d);let p=e0(t,["responseLogprobs"]);null!=p&&eQ(i,["responseLogprobs"],p);let c=e0(t,["logprobs"]);null!=c&&eQ(i,["logprobs"],c);let h=e0(t,["presencePenalty"]);null!=h&&eQ(i,["presencePenalty"],h);let f=e0(t,["frequencyPenalty"]);null!=f&&eQ(i,["frequencyPenalty"],f);let m=e0(t,["seed"]);null!=m&&eQ(i,["seed"],m);let g=e0(t,["responseMimeType"]);null!=g&&eQ(i,["responseMimeType"],g);let y=e0(t,["responseSchema"]);null!=y&&eQ(i,["responseSchema"],tw(y));let v=e0(t,["responseJsonSchema"]);if(null!=v&&eQ(i,["responseJsonSchema"],v),void 0!==e0(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==e0(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let E=e0(t,["safetySettings"]);if(void 0!==n&&null!=E){let e=E;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==e0(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let n=e0(e,["category"]);null!=n&&eQ(t,["category"],n);let i=e0(e,["threshold"]);return null!=i&&eQ(t,["threshold"],i),t})(e))),eQ(n,["safetySettings"],e)}let A=e0(t,["tools"]);if(void 0!==n&&null!=A){let e=tx(A);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=e0(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["functionDeclarations"],e)}if(void 0!==e0(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=e0(e,["googleSearch"]);null!=i&&eQ(t,["googleSearch"],function(e){let t={},n=e0(e,["timeRangeFilter"]);if(null!=n&&eQ(t,["timeRangeFilter"],n),void 0!==e0(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(i));let r=e0(e,["googleSearchRetrieval"]);if(null!=r&&eQ(t,["googleSearchRetrieval"],r),void 0!==e0(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=e0(e,["googleMaps"]);null!=o&&eQ(t,["googleMaps"],function(e){let t={};if(void 0!==e0(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=e0(e,["enableWidget"]);return null!=n&&eQ(t,["enableWidget"],n),t}(o));let l=e0(e,["urlContext"]);null!=l&&eQ(t,["urlContext"],l);let s=e0(e,["computerUse"]);null!=s&&eQ(t,["computerUse"],s);let a=e0(e,["codeExecution"]);return null!=a&&eQ(t,["codeExecution"],a),t})(tN(e)))),eQ(n,["tools"],e)}let I=e0(t,["toolConfig"]);if(void 0!==n&&null!=I&&eQ(n,["toolConfig"],I),void 0!==e0(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let T=e0(t,["cachedContent"]);void 0!==n&&null!=T&&eQ(n,["cachedContent"],tU(e,T));let _=e0(t,["responseModalities"]);null!=_&&eQ(i,["responseModalities"],_);let b=e0(t,["mediaResolution"]);null!=b&&eQ(i,["mediaResolution"],b);let O=e0(t,["speechConfig"]);if(null!=O&&eQ(i,["speechConfig"],tR(O)),void 0!==e0(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let C=e0(t,["thinkingConfig"]);null!=C&&eQ(i,["thinkingConfig"],C);let S=e0(t,["imageConfig"]);return null!=S&&eQ(i,["imageConfig"],S),i}(e,l,e0(n,["request"],{}))),n})(e,t))),eQ(n,["requests","requests"],t)}return n}(e,tj(e,r)));let o=e0(t,["config"]);return null!=o&&function(e,t){let n=e0(e,["displayName"]);if(void 0!==t&&null!=n&&eQ(t,["batch","displayName"],n),void 0!==e0(e,["dest"]))throw Error("dest parameter is not supported in Gemini API.")}(o,n),n}(Z=eW||(eW={})).PAGED_ITEM_BATCH_JOBS="batchJobs",Z.PAGED_ITEM_MODELS="models",Z.PAGED_ITEM_TUNING_JOBS="tuningJobs",Z.PAGED_ITEM_FILES="files",Z.PAGED_ITEM_CACHED_CONTENTS="cachedContents";class tJ{constructor(e,t,n,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,i)}init(e,t,n){var i,r;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=null==t?void 0:t.sdkHttpResponse,this.idxInternal=0;let o={config:{}};(o=n&&0!==Object.keys(n).length?"object"==typeof n?Object.assign({},n):n:{config:{}}).config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=null!=(r=null==(i=o.config)?void 0:i.pageSize)?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(!this.hasNextPage())return{value:void 0,done:!0};else await this.nextPage();let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return(null==(e=this.params.config)?void 0:e.pageToken)!==void 0}}class tY extends eX{constructor(e){super(),this.apiClient=e,this.create=async e=>(this.apiClient.isVertexAI()&&(e.config=this.formatDestination(e.src,e.config)),this.createInternal(e)),this.createEmbeddings=async e=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(e)},this.list=async(e={})=>new tJ(eW.PAGED_ITEM_BATCH_JOBS,e=>this.listInternal(e),await this.listInternal(e),e)}createInlinedGenerateContentRequest(e){let t=t$(this.apiClient,e),n=eZ("{model}:batchGenerateContent",t._url),i=t.batch.inputConfig.requests,r=i.requests,o=[];for(let e of r){let t=Object.assign({},e);if(t.systemInstruction){let e=t.systemInstruction;delete t.systemInstruction;let n=t.request;n.systemInstruction=e,t.request=n}o.push(t)}return i.requests=o,delete t.config,delete t._url,delete t._query,{path:n,body:t}}getGcsUri(e){return"string"==typeof e?e.startsWith("gs://")?e:void 0:!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0?e.gcsUri[0]:void 0}getBigqueryUri(e){return"string"==typeof e?e.startsWith("bq://")?e:void 0:Array.isArray(e)?void 0:e.bigqueryUri}formatDestination(e,t){let n=t?Object.assign({},t):{},i=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${i}`),void 0===n.dest){let t=this.getGcsUri(e),r=this.getBigqueryUri(e);if(t)t.endsWith(".jsonl")?n.dest=`${t.slice(0,-6)}/dest`:n.dest=`${t}_dest_${i}`;else if(r)n.dest=`${r}_dest_${i}`;else throw Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,i,r,o;let l="",s={};if(this.apiClient.isVertexAI()){let i,r,a,u,d,p,c=(o=this.apiClient,i={},null!=(r=e0(e,["model"]))&&eQ(i,["model"],tf(o,r)),null!=(a=e0(e,["src"]))&&eQ(i,["inputConfig"],function(e){let t={},n=e0(e,["format"]);null!=n&&eQ(t,["instancesFormat"],n);let i=e0(e,["gcsUri"]);null!=i&&eQ(t,["gcsSource","uris"],i);let r=e0(e,["bigqueryUri"]);if(null!=r&&eQ(t,["bigquerySource","inputUri"],r),void 0!==e0(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==e0(e,["inlinedRequests"]))throw Error("inlinedRequests parameter is not supported in Vertex AI.");return t}(tj(o,a))),null!=(u=e0(e,["config"]))&&(d=e0(u,["displayName"]),void 0!==i&&null!=d&&eQ(i,["displayName"],d),p=e0(u,["dest"]),void 0!==i&&null!=p&&eQ(i,["outputConfig"],function(e){let t={},n=e0(e,["format"]);null!=n&&eQ(t,["predictionsFormat"],n);let i=e0(e,["gcsUri"]);null!=i&&eQ(t,["gcsDestination","outputUriPrefix"],i);let r=e0(e,["bigqueryUri"]);if(null!=r&&eQ(t,["bigqueryDestination","outputUri"],r),void 0!==e0(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==e0(e,["inlinedResponses"]))throw Error("inlinedResponses parameter is not supported in Vertex AI.");if(void 0!==e0(e,["inlinedEmbedContentResponses"]))throw Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}(function(e){if("string"!=typeof e)return e;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw Error(`Unsupported destination: ${e}`)}(p)))),i);return l=eZ("batchPredictionJobs",c._url),s=c._query,delete c._url,delete c._query,this.apiClient.request({path:l,queryParams:s,body:JSON.stringify(c),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>tH(e))}{let t=t$(this.apiClient,e);return l=eZ("{model}:batchGenerateContent",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:l,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>tB(e))}}async createEmbeddingsInternal(e){var t,n,i,r,o;let l="",s={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let a,u,d,p,c,h,f,m,g=(i=this.apiClient,p={},null!=(c=e0(e,["model"]))&&eQ(p,["_url","model"],tf(i,c)),null!=(h=e0(e,["src"]))&&eQ(p,["batch","inputConfig"],(r=i,a={},null!=(u=e0(o=h,["fileName"]))&&eQ(a,["file_name"],u),null!=(d=e0(o,["inlinedRequests"]))&&eQ(a,["requests"],function(e,t){let n={},i=e0(t,["contents"]);if(null!=i){let t=tC(e,i);Array.isArray(t)&&(t=t.map(e=>e)),eQ(n,["requests[]","request","content"],t)}let r=e0(t,["config"]);return null!=r&&(eQ(n,["_self"],function(e,t){let n=e0(e,["taskType"]);void 0!==t&&null!=n&&eQ(t,["requests[]","taskType"],n);let i=e0(e,["title"]);void 0!==t&&null!=i&&eQ(t,["requests[]","title"],i);let r=e0(e,["outputDimensionality"]);if(void 0!==t&&null!=r&&eQ(t,["requests[]","outputDimensionality"],r),void 0!==e0(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==e0(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.");return{}}(r,n)),!function(e,t){for(let[n,i]of Object.entries(t)){let t=n.split("."),r=i.split("."),o=new Set,l=-1;for(let e=0;e<t.length;e++)if("*"===t[e]){l=e;break}if(-1!==l&&r.length>l)for(let e=l;e<r.length;e++){let t=r[e];"*"===t||t.endsWith("[]")||t.endsWith("[0]")||o.add(t)}!function e(t,n,i,r,o){if(r>=n.length||"object"!=typeof t||null===t)return;let l=n[r];if(l.endsWith("[]")){let s=l.slice(0,-2);if(s in t&&Array.isArray(t[s]))for(let l of t[s])e(l,n,i,r+1,o)}else if("*"===l){if("object"==typeof t&&null!==t&&!Array.isArray(t)){let e=Object.keys(t).filter(e=>!e.startsWith("_")&&!o.has(e)),n={};for(let i of e)n[i]=t[i];for(let[e,o]of Object.entries(n)){let n=[];for(let t of i.slice(r))"*"===t?n.push(e):n.push(t);eQ(t,n,o)}for(let n of e)delete t[n]}}else l in t&&e(t[l],n,i,r+1,o)}(e,t,r,0,o)}}(n,{"requests[].*":"requests[].request.*"})),n}(r,d)),a)),null!=(f=e0(e,["config"]))&&(m=e0(f,["displayName"]),void 0!==p&&null!=m&&eQ(p,["batch","displayName"],m)),p);return l=eZ("{model}:asyncBatchEmbedContent",g._url),s=g._query,delete g._url,delete g._query,this.apiClient.request({path:l,queryParams:s,body:JSON.stringify(g),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>tB(e))}}async get(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l=(o=this.apiClient,i={},null!=(r=e0(e,["name"]))&&eQ(i,["_url","name"],tG(o,r)),i);return s=eZ("batchPredictionJobs/{name}",l._url),a=l._query,delete l._url,delete l._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>tH(e))}{let t,n,o=(l=this.apiClient,t={},null!=(n=e0(e,["name"]))&&eQ(t,["_url","name"],tG(l,n)),t);return s=eZ("batches/{name}",o._url),a=o._query,delete o._url,delete o._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>tB(e))}}async cancel(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l=(o=this.apiClient,i={},null!=(r=e0(e,["name"]))&&eQ(i,["_url","name"],tG(o,r)),i);s=eZ("batchPredictionJobs/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal})}else{let t,n,o=(l=this.apiClient,t={},null!=(n=e0(e,["name"]))&&eQ(t,["_url","name"],tG(l,n)),t);s=eZ("batches/{name}:cancel",o._url),a=o._query,delete o._url,delete o._query,await this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal})}}async listInternal(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i,r,s,a,u,d=(i={},null!=(r=e0(e,["config"]))&&(s=e0(r,["pageSize"]),void 0!==i&&null!=s&&eQ(i,["_query","pageSize"],s),a=e0(r,["pageToken"]),void 0!==i&&null!=a&&eQ(i,["_query","pageToken"],a),u=e0(r,["filter"]),void 0!==i&&null!=u&&eQ(i,["_query","filter"],u)),i);return o=eZ("batchPredictionJobs",d._url),l=d._query,delete d._url,delete d._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["nextPageToken"]);null!=i&&eQ(t,["nextPageToken"],i);let r=e0(e,["batchPredictionJobs"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>tH(e))),eQ(t,["batchJobs"],e)}return t}(e),n=new tp;return Object.assign(n,t),n})}{let t,n,s=(t={},null!=(n=e0(e,["config"]))&&function(e,t){let n=e0(e,["pageSize"]);void 0!==t&&null!=n&&eQ(t,["_query","pageSize"],n);let i=e0(e,["pageToken"]);if(void 0!==t&&null!=i&&eQ(t,["_query","pageToken"],i),void 0!==e0(e,["filter"]))throw Error("filter parameter is not supported in Gemini API.")}(n,t),t);return o=eZ("batches",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["nextPageToken"]);null!=i&&eQ(t,["nextPageToken"],i);let r=e0(e,["operations"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>tB(e))),eQ(t,["batchJobs"],e)}return t}(e),n=new tp;return Object.assign(n,t),n})}}async delete(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l=(o=this.apiClient,i={},null!=(r=e0(e,["name"]))&&eQ(i,["_url","name"],tG(o,r)),i);return s=eZ("batchPredictionJobs/{name}",l._url),a=l._query,delete l._url,delete l._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,r,o;return t={},null!=(n=e0(e,["sdkHttpResponse"]))&&eQ(t,["sdkHttpResponse"],n),null!=(i=e0(e,["name"]))&&eQ(t,["name"],i),null!=(r=e0(e,["done"]))&&eQ(t,["done"],r),null!=(o=e0(e,["error"]))&&eQ(t,["error"],o),t})}{let t,n,o=(l=this.apiClient,t={},null!=(n=e0(e,["name"]))&&eQ(t,["_url","name"],tG(l,n)),t);return s=eZ("batches/{name}",o._url),a=o._query,delete o._url,delete o._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,r,o;return t={},null!=(n=e0(e,["sdkHttpResponse"]))&&eQ(t,["sdkHttpResponse"],n),null!=(i=e0(e,["name"]))&&eQ(t,["name"],i),null!=(r=e0(e,["done"]))&&eQ(t,["done"],r),null!=(o=e0(e,["error"]))&&eQ(t,["error"],o),t})}}}function tW(e){let t={},n=e0(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s,a,u,d,p,c;return n={},null!=(i=e0(t=e,["videoMetadata"]))&&eQ(n,["videoMetadata"],i),null!=(r=e0(t,["thought"]))&&eQ(n,["thought"],r),null!=(o=e0(t,["inlineData"]))&&eQ(n,["inlineData"],function(e){let t={};if(void 0!==e0(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=e0(e,["data"]);null!=n&&eQ(t,["data"],n);let i=e0(e,["mimeType"]);return null!=i&&eQ(t,["mimeType"],i),t}(o)),null!=(l=e0(t,["fileData"]))&&eQ(n,["fileData"],function(e){let t={};if(void 0!==e0(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=e0(e,["fileUri"]);null!=n&&eQ(t,["fileUri"],n);let i=e0(e,["mimeType"]);return null!=i&&eQ(t,["mimeType"],i),t}(l)),null!=(s=e0(t,["thoughtSignature"]))&&eQ(n,["thoughtSignature"],s),null!=(a=e0(t,["functionCall"]))&&eQ(n,["functionCall"],a),null!=(u=e0(t,["codeExecutionResult"]))&&eQ(n,["codeExecutionResult"],u),null!=(d=e0(t,["executableCode"]))&&eQ(n,["executableCode"],d),null!=(p=e0(t,["functionResponse"]))&&eQ(n,["functionResponse"],p),null!=(c=e0(t,["text"]))&&eQ(n,["text"],c),n})),eQ(t,["parts"],e)}let i=e0(e,["role"]);return null!=i&&eQ(t,["role"],i),t}class tK extends eX{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new tJ(eW.PAGED_ITEM_CACHED_CONTENTS,e=>this.listInternal(e),await this.listInternal(e),e)}async create(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l,u=(o=this.apiClient,i={},null!=(r=e0(e,["model"]))&&eQ(i,["model"],tm(o,r)),null!=(l=e0(e,["config"]))&&function(e,t){let n=e0(e,["ttl"]);void 0!==t&&null!=n&&eQ(t,["ttl"],n);let i=e0(e,["expireTime"]);void 0!==t&&null!=i&&eQ(t,["expireTime"],i);let r=e0(e,["displayName"]);void 0!==t&&null!=r&&eQ(t,["displayName"],r);let o=e0(e,["contents"]);if(void 0!==t&&null!=o){let e=tS(o);Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["contents"],e)}let l=e0(e,["systemInstruction"]);void 0!==t&&null!=l&&eQ(t,["systemInstruction"],tO(l));let s=e0(e,["tools"]);if(void 0!==t&&null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=e0(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==e0(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let n=e0(e,["description"]);null!=n&&eQ(t,["description"],n);let i=e0(e,["name"]);null!=i&&eQ(t,["name"],i);let r=e0(e,["parameters"]);null!=r&&eQ(t,["parameters"],r);let o=e0(e,["parametersJsonSchema"]);null!=o&&eQ(t,["parametersJsonSchema"],o);let l=e0(e,["response"]);null!=l&&eQ(t,["response"],l);let s=e0(e,["responseJsonSchema"]);return null!=s&&eQ(t,["responseJsonSchema"],s),t})(e))),eQ(t,["functionDeclarations"],e)}let i=e0(e,["retrieval"]);null!=i&&eQ(t,["retrieval"],i);let r=e0(e,["googleSearch"]);null!=r&&eQ(t,["googleSearch"],r);let o=e0(e,["googleSearchRetrieval"]);null!=o&&eQ(t,["googleSearchRetrieval"],o);let l=e0(e,["enterpriseWebSearch"]);null!=l&&eQ(t,["enterpriseWebSearch"],l);let s=e0(e,["googleMaps"]);null!=s&&eQ(t,["googleMaps"],s);let a=e0(e,["urlContext"]);null!=a&&eQ(t,["urlContext"],a);let u=e0(e,["computerUse"]);null!=u&&eQ(t,["computerUse"],u);let d=e0(e,["codeExecution"]);return null!=d&&eQ(t,["codeExecution"],d),t})(e))),eQ(t,["tools"],e)}let a=e0(e,["toolConfig"]);void 0!==t&&null!=a&&eQ(t,["toolConfig"],a);let u=e0(e,["kmsKeyName"]);void 0!==t&&null!=u&&eQ(t,["encryption_spec","kmsKeyName"],u)}(l,i),i);return s=eZ("cachedContents",u._url),a=u._query,delete u._url,delete u._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,n,o,u=(l=this.apiClient,t={},null!=(n=e0(e,["model"]))&&eQ(t,["model"],tm(l,n)),null!=(o=e0(e,["config"]))&&function(e,t){let n=e0(e,["ttl"]);void 0!==t&&null!=n&&eQ(t,["ttl"],n);let i=e0(e,["expireTime"]);void 0!==t&&null!=i&&eQ(t,["expireTime"],i);let r=e0(e,["displayName"]);void 0!==t&&null!=r&&eQ(t,["displayName"],r);let o=e0(e,["contents"]);if(void 0!==t&&null!=o){let e=tS(o);Array.isArray(e)&&(e=e.map(e=>tW(e))),eQ(t,["contents"],e)}let l=e0(e,["systemInstruction"]);void 0!==t&&null!=l&&eQ(t,["systemInstruction"],tW(tO(l)));let s=e0(e,["tools"]);if(void 0!==t&&null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=e0(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["functionDeclarations"],e)}if(void 0!==e0(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=e0(e,["googleSearch"]);null!=i&&eQ(t,["googleSearch"],function(e){let t={},n=e0(e,["timeRangeFilter"]);if(null!=n&&eQ(t,["timeRangeFilter"],n),void 0!==e0(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(i));let r=e0(e,["googleSearchRetrieval"]);if(null!=r&&eQ(t,["googleSearchRetrieval"],r),void 0!==e0(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=e0(e,["googleMaps"]);null!=o&&eQ(t,["googleMaps"],function(e){let t={};if(void 0!==e0(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=e0(e,["enableWidget"]);return null!=n&&eQ(t,["enableWidget"],n),t}(o));let l=e0(e,["urlContext"]);null!=l&&eQ(t,["urlContext"],l);let s=e0(e,["computerUse"]);null!=s&&eQ(t,["computerUse"],s);let a=e0(e,["codeExecution"]);return null!=a&&eQ(t,["codeExecution"],a),t})(e))),eQ(t,["tools"],e)}let a=e0(e,["toolConfig"]);if(void 0!==t&&null!=a&&eQ(t,["toolConfig"],a),void 0!==e0(e,["kmsKeyName"]))throw Error("kmsKeyName parameter is not supported in Gemini API.")}(o,t),t);return s=eZ("cachedContents",u._url),a=u._query,delete u._url,delete u._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}}async get(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l=(o=this.apiClient,i={},null!=(r=e0(e,["name"]))&&eQ(i,["_url","name"],tU(o,r)),i);return s=eZ("{name}",l._url),a=l._query,delete l._url,delete l._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,n,o=(l=this.apiClient,t={},null!=(n=e0(e,["name"]))&&eQ(t,["_url","name"],tU(l,n)),t);return s=eZ("{name}",o._url),a=o._query,delete o._url,delete o._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l=(o=this.apiClient,i={},null!=(r=e0(e,["name"]))&&eQ(i,["_url","name"],tU(o,r)),i);return s=eZ("{name}",l._url),a=l._query,delete l._url,delete l._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=e0(e,["sdkHttpResponse"]))&&eQ(t,["sdkHttpResponse"],n),t),r=new tl;return Object.assign(r,i),r})}{let t,n,o=(l=this.apiClient,t={},null!=(n=e0(e,["name"]))&&eQ(t,["_url","name"],tU(l,n)),t);return s=eZ("{name}",o._url),a=o._query,delete o._url,delete o._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=e0(e,["sdkHttpResponse"]))&&eQ(t,["sdkHttpResponse"],n),t),r=new tl;return Object.assign(r,i),r})}}async update(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l,u,d,p=(o=this.apiClient,i={},null!=(r=e0(e,["name"]))&&eQ(i,["_url","name"],tU(o,r)),null!=(l=e0(e,["config"]))&&(u=e0(l,["ttl"]),void 0!==i&&null!=u&&eQ(i,["ttl"],u),d=e0(l,["expireTime"]),void 0!==i&&null!=d&&eQ(i,["expireTime"],d)),i);return s=eZ("{name}",p._url),a=p._query,delete p._url,delete p._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t,n,o,u,d,p=(l=this.apiClient,t={},null!=(n=e0(e,["name"]))&&eQ(t,["_url","name"],tU(l,n)),null!=(o=e0(e,["config"]))&&(u=e0(o,["ttl"]),void 0!==t&&null!=u&&eQ(t,["ttl"],u),d=e0(o,["expireTime"]),void 0!==t&&null!=d&&eQ(t,["expireTime"],d)),t);return s=eZ("{name}",p._url),a=p._query,delete p._url,delete p._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}}async listInternal(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i,r,s,a,u=(i={},null!=(r=e0(e,["config"]))&&(s=e0(r,["pageSize"]),void 0!==i&&null!=s&&eQ(i,["_query","pageSize"],s),a=e0(r,["pageToken"]),void 0!==i&&null!=a&&eQ(i,["_query","pageToken"],a)),i);return o=eZ("cachedContents",u._url),l=u._query,delete u._url,delete u._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["nextPageToken"]);null!=i&&eQ(t,["nextPageToken"],i);let r=e0(e,["cachedContents"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["cachedContents"],e)}return t}(e),n=new ts;return Object.assign(n,t),n})}{let t,n,s,a,u=(t={},null!=(n=e0(e,["config"]))&&(s=e0(n,["pageSize"]),void 0!==t&&null!=s&&eQ(t,["_query","pageSize"],s),a=e0(n,["pageToken"]),void 0!==t&&null!=a&&eQ(t,["_query","pageToken"],a)),t);return o=eZ("cachedContents",u._url),l=u._query,delete u._url,delete u._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["nextPageToken"]);null!=i&&eQ(t,["nextPageToken"],i);let r=e0(e,["cachedContents"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["cachedContents"],e)}return t}(e),n=new ts;return Object.assign(n,t),n})}}}function tz(e){return this instanceof tz?(this.v=e,this):new tz(e)}function tX(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(e,t||[]),o=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),i[Symbol.asyncIterator]=function(){return this},i;function l(e,t){r[e]&&(i[e]=function(t){return new Promise(function(n,i){o.push([e,t,n,i])>1||s(e,t)})},t&&(i[e]=t(i[e])))}function s(e,t){try{var n;(n=r[e](t)).value instanceof tz?Promise.resolve(n.value.v).then(a,u):d(o[0][2],n)}catch(e){d(o[0][3],e)}}function a(e){s("next",e)}function u(e){s("throw",e)}function d(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function tZ(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise(function(i,r){var o,l,s;o=i,l=r,s=(t=e[n](t)).done,Promise.resolve(t.value).then(function(e){o({value:e,done:s})},l)})}}}function tQ(e){if(void 0===e.parts||0===e.parts.length)return!1;for(let t of e.parts)if(void 0===t||0===Object.keys(t).length)return!1;return!0}function t0(e){if(void 0===e||0===e.length)return[];let t=[],n=e.length,i=0;for(;i<n;)if("user"===e[i].role)t.push(e[i]),i++;else{let r=[],o=!0;for(;i<n&&"model"===e[i].role;)r.push(e[i]),o&&!tQ(e[i])&&(o=!1),i++;o?t.push(...r):t.pop()}return t}"function"==typeof SuppressedError&&SuppressedError;class t1{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new t2(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class t2{constructor(e,t,n,i={},r=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=i,this.history=r,this.sendPromise=Promise.resolve(),function(e){if(0!==e.length){for(let t of e)if("user"!==t.role&&"model"!==t.role)throw Error(`Role must be user or model, but got ${t.role}.`)}}(r)}async sendMessage(e){var t;await this.sendPromise;let n=tO(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:null!=(t=e.config)?t:this.config});return this.sendPromise=(async()=>{var e,t,r;let o=await i,l=null==(t=null==(e=o.candidates)?void 0:e[0])?void 0:t.content,s=o.automaticFunctionCallingHistory,a=this.getHistory(!0).length,u=[];null!=s&&(u=null!=(r=s.slice(a))?r:[]),this.recordHistory(n,l?[l]:[],u)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var t;await this.sendPromise;let n=tO(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:null!=(t=e.config)?t:this.config});this.sendPromise=i.then(()=>void 0).catch(()=>void 0);let r=await i;return this.processStreamResponse(r,n)}getHistory(e=!1){return structuredClone(e?t0(this.history):this.history)}processStreamResponse(e,t){var n,i;return tX(this,arguments,function*(){var r,o,l,s;let a=[];try{for(var u,d=!0,p=tZ(e);!(r=(u=yield tz(p.next())).done);d=!0){if(s=u.value,d=!1,function(e){var t;if(void 0==e.candidates||0===e.candidates.length)return!1;let n=null==(t=e.candidates[0])?void 0:t.content;return void 0!==n&&tQ(n)}(s)){let e=null==(i=null==(n=s.candidates)?void 0:n[0])?void 0:i.content;void 0!==e&&a.push(e)}yield yield tz(s)}}catch(e){o={error:e}}finally{try{!d&&!r&&(l=p.return)&&(yield tz(l.call(p)))}finally{if(o)throw o.error}}this.recordHistory(t,a)})}recordHistory(e,t,n){let i=[];t.length>0&&t.every(e=>void 0!==e.role)?i=t:i.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...t0(n)):this.history.push(e),this.history.push(...i)}}class t6 extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,t6.prototype)}}class t4 extends eX{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new tJ(eW.PAGED_ITEM_FILES,e=>this.listInternal(e),await this.listInternal(e),e)}async upload(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(e=>e)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o,l,s,a,u=(o={},null!=(l=e0(e,["config"]))&&(s=e0(l,["pageSize"]),void 0!==o&&null!=s&&eQ(o,["_query","pageSize"],s),a=e0(l,["pageToken"]),void 0!==o&&null!=a&&eQ(o,["_query","pageToken"],a)),o);return i=eZ("files",u._url),r=u._query,delete u._url,delete u._query,this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(u),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["nextPageToken"]);null!=i&&eQ(t,["nextPageToken"],i);let r=e0(e,["files"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["files"],e)}return t}(e),n=new ta;return Object.assign(n,t),n})}}async createInternal(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o,l,s=(o={},null!=(l=e0(e,["file"]))&&eQ(o,["file"],l),o);return i=eZ("upload/v1beta/files",s._url),r=s._query,delete s._url,delete s._query,this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t,n,i=(t={},null!=(n=e0(e,["sdkHttpResponse"]))&&eQ(t,["sdkHttpResponse"],n),t),r=new tu;return Object.assign(r,i),r})}}async get(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o,l,s=(o={},null!=(l=e0(e,["name"]))&&eQ(o,["_url","file"],tD(l)),o);return i=eZ("files/{file}",s._url),r=s._query,delete s._url,delete s._query,this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o,l,s=(o={},null!=(l=e0(e,["name"]))&&eQ(o,["_url","file"],tD(l)),o);return i=eZ("files/{file}",s._url),r=s._query,delete s._url,delete s._query,this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=e0(e,["sdkHttpResponse"]))&&eQ(t,["sdkHttpResponse"],n),t),r=new td;return Object.assign(r,i),r})}}}function t8(e){let t={};if(void 0!==e0(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=e0(e,["data"]);null!=n&&eQ(t,["data"],n);let i=e0(e,["mimeType"]);return null!=i&&eQ(t,["mimeType"],i),t}function t3(e){let t={},n=e0(e,["voiceConfig"]);if(null!=n&&eQ(t,["voiceConfig"],n),void 0!==e0(e,["multiSpeakerVoiceConfig"]))throw Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");let i=e0(e,["languageCode"]);return null!=i&&eQ(t,["languageCode"],i),t}function t5(e){let t={},n=e0(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s,a,u,d,p,c;return n={},null!=(i=e0(t=e,["videoMetadata"]))&&eQ(n,["videoMetadata"],i),null!=(r=e0(t,["thought"]))&&eQ(n,["thought"],r),null!=(o=e0(t,["inlineData"]))&&eQ(n,["inlineData"],function(e){let t={};if(void 0!==e0(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=e0(e,["data"]);null!=n&&eQ(t,["data"],n);let i=e0(e,["mimeType"]);return null!=i&&eQ(t,["mimeType"],i),t}(o)),null!=(l=e0(t,["fileData"]))&&eQ(n,["fileData"],function(e){let t={};if(void 0!==e0(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=e0(e,["fileUri"]);null!=n&&eQ(t,["fileUri"],n);let i=e0(e,["mimeType"]);return null!=i&&eQ(t,["mimeType"],i),t}(l)),null!=(s=e0(t,["thoughtSignature"]))&&eQ(n,["thoughtSignature"],s),null!=(a=e0(t,["functionCall"]))&&eQ(n,["functionCall"],a),null!=(u=e0(t,["codeExecutionResult"]))&&eQ(n,["codeExecutionResult"],u),null!=(d=e0(t,["executableCode"]))&&eQ(n,["executableCode"],d),null!=(p=e0(t,["functionResponse"]))&&eQ(n,["functionResponse"],p),null!=(c=e0(t,["text"]))&&eQ(n,["text"],c),n})),eQ(t,["parts"],e)}let i=e0(e,["role"]);return null!=i&&eQ(t,["role"],i),t}function t9(e,t){let n={},i=e0(t,["model"]);null!=i&&eQ(n,["_url","model"],tf(e,i));let r=e0(t,["contents"]);if(null!=r){let e=tS(r);Array.isArray(e)&&(e=e.map(e=>t5(e))),eQ(n,["contents"],e)}let o=e0(t,["config"]);return null!=o&&eQ(n,["generationConfig"],function(e,t,n){let i={},r=e0(t,["systemInstruction"]);void 0!==n&&null!=r&&eQ(n,["systemInstruction"],t5(tO(r)));let o=e0(t,["temperature"]);null!=o&&eQ(i,["temperature"],o);let l=e0(t,["topP"]);null!=l&&eQ(i,["topP"],l);let s=e0(t,["topK"]);null!=s&&eQ(i,["topK"],s);let a=e0(t,["candidateCount"]);null!=a&&eQ(i,["candidateCount"],a);let u=e0(t,["maxOutputTokens"]);null!=u&&eQ(i,["maxOutputTokens"],u);let d=e0(t,["stopSequences"]);null!=d&&eQ(i,["stopSequences"],d);let p=e0(t,["responseLogprobs"]);null!=p&&eQ(i,["responseLogprobs"],p);let c=e0(t,["logprobs"]);null!=c&&eQ(i,["logprobs"],c);let h=e0(t,["presencePenalty"]);null!=h&&eQ(i,["presencePenalty"],h);let f=e0(t,["frequencyPenalty"]);null!=f&&eQ(i,["frequencyPenalty"],f);let m=e0(t,["seed"]);null!=m&&eQ(i,["seed"],m);let g=e0(t,["responseMimeType"]);null!=g&&eQ(i,["responseMimeType"],g);let y=e0(t,["responseSchema"]);null!=y&&eQ(i,["responseSchema"],tw(y));let v=e0(t,["responseJsonSchema"]);if(null!=v&&eQ(i,["responseJsonSchema"],v),void 0!==e0(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==e0(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let E=e0(t,["safetySettings"]);if(void 0!==n&&null!=E){let e=E;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==e0(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let n=e0(e,["category"]);null!=n&&eQ(t,["category"],n);let i=e0(e,["threshold"]);return null!=i&&eQ(t,["threshold"],i),t})(e))),eQ(n,["safetySettings"],e)}let A=e0(t,["tools"]);if(void 0!==n&&null!=A){let e=tx(A);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=e0(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["functionDeclarations"],e)}if(void 0!==e0(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=e0(e,["googleSearch"]);null!=i&&eQ(t,["googleSearch"],function(e){let t={},n=e0(e,["timeRangeFilter"]);if(null!=n&&eQ(t,["timeRangeFilter"],n),void 0!==e0(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(i));let r=e0(e,["googleSearchRetrieval"]);if(null!=r&&eQ(t,["googleSearchRetrieval"],r),void 0!==e0(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=e0(e,["googleMaps"]);null!=o&&eQ(t,["googleMaps"],function(e){let t={};if(void 0!==e0(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=e0(e,["enableWidget"]);return null!=n&&eQ(t,["enableWidget"],n),t}(o));let l=e0(e,["urlContext"]);null!=l&&eQ(t,["urlContext"],l);let s=e0(e,["computerUse"]);null!=s&&eQ(t,["computerUse"],s);let a=e0(e,["codeExecution"]);return null!=a&&eQ(t,["codeExecution"],a),t})(tN(e)))),eQ(n,["tools"],e)}let I=e0(t,["toolConfig"]);if(void 0!==n&&null!=I&&eQ(n,["toolConfig"],I),void 0!==e0(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let T=e0(t,["cachedContent"]);void 0!==n&&null!=T&&eQ(n,["cachedContent"],tU(e,T));let _=e0(t,["responseModalities"]);null!=_&&eQ(i,["responseModalities"],_);let b=e0(t,["mediaResolution"]);null!=b&&eQ(i,["mediaResolution"],b);let O=e0(t,["speechConfig"]);if(null!=O&&eQ(i,["speechConfig"],tR(O)),void 0!==e0(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let C=e0(t,["thinkingConfig"]);null!=C&&eQ(i,["thinkingConfig"],C);let S=e0(t,["imageConfig"]);return null!=S&&eQ(i,["imageConfig"],S),i}(e,o,n)),n}function t7(e,t){let n={},i=e0(t,["model"]);null!=i&&eQ(n,["_url","model"],tf(e,i));let r=e0(t,["contents"]);if(null!=r){let e=tS(r);Array.isArray(e)&&(e=e.map(e=>e)),eQ(n,["contents"],e)}let o=e0(t,["config"]);return null!=o&&eQ(n,["generationConfig"],function(e,t,n){let i={},r=e0(t,["systemInstruction"]);void 0!==n&&null!=r&&eQ(n,["systemInstruction"],tO(r));let o=e0(t,["temperature"]);null!=o&&eQ(i,["temperature"],o);let l=e0(t,["topP"]);null!=l&&eQ(i,["topP"],l);let s=e0(t,["topK"]);null!=s&&eQ(i,["topK"],s);let a=e0(t,["candidateCount"]);null!=a&&eQ(i,["candidateCount"],a);let u=e0(t,["maxOutputTokens"]);null!=u&&eQ(i,["maxOutputTokens"],u);let d=e0(t,["stopSequences"]);null!=d&&eQ(i,["stopSequences"],d);let p=e0(t,["responseLogprobs"]);null!=p&&eQ(i,["responseLogprobs"],p);let c=e0(t,["logprobs"]);null!=c&&eQ(i,["logprobs"],c);let h=e0(t,["presencePenalty"]);null!=h&&eQ(i,["presencePenalty"],h);let f=e0(t,["frequencyPenalty"]);null!=f&&eQ(i,["frequencyPenalty"],f);let m=e0(t,["seed"]);null!=m&&eQ(i,["seed"],m);let g=e0(t,["responseMimeType"]);null!=g&&eQ(i,["responseMimeType"],g);let y=e0(t,["responseSchema"]);null!=y&&eQ(i,["responseSchema"],tw(y));let v=e0(t,["responseJsonSchema"]);null!=v&&eQ(i,["responseJsonSchema"],v);let E=e0(t,["routingConfig"]);null!=E&&eQ(i,["routingConfig"],E);let A=e0(t,["modelSelectionConfig"]);null!=A&&eQ(i,["modelConfig"],A);let I=e0(t,["safetySettings"]);if(void 0!==n&&null!=I){let e=I;Array.isArray(e)&&(e=e.map(e=>e)),eQ(n,["safetySettings"],e)}let T=e0(t,["tools"]);if(void 0!==n&&null!=T){let e=tx(T);Array.isArray(e)&&(e=e.map(e=>np(tN(e)))),eQ(n,["tools"],e)}let _=e0(t,["toolConfig"]);void 0!==n&&null!=_&&eQ(n,["toolConfig"],_);let b=e0(t,["labels"]);void 0!==n&&null!=b&&eQ(n,["labels"],b);let O=e0(t,["cachedContent"]);void 0!==n&&null!=O&&eQ(n,["cachedContent"],tU(e,O));let C=e0(t,["responseModalities"]);null!=C&&eQ(i,["responseModalities"],C);let S=e0(t,["mediaResolution"]);null!=S&&eQ(i,["mediaResolution"],S);let w=e0(t,["speechConfig"]);null!=w&&eQ(i,["speechConfig"],nd(tR(w)));let R=e0(t,["audioTimestamp"]);null!=R&&eQ(i,["audioTimestamp"],R);let P=e0(t,["thinkingConfig"]);null!=P&&eQ(i,["thinkingConfig"],P);let N=e0(t,["imageConfig"]);return null!=N&&eQ(i,["imageConfig"],N),i}(e,o,n)),n}function ne(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["candidates"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=e0(e,["content"]);null!=n&&eQ(t,["content"],n);let i=e0(e,["citationMetadata"]);null!=i&&eQ(t,["citationMetadata"],function(e){let t={},n=e0(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["citations"],e)}return t}(i));let r=e0(e,["tokenCount"]);null!=r&&eQ(t,["tokenCount"],r);let o=e0(e,["finishReason"]);null!=o&&eQ(t,["finishReason"],o);let l=e0(e,["urlContextMetadata"]);null!=l&&eQ(t,["urlContextMetadata"],l);let s=e0(e,["avgLogprobs"]);null!=s&&eQ(t,["avgLogprobs"],s);let a=e0(e,["groundingMetadata"]);null!=a&&eQ(t,["groundingMetadata"],a);let u=e0(e,["index"]);null!=u&&eQ(t,["index"],u);let d=e0(e,["logprobsResult"]);null!=d&&eQ(t,["logprobsResult"],d);let p=e0(e,["safetyRatings"]);if(null!=p){let e=p;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["safetyRatings"],e)}return t})(e))),eQ(t,["candidates"],e)}let r=e0(e,["modelVersion"]);null!=r&&eQ(t,["modelVersion"],r);let o=e0(e,["promptFeedback"]);null!=o&&eQ(t,["promptFeedback"],o);let l=e0(e,["responseId"]);null!=l&&eQ(t,["responseId"],l);let s=e0(e,["usageMetadata"]);return null!=s&&eQ(t,["usageMetadata"],s),t}function nt(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["candidates"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["candidates"],e)}let r=e0(e,["createTime"]);null!=r&&eQ(t,["createTime"],r);let o=e0(e,["modelVersion"]);null!=o&&eQ(t,["modelVersion"],o);let l=e0(e,["promptFeedback"]);null!=l&&eQ(t,["promptFeedback"],l);let s=e0(e,["responseId"]);null!=s&&eQ(t,["responseId"],s);let a=e0(e,["usageMetadata"]);return null!=a&&eQ(t,["usageMetadata"],a),t}function nn(e){let t={},n=e0(e,["_self"]);null!=n&&eQ(t,["image"],ni(n));let i=e0(e,["raiFilteredReason"]);null!=i&&eQ(t,["raiFilteredReason"],i);let r=e0(e,["_self"]);null!=r&&eQ(t,["safetyAttributes"],nu(r));let o=e0(e,["prompt"]);return null!=o&&eQ(t,["enhancedPrompt"],o),t}function ni(e){let t={},n=e0(e,["gcsUri"]);null!=n&&eQ(t,["gcsUri"],n);let i=e0(e,["bytesBase64Encoded"]);null!=i&&eQ(t,["imageBytes"],e1(i));let r=e0(e,["mimeType"]);return null!=r&&eQ(t,["mimeType"],r),t}function nr(e){let t={};if(void 0!==e0(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");let n=e0(e,["imageBytes"]);null!=n&&eQ(t,["bytesBase64Encoded"],e1(n));let i=e0(e,["mimeType"]);return null!=i&&eQ(t,["mimeType"],i),t}function no(e){let t={},n=e0(e,["gcsUri"]);null!=n&&eQ(t,["gcsUri"],n);let i=e0(e,["imageBytes"]);null!=i&&eQ(t,["bytesBase64Encoded"],e1(i));let r=e0(e,["mimeType"]);return null!=r&&eQ(t,["mimeType"],r),t}function nl(e){var t;let n,i,r,o,l={},s=e0(e,["name"]);null!=s&&eQ(l,["name"],s);let a=e0(e,["displayName"]);null!=a&&eQ(l,["displayName"],a);let u=e0(e,["description"]);null!=u&&eQ(l,["description"],u);let d=e0(e,["version"]);null!=d&&eQ(l,["version"],d);let p=e0(e,["_self"]);null!=p&&eQ(l,["tunedModelInfo"],(n={},null!=(i=e0(t=p,["baseModel"]))&&eQ(n,["baseModel"],i),null!=(r=e0(t,["createTime"]))&&eQ(n,["createTime"],r),null!=(o=e0(t,["updateTime"]))&&eQ(n,["updateTime"],o),n));let c=e0(e,["inputTokenLimit"]);null!=c&&eQ(l,["inputTokenLimit"],c);let h=e0(e,["outputTokenLimit"]);null!=h&&eQ(l,["outputTokenLimit"],h);let f=e0(e,["supportedGenerationMethods"]);return null!=f&&eQ(l,["supportedActions"],f),l}function ns(e){var t;let n,i,r,o,l={},s=e0(e,["name"]);null!=s&&eQ(l,["name"],s);let a=e0(e,["displayName"]);null!=a&&eQ(l,["displayName"],a);let u=e0(e,["description"]);null!=u&&eQ(l,["description"],u);let d=e0(e,["versionId"]);null!=d&&eQ(l,["version"],d);let p=e0(e,["deployedModels"]);if(null!=p){let e=p;Array.isArray(e)&&(e=e.map(e=>{let t,n,i;return t={},null!=(n=e0(e,["endpoint"]))&&eQ(t,["name"],n),null!=(i=e0(e,["deployedModelId"]))&&eQ(t,["deployedModelId"],i),t})),eQ(l,["endpoints"],e)}let c=e0(e,["labels"]);null!=c&&eQ(l,["labels"],c);let h=e0(e,["_self"]);null!=h&&eQ(l,["tunedModelInfo"],(n={},null!=(i=e0(t=h,["labels","google-vertex-llm-tuning-base-model-id"]))&&eQ(n,["baseModel"],i),null!=(r=e0(t,["createTime"]))&&eQ(n,["createTime"],r),null!=(o=e0(t,["updateTime"]))&&eQ(n,["updateTime"],o),n));let f=e0(e,["defaultCheckpointId"]);null!=f&&eQ(l,["defaultCheckpointId"],f);let m=e0(e,["checkpoints"]);if(null!=m){let e=m;Array.isArray(e)&&(e=e.map(e=>e)),eQ(l,["checkpoints"],e)}return l}function na(e){let t={},n=e0(e,["safetyAttributes","categories"]);null!=n&&eQ(t,["categories"],n);let i=e0(e,["safetyAttributes","scores"]);null!=i&&eQ(t,["scores"],i);let r=e0(e,["contentType"]);return null!=r&&eQ(t,["contentType"],r),t}function nu(e){let t={},n=e0(e,["safetyAttributes","categories"]);null!=n&&eQ(t,["categories"],n);let i=e0(e,["safetyAttributes","scores"]);null!=i&&eQ(t,["scores"],i);let r=e0(e,["contentType"]);return null!=r&&eQ(t,["contentType"],r),t}function nd(e){let t={},n=e0(e,["voiceConfig"]);if(null!=n&&eQ(t,["voiceConfig"],n),void 0!==e0(e,["multiSpeakerVoiceConfig"]))throw Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");let i=e0(e,["languageCode"]);return null!=i&&eQ(t,["languageCode"],i),t}function np(e){let t={},n=e0(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==e0(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let n=e0(e,["description"]);null!=n&&eQ(t,["description"],n);let i=e0(e,["name"]);null!=i&&eQ(t,["name"],i);let r=e0(e,["parameters"]);null!=r&&eQ(t,["parameters"],r);let o=e0(e,["parametersJsonSchema"]);null!=o&&eQ(t,["parametersJsonSchema"],o);let l=e0(e,["response"]);null!=l&&eQ(t,["response"],l);let s=e0(e,["responseJsonSchema"]);return null!=s&&eQ(t,["responseJsonSchema"],s),t})(e))),eQ(t,["functionDeclarations"],e)}let i=e0(e,["retrieval"]);null!=i&&eQ(t,["retrieval"],i);let r=e0(e,["googleSearch"]);null!=r&&eQ(t,["googleSearch"],r);let o=e0(e,["googleSearchRetrieval"]);null!=o&&eQ(t,["googleSearchRetrieval"],o);let l=e0(e,["enterpriseWebSearch"]);null!=l&&eQ(t,["enterpriseWebSearch"],l);let s=e0(e,["googleMaps"]);null!=s&&eQ(t,["googleMaps"],s);let a=e0(e,["urlContext"]);null!=a&&eQ(t,["urlContext"],a);let u=e0(e,["computerUse"]);null!=u&&eQ(t,["computerUse"],u);let d=e0(e,["codeExecution"]);return null!=d&&eQ(t,["codeExecution"],d),t}function nc(e){let t={},n=e0(e,["uri"]);null!=n&&eQ(t,["uri"],n);let i=e0(e,["videoBytes"]);null!=i&&eQ(t,["encodedVideo"],e1(i));let r=e0(e,["mimeType"]);return null!=r&&eQ(t,["encoding"],r),t}function nh(e){let t={},n=e0(e,["uri"]);null!=n&&eQ(t,["gcsUri"],n);let i=e0(e,["videoBytes"]);null!=i&&eQ(t,["bytesBase64Encoded"],e1(i));let r=e0(e,["mimeType"]);return null!=r&&eQ(t,["mimeType"],r),t}let nf="x-goog-api-client",nm=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class ng{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=null!=(t=this.clientOptions.apiVersion)?t:"v1beta1",i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=null!=(n=this.clientOptions.apiVersion)?n:"v1beta",i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&"global"!==this.clientOptions.location?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return null!=(e=this.clientOptions.vertexai)&&e}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.apiVersion)return this.clientOptions.httpOptions.apiVersion;throw Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.baseUrl)return this.clientOptions.httpOptions.baseUrl;throw Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.headers)return this.clientOptions.httpOptions.headers;throw Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||void 0===e.baseUrl||void 0===e.apiVersion)throw Error("HTTP options are not correctly set.");let t=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&""!==e.apiVersion&&t.push(e.apiVersion),t.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=new URL(this.getBaseUrl());return e.protocol="http:"==e.protocol?"ws":"wss",e.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw Error("HTTP options are not correctly set.")}constructUrl(e,t,n){let i=[this.getRequestUrlInternal(t)];return n&&i.push(this.getBaseResourcePath()),""!==e&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||"GET"===e.httpMethod&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[t,n]of Object.entries(e.queryParams))i.searchParams.append(t,String(n));let r={};if("GET"===e.httpMethod){if(e.body&&"{}"!==e.body)throw Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,t,e.abortSignal),this.unaryApiCall(i,r,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[e,i]of Object.entries(t))"object"==typeof i?n[e]=Object.assign(Object.assign({},n[e]),i):void 0!==i&&(n[e]=i);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,n);i.searchParams.has("alt")&&"sse"===i.searchParams.get("alt")||i.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,t,e.abortSignal),this.streamApiCall(i,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n){if(t&&t.timeout||n){let i=new AbortController,r=i.signal;if(t.timeout&&(null==t?void 0:t.timeout)>0){let e=setTimeout(()=>i.abort(),t.timeout);e&&"function"==typeof e.unref&&e.unref()}n&&n.addEventListener("abort",()=>{i.abort()}),e.signal=r}return t&&null!==t.extraBody&&function(e,t){if(!t||0===Object.keys(t).length)return;if(e.body instanceof Blob)return console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");let n={};if("string"==typeof e.body&&e.body.length>0)try{let t=JSON.parse(e.body);if("object"!=typeof t||null===t||Array.isArray(t))return void console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");n=t}catch(e){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}e.body=JSON.stringify(function e(t,n){let i=Object.assign({},t);for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],o=i[t];r&&"object"==typeof r&&!Array.isArray(r)&&o&&"object"==typeof o&&!Array.isArray(o)?i[t]=e(o,r):(o&&r&&typeof o!=typeof r&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${t}". Original type: ${typeof o}, New type: ${typeof r}. Overwriting.`),i[t]=r)}return i}(n,t))}(e,t.extraBody),e.headers=await this.getHeadersInternal(t),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await ny(e),new e2(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await ny(e),this.processStreamResponse(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}processStreamResponse(e){var t;return tX(this,arguments,function*(){let n=null==(t=null==e?void 0:e.body)?void 0:t.getReader(),i=new TextDecoder("utf-8");if(!n)throw Error("Response body is empty");try{let t="";for(;;){let{done:r,value:o}=yield tz(n.read());if(r){if(t.trim().length>0)throw Error("Incomplete JSON segment at the end");break}let l=i.decode(o,{stream:!0});try{let e=JSON.parse(l);if("error"in e){let t=JSON.parse(JSON.stringify(e.error)),n=t.status,i=t.code,r=`got status: ${n}. ${JSON.stringify(e)}`;if(i>=400&&i<600)throw new t6({message:r,status:i})}}catch(e){if("ApiError"===e.name)throw e}let s=(t+=l).match(nm);for(;s;){let n=s[1];try{let i=new Response(n,{headers:null==e?void 0:e.headers,status:null==e?void 0:e.status,statusText:null==e?void 0:e.statusText});yield yield tz(new e2(i)),s=(t=t.slice(s[0].length)).match(nm)}catch(e){throw Error(`exception parsing stream chunk ${n}. ${e}`)}}}}finally{n.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(e=>{throw Error(`exception ${e} sending request`)})}getDefaultHeaders(){let e={},t="google-genai-sdk/1.26.0 "+this.clientOptions.userAgentExtra;return e["User-Agent"]=t,e[nf]=t,e["Content-Type"]="application/json",e}async getHeadersInternal(e){let t=new Headers;if(e&&e.headers){for(let[n,i]of Object.entries(e.headers))t.append(n,i);e.timeout&&e.timeout>0&&t.append("X-Server-Timeout",String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(t),t}async uploadFile(e,t){var n;let i={};null!=t&&(i.mimeType=t.mimeType,i.name=t.name,i.displayName=t.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);let r=this.clientOptions.uploader,o=await r.stat(e);i.sizeBytes=String(o.size);let l=null!=(n=null==t?void 0:t.mimeType)?n:o.type;if(void 0===l||""===l)throw Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=l;let s=await this.fetchUploadUrl(i,t);return r.upload(e,s,this)}async downloadFile(e){let t=this.clientOptions.downloader;await t.download(e,this)}async fetchUploadUrl(e,t){var n;let i={};i=(null==t?void 0:t.httpOptions)?t.httpOptions:{apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};let r={file:e},o=await this.request({path:eZ("upload/v1beta/files",r._url),body:JSON.stringify(r),httpMethod:"POST",httpOptions:i});if(!o||!(null==o?void 0:o.headers))throw Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let l=null==(n=null==o?void 0:o.headers)?void 0:n["x-goog-upload-url"];if(void 0===l)throw Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return l}}async function ny(e){var t;if(void 0===e)throw Error("response is undefined");if(!e.ok){let n=e.status,i=JSON.stringify((null==(t=e.headers.get("content-type"))?void 0:t.includes("application/json"))?await e.json():{error:{message:await e.text(),code:e.status,status:e.statusText}});if(n>=400&&n<600)throw new t6({message:i,status:n});throw Error(i)}}function nv(e){for(let n of e){var t;if(null!==(t=n)&&"object"==typeof t&&t instanceof nA||"object"==typeof n&&"inputSchema"in n)return!0}return!1}function nE(e){var t;let n=null!=(t=e[nf])?t:"";e[nf]=(n+" mcp_used/unknown").trimStart()}class nA{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new nA(e,t)}async initialize(){var e,t,n,i;if(this.mcpTools.length>0)return;let r={},o=[];for(let u of this.mcpClients)try{for(var l,s=!0,a=(t=void 0,tZ(function(e,t=100){return tX(this,arguments,function*(){let n,i=0;for(;i<t;){let t=yield tz(e.listTools({cursor:n}));for(let e of t.tools)yield yield tz(e),i++;if(!t.nextCursor)break;n=t.nextCursor}})}(u)));!(e=(l=await a.next()).done);s=!0){i=l.value,s=!1,o.push(i);let e=i.name;if(r[e])throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);r[e]=u}}catch(e){t={error:e}}finally{try{!s&&!e&&(n=a.return)&&await n.call(a)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),function(e,t={}){let n=[],i=new Set;for(let r of e){let e=r.name;if(i.has(e))throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);i.add(e);let o=function(e,t={}){let n={name:e.name,description:e.description,parametersJsonSchema:e.inputSchema};return e.outputSchema&&(n.responseJsonSchema=e.outputSchema),t.behavior&&(n.behavior=t.behavior),{functionDeclarations:[n]}}(r,t);o.functionDeclarations&&n.push(...o.functionDeclarations)}return{functionDeclarations:n}}(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let e,i=this.functionNameToMcpClient[n.name];this.config.timeout&&(e={timeout:this.config.timeout});let r=await i.callTool({name:n.name,arguments:n.args},void 0,e);t.push({functionResponse:{name:n.name,response:r.isError?{error:r}:r}})}return t}}async function nI(e,t,n){let i=new th;Object.assign(i,n.data instanceof Blob?JSON.parse(await n.data.text()):JSON.parse(n.data)),t(i)}class nT{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;let i;if(this.apiClient.isVertexAI())throw Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let r=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),l=function(e){let t=new Headers;for(let[n,i]of Object.entries(e))t.append(n,i);return t}(this.apiClient.getDefaultHeaders()),s=this.apiClient.getApiKey(),a=`${r}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${s}`,u=()=>{},d=new Promise(e=>{u=e}),p=e.callbacks,c=this.apiClient,h={onopen:function(){u({})},onmessage:e=>{nI(c,p.onmessage,e)},onerror:null!=(t=null==p?void 0:p.onerror)?t:function(e){},onclose:null!=(n=null==p?void 0:p.onclose)?n:function(e){}},f=this.webSocketFactory.create(a,(i={},l.forEach((e,t)=>{i[t]=e}),i),h);f.connect(),await d;let m=tf(this.apiClient,e.model);return f.send(JSON.stringify({setup:{model:m}})),new n_(f,this.apiClient)}}class n_{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||0===Object.keys(e.weightedPrompts).length)throw Error("Weighted prompts must be set and contain at least one entry.");let t=function(e){let t={},n=e0(e,["weightedPrompts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["weightedPrompts"],e)}return t}(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){let t,n;e.musicGenerationConfig||(e.musicGenerationConfig={});let i=(t={},null!=(n=e0(e,["musicGenerationConfig"]))&&eQ(t,["musicGenerationConfig"],n),t);this.conn.send(JSON.stringify(i))}sendPlaybackControl(e){this.conn.send(JSON.stringify({playbackControl:e}))}play(){this.sendPlaybackControl(eY.PLAY)}pause(){this.sendPlaybackControl(eY.PAUSE)}stop(){this.sendPlaybackControl(eY.STOP)}resetContext(){this.sendPlaybackControl(eY.RESET_CONTEXT)}close(){this.conn.close()}}async function nb(e,t,n){let i=new tc,r=JSON.parse(n.data instanceof Blob?await n.data.text():n.data instanceof ArrayBuffer?new TextDecoder().decode(n.data):n.data);if(e.isVertexAI()){let e,t,n,o,l,s,a,u;Object.assign(i,(e={},null!=(t=e0(r,["setupComplete"]))&&eQ(e,["setupComplete"],t),null!=(n=e0(r,["serverContent"]))&&eQ(e,["serverContent"],n),null!=(o=e0(r,["toolCall"]))&&eQ(e,["toolCall"],o),null!=(l=e0(r,["toolCallCancellation"]))&&eQ(e,["toolCallCancellation"],l),null!=(s=e0(r,["usageMetadata"]))&&eQ(e,["usageMetadata"],function(e){let t={},n=e0(e,["promptTokenCount"]);null!=n&&eQ(t,["promptTokenCount"],n);let i=e0(e,["cachedContentTokenCount"]);null!=i&&eQ(t,["cachedContentTokenCount"],i);let r=e0(e,["candidatesTokenCount"]);null!=r&&eQ(t,["responseTokenCount"],r);let o=e0(e,["toolUsePromptTokenCount"]);null!=o&&eQ(t,["toolUsePromptTokenCount"],o);let l=e0(e,["thoughtsTokenCount"]);null!=l&&eQ(t,["thoughtsTokenCount"],l);let s=e0(e,["totalTokenCount"]);null!=s&&eQ(t,["totalTokenCount"],s);let a=e0(e,["promptTokensDetails"]);if(null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["promptTokensDetails"],e)}let u=e0(e,["cacheTokensDetails"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["cacheTokensDetails"],e)}let d=e0(e,["candidatesTokensDetails"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["responseTokensDetails"],e)}let p=e0(e,["toolUsePromptTokensDetails"]);if(null!=p){let e=p;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["toolUsePromptTokensDetails"],e)}let c=e0(e,["trafficType"]);return null!=c&&eQ(t,["trafficType"],c),t}(s)),null!=(a=e0(r,["goAway"]))&&eQ(e,["goAway"],a),null!=(u=e0(r,["sessionResumptionUpdate"]))&&eQ(e,["sessionResumptionUpdate"],u),e))}else Object.assign(i,r);t(i)}class nO{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new nT(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,i,r,o,l,s,a;let u,d;if(e.config&&e.config.httpOptions)throw Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let p=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion(),h=this.apiClient.getHeaders();e.config&&e.config.tools&&nv(e.config.tools)&&nE(h);let f=function(e){let t=new Headers;for(let[n,i]of Object.entries(e))t.append(n,i);return t}(h);if(this.apiClient.isVertexAI())u=`${p}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(f);else{let e=this.apiClient.getApiKey(),t="BidiGenerateContent",n="key";(null==e?void 0:e.startsWith("auth_tokens/"))&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),"v1alpha"!==c&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),t="BidiGenerateContentConstrained",n="access_token"),u=`${p}/ws/google.ai.generativelanguage.${c}.GenerativeService.${t}?${n}=${e}`}let m=()=>{},g=new Promise(e=>{m=e}),y=e.callbacks,v=this.apiClient,E={onopen:function(){var e;null==(e=null==y?void 0:y.onopen)||e.call(y),m({})},onmessage:e=>{nb(v,y.onmessage,e)},onerror:null!=(t=null==y?void 0:y.onerror)?t:function(e){},onclose:null!=(n=null==y?void 0:y.onclose)?n:function(e){}},A=this.webSocketFactory.create(u,(d={},f.forEach((e,t)=>{d[t]=e}),d),E);A.connect(),await g;let I=tf(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&I.startsWith("publishers/")){let e=this.apiClient.getProject(),t=this.apiClient.getLocation();I=`projects/${e}/locations/${t}/`+I}let T={};this.apiClient.isVertexAI()&&(null==(i=e.config)?void 0:i.responseModalities)===void 0&&(void 0===e.config?e.config={responseModalities:[em.AUDIO]}:e.config.responseModalities=[em.AUDIO]),(null==(r=e.config)?void 0:r.generationConfig)&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let _=null!=(l=null==(o=e.config)?void 0:o.tools)?l:[],b=[];for(let e of _)this.isCallableTool(e)?b.push(await e.tool()):b.push(e);b.length>0&&(e.config.tools=b);let O={model:I,config:e.config,callbacks:e.callbacks};if(this.apiClient.isVertexAI()){let e,t,n;s=this.apiClient,e={},null!=(t=e0(O,["model"]))&&eQ(e,["setup","model"],tf(s,t)),null!=(n=e0(O,["config"]))&&eQ(e,["config"],function(e,t){let n=e0(e,["generationConfig"]);void 0!==t&&null!=n&&eQ(t,["setup","generationConfig"],function(e){let t={},n=e0(e,["modelSelectionConfig"]);null!=n&&eQ(t,["modelConfig"],n);let i=e0(e,["audioTimestamp"]);null!=i&&eQ(t,["audioTimestamp"],i);let r=e0(e,["candidateCount"]);null!=r&&eQ(t,["candidateCount"],r);let o=e0(e,["enableAffectiveDialog"]);null!=o&&eQ(t,["enableAffectiveDialog"],o);let l=e0(e,["frequencyPenalty"]);null!=l&&eQ(t,["frequencyPenalty"],l);let s=e0(e,["logprobs"]);null!=s&&eQ(t,["logprobs"],s);let a=e0(e,["maxOutputTokens"]);null!=a&&eQ(t,["maxOutputTokens"],a);let u=e0(e,["mediaResolution"]);null!=u&&eQ(t,["mediaResolution"],u);let d=e0(e,["presencePenalty"]);null!=d&&eQ(t,["presencePenalty"],d);let p=e0(e,["responseJsonSchema"]);null!=p&&eQ(t,["responseJsonSchema"],p);let c=e0(e,["responseLogprobs"]);null!=c&&eQ(t,["responseLogprobs"],c);let h=e0(e,["responseMimeType"]);null!=h&&eQ(t,["responseMimeType"],h);let f=e0(e,["responseModalities"]);null!=f&&eQ(t,["responseModalities"],f);let m=e0(e,["responseSchema"]);null!=m&&eQ(t,["responseSchema"],m);let g=e0(e,["routingConfig"]);null!=g&&eQ(t,["routingConfig"],g);let y=e0(e,["seed"]);null!=y&&eQ(t,["seed"],y);let v=e0(e,["speechConfig"]);null!=v&&eQ(t,["speechConfig"],t3(v));let E=e0(e,["stopSequences"]);null!=E&&eQ(t,["stopSequences"],E);let A=e0(e,["temperature"]);null!=A&&eQ(t,["temperature"],A);let I=e0(e,["thinkingConfig"]);null!=I&&eQ(t,["thinkingConfig"],I);let T=e0(e,["topK"]);null!=T&&eQ(t,["topK"],T);let _=e0(e,["topP"]);if(null!=_&&eQ(t,["topP"],_),void 0!==e0(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(n));let i=e0(e,["responseModalities"]);void 0!==t&&null!=i&&eQ(t,["setup","generationConfig","responseModalities"],i);let r=e0(e,["temperature"]);void 0!==t&&null!=r&&eQ(t,["setup","generationConfig","temperature"],r);let o=e0(e,["topP"]);void 0!==t&&null!=o&&eQ(t,["setup","generationConfig","topP"],o);let l=e0(e,["topK"]);void 0!==t&&null!=l&&eQ(t,["setup","generationConfig","topK"],l);let s=e0(e,["maxOutputTokens"]);void 0!==t&&null!=s&&eQ(t,["setup","generationConfig","maxOutputTokens"],s);let a=e0(e,["mediaResolution"]);void 0!==t&&null!=a&&eQ(t,["setup","generationConfig","mediaResolution"],a);let u=e0(e,["seed"]);void 0!==t&&null!=u&&eQ(t,["setup","generationConfig","seed"],u);let d=e0(e,["speechConfig"]);void 0!==t&&null!=d&&eQ(t,["setup","generationConfig","speechConfig"],t3(tP(d)));let p=e0(e,["thinkingConfig"]);void 0!==t&&null!=p&&eQ(t,["setup","generationConfig","thinkingConfig"],p);let c=e0(e,["enableAffectiveDialog"]);void 0!==t&&null!=c&&eQ(t,["setup","generationConfig","enableAffectiveDialog"],c);let h=e0(e,["systemInstruction"]);void 0!==t&&null!=h&&eQ(t,["setup","systemInstruction"],tO(h));let f=e0(e,["tools"]);if(void 0!==t&&null!=f){let e=tx(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=e0(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==e0(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let n=e0(e,["description"]);null!=n&&eQ(t,["description"],n);let i=e0(e,["name"]);null!=i&&eQ(t,["name"],i);let r=e0(e,["parameters"]);null!=r&&eQ(t,["parameters"],r);let o=e0(e,["parametersJsonSchema"]);null!=o&&eQ(t,["parametersJsonSchema"],o);let l=e0(e,["response"]);null!=l&&eQ(t,["response"],l);let s=e0(e,["responseJsonSchema"]);return null!=s&&eQ(t,["responseJsonSchema"],s),t})(e))),eQ(t,["functionDeclarations"],e)}let i=e0(e,["retrieval"]);null!=i&&eQ(t,["retrieval"],i);let r=e0(e,["googleSearch"]);null!=r&&eQ(t,["googleSearch"],r);let o=e0(e,["googleSearchRetrieval"]);null!=o&&eQ(t,["googleSearchRetrieval"],o);let l=e0(e,["enterpriseWebSearch"]);null!=l&&eQ(t,["enterpriseWebSearch"],l);let s=e0(e,["googleMaps"]);null!=s&&eQ(t,["googleMaps"],s);let a=e0(e,["urlContext"]);null!=a&&eQ(t,["urlContext"],a);let u=e0(e,["computerUse"]);null!=u&&eQ(t,["computerUse"],u);let d=e0(e,["codeExecution"]);return null!=d&&eQ(t,["codeExecution"],d),t})(tN(e)))),eQ(t,["setup","tools"],e)}let m=e0(e,["sessionResumption"]);void 0!==t&&null!=m&&eQ(t,["setup","sessionResumption"],m);let g=e0(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&eQ(t,["setup","inputAudioTranscription"],g);let y=e0(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&eQ(t,["setup","outputAudioTranscription"],y);let v=e0(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&eQ(t,["setup","realtimeInputConfig"],v);let E=e0(e,["contextWindowCompression"]);void 0!==t&&null!=E&&eQ(t,["setup","contextWindowCompression"],E);let A=e0(e,["proactivity"]);return void 0!==t&&null!=A&&eQ(t,["setup","proactivity"],A),{}}(n,e)),T=e}else{let e,t,n;a=this.apiClient,e={},null!=(t=e0(O,["model"]))&&eQ(e,["setup","model"],tf(a,t)),null!=(n=e0(O,["config"]))&&eQ(e,["config"],function(e,t){let n=e0(e,["generationConfig"]);void 0!==t&&null!=n&&eQ(t,["setup","generationConfig"],n);let i=e0(e,["responseModalities"]);void 0!==t&&null!=i&&eQ(t,["setup","generationConfig","responseModalities"],i);let r=e0(e,["temperature"]);void 0!==t&&null!=r&&eQ(t,["setup","generationConfig","temperature"],r);let o=e0(e,["topP"]);void 0!==t&&null!=o&&eQ(t,["setup","generationConfig","topP"],o);let l=e0(e,["topK"]);void 0!==t&&null!=l&&eQ(t,["setup","generationConfig","topK"],l);let s=e0(e,["maxOutputTokens"]);void 0!==t&&null!=s&&eQ(t,["setup","generationConfig","maxOutputTokens"],s);let a=e0(e,["mediaResolution"]);void 0!==t&&null!=a&&eQ(t,["setup","generationConfig","mediaResolution"],a);let u=e0(e,["seed"]);void 0!==t&&null!=u&&eQ(t,["setup","generationConfig","seed"],u);let d=e0(e,["speechConfig"]);void 0!==t&&null!=d&&eQ(t,["setup","generationConfig","speechConfig"],tP(d));let p=e0(e,["thinkingConfig"]);void 0!==t&&null!=p&&eQ(t,["setup","generationConfig","thinkingConfig"],p);let c=e0(e,["enableAffectiveDialog"]);void 0!==t&&null!=c&&eQ(t,["setup","generationConfig","enableAffectiveDialog"],c);let h=e0(e,["systemInstruction"]);void 0!==t&&null!=h&&eQ(t,["setup","systemInstruction"],function(e){let t={},n=e0(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s,a,u,d,p,c;return n={},null!=(i=e0(t=e,["videoMetadata"]))&&eQ(n,["videoMetadata"],i),null!=(r=e0(t,["thought"]))&&eQ(n,["thought"],r),null!=(o=e0(t,["inlineData"]))&&eQ(n,["inlineData"],t8(o)),null!=(l=e0(t,["fileData"]))&&eQ(n,["fileData"],function(e){let t={};if(void 0!==e0(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=e0(e,["fileUri"]);null!=n&&eQ(t,["fileUri"],n);let i=e0(e,["mimeType"]);return null!=i&&eQ(t,["mimeType"],i),t}(l)),null!=(s=e0(t,["thoughtSignature"]))&&eQ(n,["thoughtSignature"],s),null!=(a=e0(t,["functionCall"]))&&eQ(n,["functionCall"],a),null!=(u=e0(t,["codeExecutionResult"]))&&eQ(n,["codeExecutionResult"],u),null!=(d=e0(t,["executableCode"]))&&eQ(n,["executableCode"],d),null!=(p=e0(t,["functionResponse"]))&&eQ(n,["functionResponse"],p),null!=(c=e0(t,["text"]))&&eQ(n,["text"],c),n})),eQ(t,["parts"],e)}let i=e0(e,["role"]);return null!=i&&eQ(t,["role"],i),t}(tO(h)));let f=e0(e,["tools"]);if(void 0!==t&&null!=f){let e=tx(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=e0(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["functionDeclarations"],e)}if(void 0!==e0(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=e0(e,["googleSearch"]);null!=i&&eQ(t,["googleSearch"],function(e){let t={},n=e0(e,["timeRangeFilter"]);if(null!=n&&eQ(t,["timeRangeFilter"],n),void 0!==e0(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(i));let r=e0(e,["googleSearchRetrieval"]);if(null!=r&&eQ(t,["googleSearchRetrieval"],r),void 0!==e0(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=e0(e,["googleMaps"]);null!=o&&eQ(t,["googleMaps"],function(e){let t={};if(void 0!==e0(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=e0(e,["enableWidget"]);return null!=n&&eQ(t,["enableWidget"],n),t}(o));let l=e0(e,["urlContext"]);null!=l&&eQ(t,["urlContext"],l);let s=e0(e,["computerUse"]);null!=s&&eQ(t,["computerUse"],s);let a=e0(e,["codeExecution"]);return null!=a&&eQ(t,["codeExecution"],a),t})(tN(e)))),eQ(t,["setup","tools"],e)}let m=e0(e,["sessionResumption"]);void 0!==t&&null!=m&&eQ(t,["setup","sessionResumption"],function(e){let t={},n=e0(e,["handle"]);if(null!=n&&eQ(t,["handle"],n),void 0!==e0(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(m));let g=e0(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&eQ(t,["setup","inputAudioTranscription"],g);let y=e0(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&eQ(t,["setup","outputAudioTranscription"],y);let v=e0(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&eQ(t,["setup","realtimeInputConfig"],v);let E=e0(e,["contextWindowCompression"]);void 0!==t&&null!=E&&eQ(t,["setup","contextWindowCompression"],E);let A=e0(e,["proactivity"]);return void 0!==t&&null!=A&&eQ(t,["setup","proactivity"],A),{}}(n,e)),T=e}return delete T.config,A.send(JSON.stringify(T)),new nS(A,this.apiClient)}isCallableTool(e){return"callTool"in e&&"function"==typeof e.callTool}}let nC={turnComplete:!0};class nS{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(null!==t.turns&&void 0!==t.turns){let n=[];try{n=tS(t.turns),e.isVertexAI()||(n=n.map(e=>t5(e)))}catch(e){throw Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(null==t.functionResponses||0===(n=Array.isArray(t.functionResponses)?t.functionResponses:[t.functionResponses]).length)throw Error("functionResponses is required.");for(let t of n){if("object"!=typeof t||null===t||!("name"in t)||!("response"in t))throw Error(`Could not parse function response, type '${typeof t}'.`);if(!e.isVertexAI()&&!("id"in t))throw Error("FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.")}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},nC),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};t=this.apiClient.isVertexAI()?{realtimeInput:function(e){let t={},n=e0(e,["media"]);if(null!=n){let e=tg(n);Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["mediaChunks"],e)}let i=e0(e,["audio"]);null!=i&&eQ(t,["audio"],tE(i));let r=e0(e,["audioStreamEnd"]);null!=r&&eQ(t,["audioStreamEnd"],r);let o=e0(e,["video"]);null!=o&&eQ(t,["video"],tv(o));let l=e0(e,["text"]);null!=l&&eQ(t,["text"],l);let s=e0(e,["activityStart"]);null!=s&&eQ(t,["activityStart"],s);let a=e0(e,["activityEnd"]);return null!=a&&eQ(t,["activityEnd"],a),t}(e)}:{realtimeInput:function(e){let t={},n=e0(e,["media"]);if(null!=n){let e=tg(n);Array.isArray(e)&&(e=e.map(e=>t8(e))),eQ(t,["mediaChunks"],e)}let i=e0(e,["audio"]);null!=i&&eQ(t,["audio"],t8(tE(i)));let r=e0(e,["audioStreamEnd"]);null!=r&&eQ(t,["audioStreamEnd"],r);let o=e0(e,["video"]);null!=o&&eQ(t,["video"],t8(tv(o)));let l=e0(e,["text"]);null!=l&&eQ(t,["text"],l);let s=e0(e,["activityStart"]);null!=s&&eQ(t,["activityStart"],s);let a=e0(e,["activityEnd"]);return null!=a&&eQ(t,["activityEnd"],a),t}(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(null==e.functionResponses)throw Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function nw(e){var t,n,i;if(null==(t=null==e?void 0:e.automaticFunctionCalling)?void 0:t.disable)return!0;let r=!1;for(let t of null!=(n=null==e?void 0:e.tools)?n:[])if(nR(t)){r=!0;break}if(!r)return!0;let o=null==(i=null==e?void 0:e.automaticFunctionCalling)?void 0:i.maximumRemoteCalls;return(!(!o||!(o<0)&&Number.isInteger(o))||0==o)&&(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0)}function nR(e){return"callTool"in e&&"function"==typeof e.callTool}function nP(e){var t;return!(null==(t=null==e?void 0:e.automaticFunctionCalling)?void 0:t.ignoreCallHistory)}class nN extends eX{constructor(e){super(),this.apiClient=e,this.generateContent=async e=>{var t,n,i,r,o,l,s,a,u,d,p;let c,h,f=await this.processParamsMaybeAddMcpUsage(e);if(this.maybeMoveToResponseJsonSchem(e),!(null!=(a=null==(s=null==(l=e.config)?void 0:l.tools)?void 0:s.some(e=>nR(e)))&&a)||nw(e.config))return await this.generateContentInternal(f);if(null!=(p=null==(d=null==(u=e.config)?void 0:u.tools)?void 0:d.some(e=>!nR(e)))&&p)throw Error("Automatic function calling with CallableTools and Tools is not yet supported.");let m=tS(f.contents),g=null!=(i=null==(n=null==(t=f.config)?void 0:t.automaticFunctionCalling)?void 0:n.maximumRemoteCalls)?i:10,y=0;for(;y<g&&(c=await this.generateContentInternal(f)).functionCalls&&0!==c.functionCalls.length;){let t=c.candidates[0].content,n=[];for(let t of null!=(o=null==(r=e.config)?void 0:r.tools)?o:[])if(nR(t)){let e=await t.callTool(c.functionCalls);n.push(...e)}y++,h={role:"user",parts:n},f.contents=tS(f.contents),f.contents.push(t),f.contents.push(h),nP(f.config)&&(m.push(t),m.push(h))}return nP(f.config)&&(c.automaticFunctionCallingHistory=m),c},this.generateContentStream=async e=>{if(this.maybeMoveToResponseJsonSchem(e),!nw(e.config))return await this.processAfcStream(e);{let t=await this.processParamsMaybeAddMcpUsage(e);return await this.generateContentStreamInternal(t)}},this.generateImages=async e=>await this.generateImagesInternal(e).then(e=>{var t;let n,i=[];if(null==e?void 0:e.generatedImages)for(let r of e.generatedImages)r&&(null==r?void 0:r.safetyAttributes)&&(null==(t=null==r?void 0:r.safetyAttributes)?void 0:t.contentType)==="Positive Prompt"?n=null==r?void 0:r.safetyAttributes:i.push(r);return n?{generatedImages:i,positivePromptSafetyAttributes:n,sdkHttpResponse:e.sdkHttpResponse}:{generatedImages:i,sdkHttpResponse:e.sdkHttpResponse}}),this.list=async e=>{var t;let n={config:Object.assign(Object.assign({},{queryBase:!0}),null==e?void 0:e.config)};if(this.apiClient.isVertexAI()&&!n.config.queryBase)if(null==(t=n.config)?void 0:t.filter)throw Error("Filtering tuned models list for Vertex AI is not currently supported");else n.config.filter="labels.tune-type:*";return new tJ(eW.PAGED_ITEM_MODELS,e=>this.listInternal(e),await this.listInternal(n),n)},this.editImage=async e=>{let t={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(t.referenceImages=e.referenceImages.map(e=>e.toReferenceImageAPI())),await this.editImageInternal(t)},this.upscaleImage=async e=>{let t={numberOfImages:1,mode:"upscale"};e.config&&(t=Object.assign(Object.assign({},t),e.config));let n={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:t};return await this.upscaleImageInternal(n)},this.generateVideos=async e=>{var t,n,i,r,o,l;if((e.prompt||e.image||e.video)&&e.source)throw Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return!this.apiClient.isVertexAI()&&((null==(t=e.video)?void 0:t.uri)&&(null==(n=e.video)?void 0:n.videoBytes)?e.video={uri:e.video.uri,mimeType:e.video.mimeType}:(null==(r=null==(i=e.source)?void 0:i.video)?void 0:r.uri)&&(null==(l=null==(o=e.source)?void 0:o.video)?void 0:l.videoBytes)&&(e.source.video={uri:e.source.video.uri,mimeType:e.source.video.mimeType})),await this.generateVideosInternal(e)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&!e.config.responseJsonSchema&&Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema)}async processParamsMaybeAddMcpUsage(e){var t,n,i;let r=null==(t=e.config)?void 0:t.tools;if(!r)return e;let o=await Promise.all(r.map(async e=>nR(e)?await e.tool():e)),l={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(l.config.tools=o,e.config&&e.config.tools&&nv(e.config.tools)){let t=Object.assign({},null!=(i=null==(n=e.config.httpOptions)?void 0:n.headers)?i:{});0===Object.keys(t).length&&(t=this.apiClient.getDefaultHeaders()),nE(t),l.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:t})}return l}async initAfcToolsMap(e){var t,n,i;let r=new Map;for(let o of null!=(n=null==(t=e.config)?void 0:t.tools)?n:[])if(nR(o))for(let e of null!=(i=(await o.tool()).functionDeclarations)?i:[]){if(!e.name)throw Error("Function declaration name is required.");if(r.has(e.name))throw Error(`Duplicate tool declaration name: ${e.name}`);r.set(e.name,o)}return r}async processAfcStream(e){var t,n,i;let r=null!=(i=null==(n=null==(t=e.config)?void 0:t.automaticFunctionCalling)?void 0:n.maximumRemoteCalls)?i:10,o=!1,l=0;return function(e,t,n){var i,s;return tX(this,arguments,function*(){for(var a,u,d,p;l<r;){o&&(l++,o=!1);let m=yield tz(e.processParamsMaybeAddMcpUsage(n)),g=yield tz(e.generateContentStreamInternal(m)),y=[],v=[];try{for(var c,h=!0,f=(u=void 0,tZ(g));!(a=(c=yield tz(f.next())).done);h=!0)if(p=c.value,h=!1,yield yield tz(p),p.candidates&&(null==(i=p.candidates[0])?void 0:i.content)){for(let e of(v.push(p.candidates[0].content),null!=(s=p.candidates[0].content.parts)?s:[]))if(l<r&&e.functionCall){if(!e.functionCall.name)throw Error("Function call name was not returned by the model.");if(t.has(e.functionCall.name)){let n=yield tz(t.get(e.functionCall.name).callTool([e.functionCall]));y.push(...n)}else throw Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${t.keys()}, mising tool: ${e.functionCall.name}`)}}}catch(e){u={error:e}}finally{try{!h&&!a&&(d=f.return)&&(yield tz(d.call(f)))}finally{if(u)throw u.error}}if(y.length>0){o=!0;let e=new e6;e.candidates=[{content:{role:"user",parts:y}}],yield yield tz(e);let t=[];t.push(...v),t.push({role:"user",parts:y});let i=tS(n.contents).concat(t);n.contents=i}else break}})}(this,await this.initAfcToolsMap(e),e)}async generateContentInternal(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i=t7(this.apiClient,e);return o=eZ("{model}:generateContent",i._url),l=i._query,delete i._url,delete i._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=nt(e),n=new e6;return Object.assign(n,t),n})}{let t=t9(this.apiClient,e);return o=eZ("{model}:generateContent",t._url),l=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=ne(e),n=new e6;return Object.assign(n,t),n})}}async generateContentStreamInternal(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i=t7(this.apiClient,e);return o=eZ("{model}:streamGenerateContent?alt=sse",i._url),l=i._query,delete i._url,delete i._query,this.apiClient.requestStream({path:o,queryParams:l,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(function(e){return tX(this,arguments,function*(){var t,n,i,r;try{for(var o,l=!0,s=tZ(e);!(t=(o=yield tz(s.next())).done);l=!0){r=o.value,l=!1;let e=nt((yield tz(r.json())));e.sdkHttpResponse={headers:r.headers};let t=new e6;Object.assign(t,e),yield yield tz(t)}}catch(e){n={error:e}}finally{try{!l&&!t&&(i=s.return)&&(yield tz(i.call(s)))}finally{if(n)throw n.error}}})})}{let t=t9(this.apiClient,e);return o=eZ("{model}:streamGenerateContent?alt=sse",t._url),l=t._query,delete t._url,delete t._query,this.apiClient.requestStream({path:o,queryParams:l,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(function(e){return tX(this,arguments,function*(){var t,n,i,r;try{for(var o,l=!0,s=tZ(e);!(t=(o=yield tz(s.next())).done);l=!0){r=o.value,l=!1;let e=ne((yield tz(r.json())));e.sdkHttpResponse={headers:r.headers};let t=new e6;Object.assign(t,e),yield yield tz(t)}}catch(e){n={error:e}}finally{try{!l&&!t&&(i=s.return)&&(yield tz(i.call(s)))}finally{if(n)throw n.error}}})})}}async embedContent(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i=function(e,t){let n,i,r,o,l,s={},a=e0(t,["model"]);null!=a&&eQ(s,["_url","model"],tf(e,a));let u=e0(t,["contents"]);if(null!=u){let t=tC(e,u);Array.isArray(t)&&(t=t.map(e=>e)),eQ(s,["instances[]","content"],t)}let d=e0(t,["config"]);return null!=d&&(n=e0(d,["taskType"]),void 0!==s&&null!=n&&eQ(s,["instances[]","task_type"],n),i=e0(d,["title"]),void 0!==s&&null!=i&&eQ(s,["instances[]","title"],i),r=e0(d,["outputDimensionality"]),void 0!==s&&null!=r&&eQ(s,["parameters","outputDimensionality"],r),o=e0(d,["mimeType"]),void 0!==s&&null!=o&&eQ(s,["instances[]","mimeType"],o),l=e0(d,["autoTruncate"]),void 0!==s&&null!=l&&eQ(s,["parameters","autoTruncate"],l)),s}(this.apiClient,e);return o=eZ("{model}:predict",i._url),l=i._query,delete i._url,delete i._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["predictions[]","embeddings"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s;return n={},null!=(i=e0(e,["values"]))&&eQ(n,["values"],i),null!=(r=e0(e,["statistics"]))&&eQ(n,["statistics"],(o={},null!=(l=e0(t=r,["truncated"]))&&eQ(o,["truncated"],l),null!=(s=e0(t,["token_count"]))&&eQ(o,["tokenCount"],s),o)),n})),eQ(t,["embeddings"],e)}let r=e0(e,["metadata"]);return null!=r&&eQ(t,["metadata"],r),t}(e),n=new e4;return Object.assign(n,t),n})}{let t=function(e,t){let n={},i=e0(t,["model"]);null!=i&&eQ(n,["_url","model"],tf(e,i));let r=e0(t,["contents"]);if(null!=r){let t=tC(e,r);Array.isArray(t)&&(t=t.map(e=>e)),eQ(n,["requests[]","content"],t)}let o=e0(t,["config"]);null!=o&&function(e,t){let n=e0(e,["taskType"]);void 0!==t&&null!=n&&eQ(t,["requests[]","taskType"],n);let i=e0(e,["title"]);void 0!==t&&null!=i&&eQ(t,["requests[]","title"],i);let r=e0(e,["outputDimensionality"]);if(void 0!==t&&null!=r&&eQ(t,["requests[]","outputDimensionality"],r),void 0!==e0(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==e0(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.")}(o,n);let l=e0(t,["model"]);return void 0!==l&&eQ(n,["requests[]","model"],tf(e,l)),n}(this.apiClient,e);return o=eZ("{model}:batchEmbedContents",t._url),l=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["embeddings"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["embeddings"],e)}let r=e0(e,["metadata"]);return null!=r&&eQ(t,["metadata"],r),t}(e),n=new e4;return Object.assign(n,t),n})}}async generateImagesInternal(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l,u,d,p,c,h,f,m,g,y,v,E,A,I,T,_,b,O,C,S=(o=this.apiClient,i={},null!=(r=e0(e,["model"]))&&eQ(i,["_url","model"],tf(o,r)),null!=(l=e0(e,["prompt"]))&&eQ(i,["instances[0]","prompt"],l),null!=(u=e0(e,["config"]))&&(d=e0(u,["outputGcsUri"]),void 0!==i&&null!=d&&eQ(i,["parameters","storageUri"],d),p=e0(u,["negativePrompt"]),void 0!==i&&null!=p&&eQ(i,["parameters","negativePrompt"],p),c=e0(u,["numberOfImages"]),void 0!==i&&null!=c&&eQ(i,["parameters","sampleCount"],c),h=e0(u,["aspectRatio"]),void 0!==i&&null!=h&&eQ(i,["parameters","aspectRatio"],h),f=e0(u,["guidanceScale"]),void 0!==i&&null!=f&&eQ(i,["parameters","guidanceScale"],f),m=e0(u,["seed"]),void 0!==i&&null!=m&&eQ(i,["parameters","seed"],m),g=e0(u,["safetyFilterLevel"]),void 0!==i&&null!=g&&eQ(i,["parameters","safetySetting"],g),y=e0(u,["personGeneration"]),void 0!==i&&null!=y&&eQ(i,["parameters","personGeneration"],y),v=e0(u,["includeSafetyAttributes"]),void 0!==i&&null!=v&&eQ(i,["parameters","includeSafetyAttributes"],v),E=e0(u,["includeRaiReason"]),void 0!==i&&null!=E&&eQ(i,["parameters","includeRaiReason"],E),A=e0(u,["language"]),void 0!==i&&null!=A&&eQ(i,["parameters","language"],A),I=e0(u,["outputMimeType"]),void 0!==i&&null!=I&&eQ(i,["parameters","outputOptions","mimeType"],I),T=e0(u,["outputCompressionQuality"]),void 0!==i&&null!=T&&eQ(i,["parameters","outputOptions","compressionQuality"],T),_=e0(u,["addWatermark"]),void 0!==i&&null!=_&&eQ(i,["parameters","addWatermark"],_),b=e0(u,["labels"]),void 0!==i&&null!=b&&eQ(i,["labels"],b),O=e0(u,["imageSize"]),void 0!==i&&null!=O&&eQ(i,["parameters","sampleImageSize"],O),C=e0(u,["enhancePrompt"]),void 0!==i&&null!=C&&eQ(i,["parameters","enhancePrompt"],C)),i);return s=eZ("{model}:predict",S._url),a=S._query,delete S._url,delete S._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(S),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>nn(e))),eQ(t,["generatedImages"],e)}let r=e0(e,["positivePromptSafetyAttributes"]);return null!=r&&eQ(t,["positivePromptSafetyAttributes"],nu(r)),t}(e),n=new e8;return Object.assign(n,t),n})}{let t,n,o,u,d=(l=this.apiClient,t={},null!=(n=e0(e,["model"]))&&eQ(t,["_url","model"],tf(l,n)),null!=(o=e0(e,["prompt"]))&&eQ(t,["instances[0]","prompt"],o),null!=(u=e0(e,["config"]))&&function(e,t){if(void 0!==e0(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==e0(e,["negativePrompt"]))throw Error("negativePrompt parameter is not supported in Gemini API.");let n=e0(e,["numberOfImages"]);void 0!==t&&null!=n&&eQ(t,["parameters","sampleCount"],n);let i=e0(e,["aspectRatio"]);void 0!==t&&null!=i&&eQ(t,["parameters","aspectRatio"],i);let r=e0(e,["guidanceScale"]);if(void 0!==t&&null!=r&&eQ(t,["parameters","guidanceScale"],r),void 0!==e0(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let o=e0(e,["safetyFilterLevel"]);void 0!==t&&null!=o&&eQ(t,["parameters","safetySetting"],o);let l=e0(e,["personGeneration"]);void 0!==t&&null!=l&&eQ(t,["parameters","personGeneration"],l);let s=e0(e,["includeSafetyAttributes"]);void 0!==t&&null!=s&&eQ(t,["parameters","includeSafetyAttributes"],s);let a=e0(e,["includeRaiReason"]);void 0!==t&&null!=a&&eQ(t,["parameters","includeRaiReason"],a);let u=e0(e,["language"]);void 0!==t&&null!=u&&eQ(t,["parameters","language"],u);let d=e0(e,["outputMimeType"]);void 0!==t&&null!=d&&eQ(t,["parameters","outputOptions","mimeType"],d);let p=e0(e,["outputCompressionQuality"]);if(void 0!==t&&null!=p&&eQ(t,["parameters","outputOptions","compressionQuality"],p),void 0!==e0(e,["addWatermark"]))throw Error("addWatermark parameter is not supported in Gemini API.");if(void 0!==e0(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let c=e0(e,["imageSize"]);if(void 0!==t&&null!=c&&eQ(t,["parameters","sampleImageSize"],c),void 0!==e0(e,["enhancePrompt"]))throw Error("enhancePrompt parameter is not supported in Gemini API.")}(u,t),t);return s=eZ("{model}:predict",d._url),a=d._query,delete d._url,delete d._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(d),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>{var t,n;let i,r,o,l,s,a,u;return i={},null!=(r=e0(t=e,["_self"]))&&eQ(i,["image"],(o={},null!=(l=e0(n=r,["bytesBase64Encoded"]))&&eQ(o,["imageBytes"],e1(l)),null!=(s=e0(n,["mimeType"]))&&eQ(o,["mimeType"],s),o)),null!=(a=e0(t,["raiFilteredReason"]))&&eQ(i,["raiFilteredReason"],a),null!=(u=e0(t,["_self"]))&&eQ(i,["safetyAttributes"],na(u)),i})),eQ(t,["generatedImages"],e)}let r=e0(e,["positivePromptSafetyAttributes"]);return null!=r&&eQ(t,["positivePromptSafetyAttributes"],na(r)),t}(e),n=new e8;return Object.assign(n,t),n})}}async editImageInternal(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI()){let o=function(e,t){let n,i,r,o,l,s,a,u,d,p,c,h,f,m,g,y,v,E={},A=e0(t,["model"]);null!=A&&eQ(E,["_url","model"],tf(e,A));let I=e0(t,["prompt"]);null!=I&&eQ(E,["instances[0]","prompt"],I);let T=e0(t,["referenceImages"]);if(null!=T){let e=T;Array.isArray(e)&&(e=e.map(e=>(function(e){let t,n,i,r,o,l,s,a={},u=e0(e,["referenceImage"]);null!=u&&eQ(a,["referenceImage"],no(u));let d=e0(e,["referenceId"]);null!=d&&eQ(a,["referenceId"],d);let p=e0(e,["referenceType"]);null!=p&&eQ(a,["referenceType"],p);let c=e0(e,["maskImageConfig"]);null!=c&&eQ(a,["maskImageConfig"],(t={},null!=(n=e0(c,["maskMode"]))&&eQ(t,["maskMode"],n),null!=(i=e0(c,["segmentationClasses"]))&&eQ(t,["maskClasses"],i),null!=(r=e0(c,["maskDilation"]))&&eQ(t,["dilation"],r),t));let h=e0(e,["controlImageConfig"]);null!=h&&eQ(a,["controlImageConfig"],(o={},null!=(l=e0(h,["controlType"]))&&eQ(o,["controlType"],l),null!=(s=e0(h,["enableControlImageComputation"]))&&eQ(o,["computeControl"],s),o));let f=e0(e,["styleImageConfig"]);null!=f&&eQ(a,["styleImageConfig"],f);let m=e0(e,["subjectImageConfig"]);return null!=m&&eQ(a,["subjectImageConfig"],m),a})(e))),eQ(E,["instances[0]","referenceImages"],e)}let _=e0(t,["config"]);return null!=_&&(n=e0(_,["outputGcsUri"]),void 0!==E&&null!=n&&eQ(E,["parameters","storageUri"],n),i=e0(_,["negativePrompt"]),void 0!==E&&null!=i&&eQ(E,["parameters","negativePrompt"],i),r=e0(_,["numberOfImages"]),void 0!==E&&null!=r&&eQ(E,["parameters","sampleCount"],r),o=e0(_,["aspectRatio"]),void 0!==E&&null!=o&&eQ(E,["parameters","aspectRatio"],o),l=e0(_,["guidanceScale"]),void 0!==E&&null!=l&&eQ(E,["parameters","guidanceScale"],l),s=e0(_,["seed"]),void 0!==E&&null!=s&&eQ(E,["parameters","seed"],s),a=e0(_,["safetyFilterLevel"]),void 0!==E&&null!=a&&eQ(E,["parameters","safetySetting"],a),u=e0(_,["personGeneration"]),void 0!==E&&null!=u&&eQ(E,["parameters","personGeneration"],u),d=e0(_,["includeSafetyAttributes"]),void 0!==E&&null!=d&&eQ(E,["parameters","includeSafetyAttributes"],d),p=e0(_,["includeRaiReason"]),void 0!==E&&null!=p&&eQ(E,["parameters","includeRaiReason"],p),c=e0(_,["language"]),void 0!==E&&null!=c&&eQ(E,["parameters","language"],c),h=e0(_,["outputMimeType"]),void 0!==E&&null!=h&&eQ(E,["parameters","outputOptions","mimeType"],h),f=e0(_,["outputCompressionQuality"]),void 0!==E&&null!=f&&eQ(E,["parameters","outputOptions","compressionQuality"],f),m=e0(_,["addWatermark"]),void 0!==E&&null!=m&&eQ(E,["parameters","addWatermark"],m),g=e0(_,["labels"]),void 0!==E&&null!=g&&eQ(E,["labels"],g),y=e0(_,["editMode"]),void 0!==E&&null!=y&&eQ(E,["parameters","editMode"],y),v=e0(_,["baseSteps"]),void 0!==E&&null!=v&&eQ(E,["parameters","editConfig","baseSteps"],v)),E}(this.apiClient,e);return i=eZ("{model}:predict",o._url),r=o._query,delete o._url,delete o._query,this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>nn(e))),eQ(t,["generatedImages"],e)}return t}(e),n=new e3;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n,i;let r="",o={};if(this.apiClient.isVertexAI()){let l,s,a,u,d,p,c,h,f,m,g,y,v,E,A=(i=this.apiClient,l={},null!=(s=e0(e,["model"]))&&eQ(l,["_url","model"],tf(i,s)),null!=(a=e0(e,["image"]))&&eQ(l,["instances[0]","image"],no(a)),null!=(u=e0(e,["upscaleFactor"]))&&eQ(l,["parameters","upscaleConfig","upscaleFactor"],u),null!=(d=e0(e,["config"]))&&(p=e0(d,["outputGcsUri"]),void 0!==l&&null!=p&&eQ(l,["parameters","storageUri"],p),c=e0(d,["includeRaiReason"]),void 0!==l&&null!=c&&eQ(l,["parameters","includeRaiReason"],c),h=e0(d,["outputMimeType"]),void 0!==l&&null!=h&&eQ(l,["parameters","outputOptions","mimeType"],h),f=e0(d,["outputCompressionQuality"]),void 0!==l&&null!=f&&eQ(l,["parameters","outputOptions","compressionQuality"],f),m=e0(d,["enhanceInputImage"]),void 0!==l&&null!=m&&eQ(l,["parameters","upscaleConfig","enhanceInputImage"],m),g=e0(d,["imagePreservationFactor"]),void 0!==l&&null!=g&&eQ(l,["parameters","upscaleConfig","imagePreservationFactor"],g),y=e0(d,["labels"]),void 0!==l&&null!=y&&eQ(l,["labels"],y),v=e0(d,["numberOfImages"]),void 0!==l&&null!=v&&eQ(l,["parameters","sampleCount"],v),E=e0(d,["mode"]),void 0!==l&&null!=E&&eQ(l,["parameters","mode"],E)),l);return r=eZ("{model}:predict",A._url),o=A._query,delete A._url,delete A._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(A),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["predictions"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>nn(e))),eQ(t,["generatedImages"],e)}return t}(e),n=new e5;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n,i;let r="",o={};if(this.apiClient.isVertexAI()){let l,s,a,u,d,p,c,h,f,m,g,y,v,E,A,I=(i=this.apiClient,l={},null!=(s=e0(e,["model"]))&&eQ(l,["_url","model"],tf(i,s)),null!=(a=e0(e,["source"]))&&function(e,t){let n=e0(e,["prompt"]);void 0!==t&&null!=n&&eQ(t,["instances[0]","prompt"],n);let i=e0(e,["personImage"]);void 0!==t&&null!=i&&eQ(t,["instances[0]","personImage","image"],no(i));let r=e0(e,["productImages"]);if(void 0!==t&&null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>{let t,n;return t={},null!=(n=e0(e,["productImage"]))&&eQ(t,["image"],no(n)),t})),eQ(t,["instances[0]","productImages"],e)}}(a,l),null!=(u=e0(e,["config"]))&&(d=e0(u,["numberOfImages"]),void 0!==l&&null!=d&&eQ(l,["parameters","sampleCount"],d),p=e0(u,["baseSteps"]),void 0!==l&&null!=p&&eQ(l,["parameters","editConfig","baseSteps"],p),c=e0(u,["outputGcsUri"]),void 0!==l&&null!=c&&eQ(l,["parameters","storageUri"],c),h=e0(u,["seed"]),void 0!==l&&null!=h&&eQ(l,["parameters","seed"],h),f=e0(u,["safetyFilterLevel"]),void 0!==l&&null!=f&&eQ(l,["parameters","safetySetting"],f),m=e0(u,["personGeneration"]),void 0!==l&&null!=m&&eQ(l,["parameters","personGeneration"],m),g=e0(u,["addWatermark"]),void 0!==l&&null!=g&&eQ(l,["parameters","addWatermark"],g),y=e0(u,["outputMimeType"]),void 0!==l&&null!=y&&eQ(l,["parameters","outputOptions","mimeType"],y),v=e0(u,["outputCompressionQuality"]),void 0!==l&&null!=v&&eQ(l,["parameters","outputOptions","compressionQuality"],v),E=e0(u,["enhancePrompt"]),void 0!==l&&null!=E&&eQ(l,["parameters","enhancePrompt"],E),A=e0(u,["labels"]),void 0!==l&&null!=A&&eQ(l,["labels"],A)),l);return r=eZ("{model}:predict",I._url),o=I._query,delete I._url,delete I._query,this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(I),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=e0(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>nn(e))),eQ(t,["generatedImages"],e)}return t}(e),n=new e9;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n,i,r,o;let l="",s={};if(this.apiClient.isVertexAI()){let a,u,d,p,c,h,f,m,g,y,v,E,A,I,T,_=(i=this.apiClient,h={},null!=(f=e0(e,["model"]))&&eQ(h,["_url","model"],tf(i,f)),null!=(m=e0(e,["source"]))&&(r=m,o=h,d=e0(r,["prompt"]),void 0!==o&&null!=d&&eQ(o,["instances[0]","prompt"],d),p=e0(r,["image"]),void 0!==o&&null!=p&&eQ(o,["instances[0]","image"],no(p)),c=e0(r,["scribbleImage"]),void 0!==o&&null!=c&&eQ(o,["instances[0]","scribble"],(a={},null!=(u=e0(c,["image"]))&&eQ(a,["image"],no(u)),a))),null!=(g=e0(e,["config"]))&&(y=e0(g,["mode"]),void 0!==h&&null!=y&&eQ(h,["parameters","mode"],y),v=e0(g,["maxPredictions"]),void 0!==h&&null!=v&&eQ(h,["parameters","maxPredictions"],v),E=e0(g,["confidenceThreshold"]),void 0!==h&&null!=E&&eQ(h,["parameters","confidenceThreshold"],E),A=e0(g,["maskDilation"]),void 0!==h&&null!=A&&eQ(h,["parameters","maskDilation"],A),I=e0(g,["binaryColorThreshold"]),void 0!==h&&null!=I&&eQ(h,["parameters","binaryColorThreshold"],I),T=e0(g,["labels"]),void 0!==h&&null!=T&&eQ(h,["labels"],T)),h);return l=eZ("{model}:predict",_._url),s=_._query,delete _._url,delete _._query,this.apiClient.request({path:l,queryParams:s,body:JSON.stringify(_),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=e0(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=e0(e,["_self"]);null!=n&&eQ(t,["mask"],ni(n));let i=e0(e,["labels"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["labels"],e)}return t})(e))),eQ(t,["generatedMasks"],e)}return t}(e),n=new e7;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l=(o=this.apiClient,i={},null!=(r=e0(e,["model"]))&&eQ(i,["_url","name"],tf(o,r)),i);return s=eZ("{name}",l._url),a=l._query,delete l._url,delete l._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>ns(e))}{let t,n,o=(l=this.apiClient,t={},null!=(n=e0(e,["model"]))&&eQ(t,["_url","name"],tf(l,n)),t);return s=eZ("{name}",o._url),a=o._query,delete o._url,delete o._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>nl(e))}}async listInternal(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l,u,d,p,c=(o=this.apiClient,i={},null!=(r=e0(e,["config"]))&&(l=e0(r,["pageSize"]),void 0!==i&&null!=l&&eQ(i,["_query","pageSize"],l),u=e0(r,["pageToken"]),void 0!==i&&null!=u&&eQ(i,["_query","pageToken"],u),d=e0(r,["filter"]),void 0!==i&&null!=d&&eQ(i,["_query","filter"],d),p=e0(r,["queryBase"]),void 0!==i&&null!=p&&eQ(i,["_url","models_url"],tk(o,p))),i);return s=eZ("{models_url}",c._url),a=c._query,delete c._url,delete c._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["nextPageToken"]);null!=i&&eQ(t,["nextPageToken"],i);let r=e0(e,["_self"]);if(null!=r){let e=tL(r);Array.isArray(e)&&(e=e.map(e=>ns(e))),eQ(t,["models"],e)}return t}(e),n=new te;return Object.assign(n,t),n})}{let t,n,o,u,d,p,c=(l=this.apiClient,t={},null!=(n=e0(e,["config"]))&&(o=e0(n,["pageSize"]),void 0!==t&&null!=o&&eQ(t,["_query","pageSize"],o),u=e0(n,["pageToken"]),void 0!==t&&null!=u&&eQ(t,["_query","pageToken"],u),d=e0(n,["filter"]),void 0!==t&&null!=d&&eQ(t,["_query","filter"],d),p=e0(n,["queryBase"]),void 0!==t&&null!=p&&eQ(t,["_url","models_url"],tk(l,p))),t);return s=eZ("{models_url}",c._url),a=c._query,delete c._url,delete c._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(c),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["nextPageToken"]);null!=i&&eQ(t,["nextPageToken"],i);let r=e0(e,["_self"]);if(null!=r){let e=tL(r);Array.isArray(e)&&(e=e.map(e=>nl(e))),eQ(t,["models"],e)}return t}(e),n=new te;return Object.assign(n,t),n})}}async update(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l,u,d,p,c=(o=this.apiClient,i={},null!=(r=e0(e,["model"]))&&eQ(i,["_url","model"],tf(o,r)),null!=(l=e0(e,["config"]))&&(u=e0(l,["displayName"]),void 0!==i&&null!=u&&eQ(i,["displayName"],u),d=e0(l,["description"]),void 0!==i&&null!=d&&eQ(i,["description"],d),p=e0(l,["defaultCheckpointId"]),void 0!==i&&null!=p&&eQ(i,["defaultCheckpointId"],p)),i);return s=eZ("{model}",c._url),a=c._query,delete c._url,delete c._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>ns(e))}{let t,n,o,u,d,p,c=(l=this.apiClient,t={},null!=(n=e0(e,["model"]))&&eQ(t,["_url","name"],tf(l,n)),null!=(o=e0(e,["config"]))&&(u=e0(o,["displayName"]),void 0!==t&&null!=u&&eQ(t,["displayName"],u),d=e0(o,["description"]),void 0!==t&&null!=d&&eQ(t,["description"],d),p=e0(o,["defaultCheckpointId"]),void 0!==t&&null!=p&&eQ(t,["defaultCheckpointId"],p)),t);return s=eZ("{name}",c._url),a=c._query,delete c._url,delete c._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>nl(e))}}async delete(e){var t,n,i,r,o,l;let s="",a={};if(this.apiClient.isVertexAI()){let i,r,l=(o=this.apiClient,i={},null!=(r=e0(e,["model"]))&&eQ(i,["_url","name"],tf(o,r)),i);return s=eZ("{name}",l._url),a=l._query,delete l._url,delete l._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=e0(e,["sdkHttpResponse"]))&&eQ(t,["sdkHttpResponse"],n),t),r=new tt;return Object.assign(r,i),r})}{let t,n,o=(l=this.apiClient,t={},null!=(n=e0(e,["model"]))&&eQ(t,["_url","name"],tf(l,n)),t);return s=eZ("{name}",o._url),a=o._query,delete o._url,delete o._query,this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i=(t={},null!=(n=e0(e,["sdkHttpResponse"]))&&eQ(t,["sdkHttpResponse"],n),t),r=new tt;return Object.assign(r,i),r})}}async countTokens(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i=function(e,t){let n={},i=e0(t,["model"]);null!=i&&eQ(n,["_url","model"],tf(e,i));let r=e0(t,["contents"]);if(null!=r){let e=tS(r);Array.isArray(e)&&(e=e.map(e=>e)),eQ(n,["contents"],e)}let o=e0(t,["config"]);return null!=o&&function(e,t){let n=e0(e,["systemInstruction"]);void 0!==t&&null!=n&&eQ(t,["systemInstruction"],tO(n));let i=e0(e,["tools"]);if(void 0!==t&&null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>np(e))),eQ(t,["tools"],e)}let r=e0(e,["generationConfig"]);void 0!==t&&null!=r&&eQ(t,["generationConfig"],function(e){let t={},n=e0(e,["modelSelectionConfig"]);null!=n&&eQ(t,["modelConfig"],n);let i=e0(e,["audioTimestamp"]);null!=i&&eQ(t,["audioTimestamp"],i);let r=e0(e,["candidateCount"]);null!=r&&eQ(t,["candidateCount"],r);let o=e0(e,["enableAffectiveDialog"]);null!=o&&eQ(t,["enableAffectiveDialog"],o);let l=e0(e,["frequencyPenalty"]);null!=l&&eQ(t,["frequencyPenalty"],l);let s=e0(e,["logprobs"]);null!=s&&eQ(t,["logprobs"],s);let a=e0(e,["maxOutputTokens"]);null!=a&&eQ(t,["maxOutputTokens"],a);let u=e0(e,["mediaResolution"]);null!=u&&eQ(t,["mediaResolution"],u);let d=e0(e,["presencePenalty"]);null!=d&&eQ(t,["presencePenalty"],d);let p=e0(e,["responseJsonSchema"]);null!=p&&eQ(t,["responseJsonSchema"],p);let c=e0(e,["responseLogprobs"]);null!=c&&eQ(t,["responseLogprobs"],c);let h=e0(e,["responseMimeType"]);null!=h&&eQ(t,["responseMimeType"],h);let f=e0(e,["responseModalities"]);null!=f&&eQ(t,["responseModalities"],f);let m=e0(e,["responseSchema"]);null!=m&&eQ(t,["responseSchema"],m);let g=e0(e,["routingConfig"]);null!=g&&eQ(t,["routingConfig"],g);let y=e0(e,["seed"]);null!=y&&eQ(t,["seed"],y);let v=e0(e,["speechConfig"]);null!=v&&eQ(t,["speechConfig"],nd(v));let E=e0(e,["stopSequences"]);null!=E&&eQ(t,["stopSequences"],E);let A=e0(e,["temperature"]);null!=A&&eQ(t,["temperature"],A);let I=e0(e,["thinkingConfig"]);null!=I&&eQ(t,["thinkingConfig"],I);let T=e0(e,["topK"]);null!=T&&eQ(t,["topK"],T);let _=e0(e,["topP"]);if(null!=_&&eQ(t,["topP"],_),void 0!==e0(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(r))}(o,n),n}(this.apiClient,e);return o=eZ("{model}:countTokens",i._url),l=i._query,delete i._url,delete i._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,r=(t={},null!=(n=e0(e,["sdkHttpResponse"]))&&eQ(t,["sdkHttpResponse"],n),null!=(i=e0(e,["totalTokens"]))&&eQ(t,["totalTokens"],i),t),o=new tn;return Object.assign(o,r),o})}{let t=function(e,t){let n={},i=e0(t,["model"]);null!=i&&eQ(n,["_url","model"],tf(e,i));let r=e0(t,["contents"]);if(null!=r){let e=tS(r);Array.isArray(e)&&(e=e.map(e=>t5(e))),eQ(n,["contents"],e)}let o=e0(t,["config"]);return null!=o&&function(e){if(void 0!==e0(e,["systemInstruction"]))throw Error("systemInstruction parameter is not supported in Gemini API.");if(void 0!==e0(e,["tools"]))throw Error("tools parameter is not supported in Gemini API.");if(void 0!==e0(e,["generationConfig"]))throw Error("generationConfig parameter is not supported in Gemini API.")}(o),n}(this.apiClient,e);return o=eZ("{model}:countTokens",t._url),l=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,r,o=(t={},null!=(n=e0(e,["sdkHttpResponse"]))&&eQ(t,["sdkHttpResponse"],n),null!=(i=e0(e,["totalTokens"]))&&eQ(t,["totalTokens"],i),null!=(r=e0(e,["cachedContentTokenCount"]))&&eQ(t,["cachedContentTokenCount"],r),t),l=new tn;return Object.assign(l,o),l})}}async computeTokens(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI()){let o=function(e,t){let n={},i=e0(t,["model"]);null!=i&&eQ(n,["_url","model"],tf(e,i));let r=e0(t,["contents"]);if(null!=r){let e=tS(r);Array.isArray(e)&&(e=e.map(e=>e)),eQ(n,["contents"],e)}return n}(this.apiClient,e);return i=eZ("{model}:computeTokens",o._url),r=o._query,delete o._url,delete o._query,this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["tokensInfo"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["tokensInfo"],e)}return t}(e),n=new ti;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,i,r,o,l,s,a,u,d;let p="",c={};if(this.apiClient.isVertexAI()){let i,r,l,u,d,h,f,m,g,y,v=(o=this.apiClient,u={},null!=(d=e0(e,["model"]))&&eQ(u,["_url","model"],tf(o,d)),null!=(h=e0(e,["prompt"]))&&eQ(u,["instances[0]","prompt"],h),null!=(f=e0(e,["image"]))&&eQ(u,["instances[0]","image"],no(f)),null!=(m=e0(e,["video"]))&&eQ(u,["instances[0]","video"],nh(m)),null!=(g=e0(e,["source"]))&&(s=g,a=u,i=e0(s,["prompt"]),void 0!==a&&null!=i&&eQ(a,["instances[0]","prompt"],i),r=e0(s,["image"]),void 0!==a&&null!=r&&eQ(a,["instances[0]","image"],no(r)),l=e0(s,["video"]),void 0!==a&&null!=l&&eQ(a,["instances[0]","video"],nh(l))),null!=(y=e0(e,["config"]))&&function(e,t){var n;let i,r,o,l=e0(e,["numberOfVideos"]);void 0!==t&&null!=l&&eQ(t,["parameters","sampleCount"],l);let s=e0(e,["outputGcsUri"]);void 0!==t&&null!=s&&eQ(t,["parameters","storageUri"],s);let a=e0(e,["fps"]);void 0!==t&&null!=a&&eQ(t,["parameters","fps"],a);let u=e0(e,["durationSeconds"]);void 0!==t&&null!=u&&eQ(t,["parameters","durationSeconds"],u);let d=e0(e,["seed"]);void 0!==t&&null!=d&&eQ(t,["parameters","seed"],d);let p=e0(e,["aspectRatio"]);void 0!==t&&null!=p&&eQ(t,["parameters","aspectRatio"],p);let c=e0(e,["resolution"]);void 0!==t&&null!=c&&eQ(t,["parameters","resolution"],c);let h=e0(e,["personGeneration"]);void 0!==t&&null!=h&&eQ(t,["parameters","personGeneration"],h);let f=e0(e,["pubsubTopic"]);void 0!==t&&null!=f&&eQ(t,["parameters","pubsubTopic"],f);let m=e0(e,["negativePrompt"]);void 0!==t&&null!=m&&eQ(t,["parameters","negativePrompt"],m);let g=e0(e,["enhancePrompt"]);void 0!==t&&null!=g&&eQ(t,["parameters","enhancePrompt"],g);let y=e0(e,["generateAudio"]);void 0!==t&&null!=y&&eQ(t,["parameters","generateAudio"],y);let v=e0(e,["lastFrame"]);void 0!==t&&null!=v&&eQ(t,["instances[0]","lastFrame"],no(v));let E=e0(e,["referenceImages"]);if(void 0!==t&&null!=E){let e=E;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r;return n={},null!=(i=e0(t=e,["image"]))&&eQ(n,["image"],no(i)),null!=(r=e0(t,["referenceType"]))&&eQ(n,["referenceType"],r),n})),eQ(t,["instances[0]","referenceImages"],e)}let A=e0(e,["mask"]);void 0!==t&&null!=A&&eQ(t,["instances[0]","mask"],(i={},null!=(r=e0(n=A,["image"]))&&eQ(i,["_self"],no(r)),null!=(o=e0(n,["maskMode"]))&&eQ(i,["maskMode"],o),i));let I=e0(e,["compressionQuality"]);void 0!==t&&null!=I&&eQ(t,["parameters","compressionQuality"],I)}(y,u),u);return p=eZ("{model}:predictLongRunning",v._url),c=v._query,delete v._url,delete v._query,this.apiClient.request({path:p,queryParams:c,body:JSON.stringify(v),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t,n,i,r,o,l,s=(t={},null!=(n=e0(e,["name"]))&&eQ(t,["name"],n),null!=(i=e0(e,["metadata"]))&&eQ(t,["metadata"],i),null!=(r=e0(e,["done"]))&&eQ(t,["done"],r),null!=(o=e0(e,["error"]))&&eQ(t,["error"],o),null!=(l=e0(e,["response"]))&&eQ(t,["response"],function(e){let t={},n=e0(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s;return n={},null!=(i=e0(e,["_self"]))&&eQ(n,["video"],(r={},null!=(o=e0(t=i,["gcsUri"]))&&eQ(r,["uri"],o),null!=(l=e0(t,["bytesBase64Encoded"]))&&eQ(r,["videoBytes"],e1(l)),null!=(s=e0(t,["mimeType"]))&&eQ(r,["mimeType"],s),r)),n})),eQ(t,["generatedVideos"],e)}let i=e0(e,["raiMediaFilteredCount"]);null!=i&&eQ(t,["raiMediaFilteredCount"],i);let r=e0(e,["raiMediaFilteredReasons"]);return null!=r&&eQ(t,["raiMediaFilteredReasons"],r),t}(l)),t),a=new tr;return Object.assign(a,s),a})}{let t,n,o,s,a,h,f,m,g,y,v=(l=this.apiClient,s={},null!=(a=e0(e,["model"]))&&eQ(s,["_url","model"],tf(l,a)),null!=(h=e0(e,["prompt"]))&&eQ(s,["instances[0]","prompt"],h),null!=(f=e0(e,["image"]))&&eQ(s,["instances[0]","image"],nr(f)),null!=(m=e0(e,["video"]))&&eQ(s,["instances[0]","video"],nc(m)),null!=(g=e0(e,["source"]))&&(u=g,d=s,t=e0(u,["prompt"]),void 0!==d&&null!=t&&eQ(d,["instances[0]","prompt"],t),n=e0(u,["image"]),void 0!==d&&null!=n&&eQ(d,["instances[0]","image"],nr(n)),o=e0(u,["video"]),void 0!==d&&null!=o&&eQ(d,["instances[0]","video"],nc(o))),null!=(y=e0(e,["config"]))&&function(e,t){let n=e0(e,["numberOfVideos"]);if(void 0!==t&&null!=n&&eQ(t,["parameters","sampleCount"],n),void 0!==e0(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==e0(e,["fps"]))throw Error("fps parameter is not supported in Gemini API.");let i=e0(e,["durationSeconds"]);if(void 0!==t&&null!=i&&eQ(t,["parameters","durationSeconds"],i),void 0!==e0(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let r=e0(e,["aspectRatio"]);void 0!==t&&null!=r&&eQ(t,["parameters","aspectRatio"],r);let o=e0(e,["resolution"]);void 0!==t&&null!=o&&eQ(t,["parameters","resolution"],o);let l=e0(e,["personGeneration"]);if(void 0!==t&&null!=l&&eQ(t,["parameters","personGeneration"],l),void 0!==e0(e,["pubsubTopic"]))throw Error("pubsubTopic parameter is not supported in Gemini API.");let s=e0(e,["negativePrompt"]);void 0!==t&&null!=s&&eQ(t,["parameters","negativePrompt"],s);let a=e0(e,["enhancePrompt"]);if(void 0!==t&&null!=a&&eQ(t,["parameters","enhancePrompt"],a),void 0!==e0(e,["generateAudio"]))throw Error("generateAudio parameter is not supported in Gemini API.");let u=e0(e,["lastFrame"]);void 0!==t&&null!=u&&eQ(t,["instances[0]","lastFrame"],nr(u));let d=e0(e,["referenceImages"]);if(void 0!==t&&null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r;return n={},null!=(i=e0(t=e,["image"]))&&eQ(n,["image"],nr(i)),null!=(r=e0(t,["referenceType"]))&&eQ(n,["referenceType"],r),n})),eQ(t,["instances[0]","referenceImages"],e)}if(void 0!==e0(e,["mask"]))throw Error("mask parameter is not supported in Gemini API.");if(void 0!==e0(e,["compressionQuality"]))throw Error("compressionQuality parameter is not supported in Gemini API.")}(y,s),s);return p=eZ("{model}:predictLongRunning",v._url),c=v._query,delete v._url,delete v._query,this.apiClient.request({path:p,queryParams:c,body:JSON.stringify(v),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t,n,i,r,o,l,s=(t={},null!=(n=e0(e,["name"]))&&eQ(t,["name"],n),null!=(i=e0(e,["metadata"]))&&eQ(t,["metadata"],i),null!=(r=e0(e,["done"]))&&eQ(t,["done"],r),null!=(o=e0(e,["error"]))&&eQ(t,["error"],o),null!=(l=e0(e,["response","generateVideoResponse"]))&&eQ(t,["response"],function(e){let t={},n=e0(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s;return n={},null!=(i=e0(e,["video"]))&&eQ(n,["video"],(r={},null!=(o=e0(t=i,["uri"]))&&eQ(r,["uri"],o),null!=(l=e0(t,["encodedVideo"]))&&eQ(r,["videoBytes"],e1(l)),null!=(s=e0(t,["encoding"]))&&eQ(r,["mimeType"],s),r)),n})),eQ(t,["generatedVideos"],e)}let i=e0(e,["raiMediaFilteredCount"]);null!=i&&eQ(t,["raiMediaFilteredCount"],i);let r=e0(e,["raiMediaFilteredReasons"]);return null!=r&&eQ(t,["raiMediaFilteredReasons"],r),t}(l)),t),a=new tr;return Object.assign(a,s),a})}}}class nx extends eX{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e,i=t.name.split("/operations/")[0];n&&"httpOptions"in n&&(e=n.httpOptions);let r=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:r,isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,isVertexAI:!1})}}async get(e){let t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e,i=t.name.split("/operations/")[0];n&&"httpOptions"in n&&(e=n.httpOptions);let r=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:r,isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i,r,s=(i={},null!=(r=e0(e,["operationName"]))&&eQ(i,["_url","operationName"],r),i);return o=eZ("{operationName}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json())}{let t,n,s=(t={},null!=(n=e0(e,["operationName"]))&&eQ(t,["_url","operationName"],n),t);return o=eZ("{operationName}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json())}}async fetchPredictVideosOperationInternal(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI()){let o,l,s,a=(o={},null!=(l=e0(e,["operationName"]))&&eQ(o,["operationName"],l),null!=(s=e0(e,["resourceName"]))&&eQ(o,["_url","resourceName"],s),o);return i=eZ("{resourceName}:fetchPredictOperation",a._url),r=a._query,delete a._url,delete a._query,this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json())}throw Error("This method is only supported by the Vertex AI.")}}class nU extends eX{constructor(e){super(),this.apiClient=e}async create(e){var t,n,i,r,o;let l="",s={};if(this.apiClient.isVertexAI())throw Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let a,u,d,p,c,h,f,m,g,y,v=(i=this.apiClient,p={},null!=(c=e0(e,["config"]))&&eQ(p,["config"],(h=e0(c,["expireTime"]),void 0!==p&&null!=h&&eQ(p,["expireTime"],h),f=e0(c,["newSessionExpireTime"]),void 0!==p&&null!=f&&eQ(p,["newSessionExpireTime"],f),m=e0(c,["uses"]),void 0!==p&&null!=m&&eQ(p,["uses"],m),g=e0(c,["liveConnectConstraints"]),void 0!==p&&null!=g&&eQ(p,["bidiGenerateContentSetup"],(r=i,a={},null!=(u=e0(o=g,["model"]))&&eQ(a,["setup","model"],tf(r,u)),null!=(d=e0(o,["config"]))&&eQ(a,["config"],function(e,t){let n=e0(e,["generationConfig"]);void 0!==t&&null!=n&&eQ(t,["setup","generationConfig"],n);let i=e0(e,["responseModalities"]);void 0!==t&&null!=i&&eQ(t,["setup","generationConfig","responseModalities"],i);let r=e0(e,["temperature"]);void 0!==t&&null!=r&&eQ(t,["setup","generationConfig","temperature"],r);let o=e0(e,["topP"]);void 0!==t&&null!=o&&eQ(t,["setup","generationConfig","topP"],o);let l=e0(e,["topK"]);void 0!==t&&null!=l&&eQ(t,["setup","generationConfig","topK"],l);let s=e0(e,["maxOutputTokens"]);void 0!==t&&null!=s&&eQ(t,["setup","generationConfig","maxOutputTokens"],s);let a=e0(e,["mediaResolution"]);void 0!==t&&null!=a&&eQ(t,["setup","generationConfig","mediaResolution"],a);let u=e0(e,["seed"]);void 0!==t&&null!=u&&eQ(t,["setup","generationConfig","seed"],u);let d=e0(e,["speechConfig"]);void 0!==t&&null!=d&&eQ(t,["setup","generationConfig","speechConfig"],tP(d));let p=e0(e,["thinkingConfig"]);void 0!==t&&null!=p&&eQ(t,["setup","generationConfig","thinkingConfig"],p);let c=e0(e,["enableAffectiveDialog"]);void 0!==t&&null!=c&&eQ(t,["setup","generationConfig","enableAffectiveDialog"],c);let h=e0(e,["systemInstruction"]);void 0!==t&&null!=h&&eQ(t,["setup","systemInstruction"],function(e){let t={},n=e0(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>{var t;let n,i,r,o,l,s,a,u,d,p,c;return n={},null!=(i=e0(t=e,["videoMetadata"]))&&eQ(n,["videoMetadata"],i),null!=(r=e0(t,["thought"]))&&eQ(n,["thought"],r),null!=(o=e0(t,["inlineData"]))&&eQ(n,["inlineData"],function(e){let t={};if(void 0!==e0(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=e0(e,["data"]);null!=n&&eQ(t,["data"],n);let i=e0(e,["mimeType"]);return null!=i&&eQ(t,["mimeType"],i),t}(o)),null!=(l=e0(t,["fileData"]))&&eQ(n,["fileData"],function(e){let t={};if(void 0!==e0(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=e0(e,["fileUri"]);null!=n&&eQ(t,["fileUri"],n);let i=e0(e,["mimeType"]);return null!=i&&eQ(t,["mimeType"],i),t}(l)),null!=(s=e0(t,["thoughtSignature"]))&&eQ(n,["thoughtSignature"],s),null!=(a=e0(t,["functionCall"]))&&eQ(n,["functionCall"],a),null!=(u=e0(t,["codeExecutionResult"]))&&eQ(n,["codeExecutionResult"],u),null!=(d=e0(t,["executableCode"]))&&eQ(n,["executableCode"],d),null!=(p=e0(t,["functionResponse"]))&&eQ(n,["functionResponse"],p),null!=(c=e0(t,["text"]))&&eQ(n,["text"],c),n})),eQ(t,["parts"],e)}let i=e0(e,["role"]);return null!=i&&eQ(t,["role"],i),t}(tO(h)));let f=e0(e,["tools"]);if(void 0!==t&&null!=f){let e=tx(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=e0(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["functionDeclarations"],e)}if(void 0!==e0(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let i=e0(e,["googleSearch"]);null!=i&&eQ(t,["googleSearch"],function(e){let t={},n=e0(e,["timeRangeFilter"]);if(null!=n&&eQ(t,["timeRangeFilter"],n),void 0!==e0(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");return t}(i));let r=e0(e,["googleSearchRetrieval"]);if(null!=r&&eQ(t,["googleSearchRetrieval"],r),void 0!==e0(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=e0(e,["googleMaps"]);null!=o&&eQ(t,["googleMaps"],function(e){let t={};if(void 0!==e0(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=e0(e,["enableWidget"]);return null!=n&&eQ(t,["enableWidget"],n),t}(o));let l=e0(e,["urlContext"]);null!=l&&eQ(t,["urlContext"],l);let s=e0(e,["computerUse"]);null!=s&&eQ(t,["computerUse"],s);let a=e0(e,["codeExecution"]);return null!=a&&eQ(t,["codeExecution"],a),t})(tN(e)))),eQ(t,["setup","tools"],e)}let m=e0(e,["sessionResumption"]);void 0!==t&&null!=m&&eQ(t,["setup","sessionResumption"],function(e){let t={},n=e0(e,["handle"]);if(null!=n&&eQ(t,["handle"],n),void 0!==e0(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(m));let g=e0(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&eQ(t,["setup","inputAudioTranscription"],g);let y=e0(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&eQ(t,["setup","outputAudioTranscription"],y);let v=e0(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&eQ(t,["setup","realtimeInputConfig"],v);let E=e0(e,["contextWindowCompression"]);void 0!==t&&null!=E&&eQ(t,["setup","contextWindowCompression"],E);let A=e0(e,["proactivity"]);return void 0!==t&&null!=A&&eQ(t,["setup","proactivity"],A),{}}(d,a)),a)),y=e0(c,["lockAdditionalFields"]),void 0!==p&&null!=y&&eQ(p,["fieldMask"],y),{})),p);l=eZ("auth_tokens",v._url),s=v._query,delete v.config,delete v._url,delete v._query;let E=function(e,t){let n=null,i=e.bidiGenerateContentSetup;if("object"==typeof i&&null!==i&&"setup"in i){let t=i.setup;"object"==typeof t&&null!==t?(e.bidiGenerateContentSetup=t,n=t):delete e.bidiGenerateContentSetup}else void 0!==i&&delete e.bidiGenerateContentSetup;let r=e.fieldMask;if(n){let i=function(e){let t=[];for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let i=e[n];if("object"==typeof i&&null!=i&&Object.keys(i).length>0){let e=Object.keys(i).map(e=>`${n}.${e}`);t.push(...e)}else t.push(n)}return t.join(",")}(n);if(Array.isArray(null==t?void 0:t.lockAdditionalFields)&&(null==t?void 0:t.lockAdditionalFields.length)===0)i?e.fieldMask=i:delete e.fieldMask;else if((null==t?void 0:t.lockAdditionalFields)&&t.lockAdditionalFields.length>0&&null!==r&&Array.isArray(r)&&r.length>0){let t=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],n=[];r.length>0&&(n=r.map(e=>t.includes(e)?`generationConfig.${e}`:e));let o=[];i&&o.push(i),n.length>0&&o.push(...n),o.length>0?e.fieldMask=o.join(","):delete e.fieldMask}else delete e.fieldMask}else null!==r&&Array.isArray(r)&&r.length>0?e.fieldMask=r.join(","):delete e.fieldMask;return e}(v,e.config);return this.apiClient.request({path:l,queryParams:s,body:JSON.stringify(E),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}}function nM(e){let t,n,i,r={},o=e0(e,["sdkHttpResponse"]);null!=o&&eQ(r,["sdkHttpResponse"],o);let l=e0(e,["name"]);null!=l&&eQ(r,["name"],l);let s=e0(e,["state"]);null!=s&&eQ(r,["state"],tM(s));let a=e0(e,["createTime"]);null!=a&&eQ(r,["createTime"],a);let u=e0(e,["tuningTask","startTime"]);null!=u&&eQ(r,["startTime"],u);let d=e0(e,["tuningTask","completeTime"]);null!=d&&eQ(r,["endTime"],d);let p=e0(e,["updateTime"]);null!=p&&eQ(r,["updateTime"],p);let c=e0(e,["description"]);null!=c&&eQ(r,["description"],c);let h=e0(e,["baseModel"]);null!=h&&eQ(r,["baseModel"],h);let f=e0(e,["_self"]);return null!=f&&eQ(r,["tunedModel"],(t={},null!=(n=e0(f,["name"]))&&eQ(t,["model"],n),null!=(i=e0(f,["name"]))&&eQ(t,["endpoint"],i),t)),r}function nD(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["name"]);null!=i&&eQ(t,["name"],i);let r=e0(e,["state"]);null!=r&&eQ(t,["state"],tM(r));let o=e0(e,["createTime"]);null!=o&&eQ(t,["createTime"],o);let l=e0(e,["startTime"]);null!=l&&eQ(t,["startTime"],l);let s=e0(e,["endTime"]);null!=s&&eQ(t,["endTime"],s);let a=e0(e,["updateTime"]);null!=a&&eQ(t,["updateTime"],a);let u=e0(e,["error"]);null!=u&&eQ(t,["error"],u);let d=e0(e,["description"]);null!=d&&eQ(t,["description"],d);let p=e0(e,["baseModel"]);null!=p&&eQ(t,["baseModel"],p);let c=e0(e,["tunedModel"]);null!=c&&eQ(t,["tunedModel"],c);let h=e0(e,["preTunedModel"]);null!=h&&eQ(t,["preTunedModel"],h);let f=e0(e,["supervisedTuningSpec"]);null!=f&&eQ(t,["supervisedTuningSpec"],f);let m=e0(e,["tuningDataStats"]);null!=m&&eQ(t,["tuningDataStats"],m);let g=e0(e,["encryptionSpec"]);null!=g&&eQ(t,["encryptionSpec"],g);let y=e0(e,["partnerModelTuningSpec"]);null!=y&&eQ(t,["partnerModelTuningSpec"],y);let v=e0(e,["customBaseModel"]);null!=v&&eQ(t,["customBaseModel"],v);let E=e0(e,["experiment"]);null!=E&&eQ(t,["experiment"],E);let A=e0(e,["labels"]);null!=A&&eQ(t,["labels"],A);let I=e0(e,["outputUri"]);null!=I&&eQ(t,["outputUri"],I);let T=e0(e,["pipelineJob"]);null!=T&&eQ(t,["pipelineJob"],T);let _=e0(e,["serviceAccount"]);null!=_&&eQ(t,["serviceAccount"],_);let b=e0(e,["tunedModelDisplayName"]);null!=b&&eQ(t,["tunedModelDisplayName"],b);let O=e0(e,["veoTuningSpec"]);return null!=O&&eQ(t,["veoTuningSpec"],O),t}class nk extends eX{constructor(e){super(),this.apiClient=e,this.get=async e=>await this.getInternal(e),this.list=async(e={})=>new tJ(eW.PAGED_ITEM_TUNING_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.tune=async e=>{var t;if(this.apiClient.isVertexAI())if(e.baseModel.startsWith("projects/")){let n={tunedModelName:e.baseModel};(null==(t=e.config)?void 0:t.preTunedModelCheckpointId)&&(n.checkpointId=e.config.preTunedModelCheckpointId);let i=Object.assign(Object.assign({},e),{preTunedModel:n});return i.baseModel=void 0,await this.tuneInternal(i)}else{let t=Object.assign({},e);return await this.tuneInternal(t)}{let t=Object.assign({},e),n=await this.tuneMldevInternal(t),i="";return void 0!==n.metadata&&void 0!==n.metadata.tunedModel?i=n.metadata.tunedModel:void 0!==n.name&&n.name.includes("/operations/")&&(i=n.name.split("/operations/")[0]),{name:i,state:ey.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i,r,s=(i={},null!=(r=e0(e,["name"]))&&eQ(i,["_url","name"],r),i);return o=eZ("{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>nD(e))}{let t,n,s=(t={},null!=(n=e0(e,["name"]))&&eQ(t,["_url","name"],n),t);return o=eZ("{name}",s._url),l=s._query,delete s._url,delete s._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>nM(e))}}async listInternal(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i,r,s,a,u,d=(i={},null!=(r=e0(e,["config"]))&&(s=e0(r,["pageSize"]),void 0!==i&&null!=s&&eQ(i,["_query","pageSize"],s),a=e0(r,["pageToken"]),void 0!==i&&null!=a&&eQ(i,["_query","pageToken"],a),u=e0(r,["filter"]),void 0!==i&&null!=u&&eQ(i,["_query","filter"],u)),i);return o=eZ("tuningJobs",d._url),l=d._query,delete d._url,delete d._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"GET",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["nextPageToken"]);null!=i&&eQ(t,["nextPageToken"],i);let r=e0(e,["tuningJobs"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>nD(e))),eQ(t,["tuningJobs"],e)}return t}(e),n=new to;return Object.assign(n,t),n})}{let t,n,s,a,u,d=(t={},null!=(n=e0(e,["config"]))&&(s=e0(n,["pageSize"]),void 0!==t&&null!=s&&eQ(t,["_query","pageSize"],s),a=e0(n,["pageToken"]),void 0!==t&&null!=a&&eQ(t,["_query","pageToken"],a),u=e0(n,["filter"]),void 0!==t&&null!=u&&eQ(t,["_query","filter"],u)),t);return o=eZ("tunedModels",d._url),l=d._query,delete d._url,delete d._query,this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"GET",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=e0(e,["sdkHttpResponse"]);null!=n&&eQ(t,["sdkHttpResponse"],n);let i=e0(e,["nextPageToken"]);null!=i&&eQ(t,["nextPageToken"],i);let r=e0(e,["tunedModels"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>nM(e))),eQ(t,["tuningJobs"],e)}return t}(e),n=new to;return Object.assign(n,t),n})}}async cancel(e){var t,n,i,r;let o="",l={};if(this.apiClient.isVertexAI()){let i,r,s=(i={},null!=(r=e0(e,["name"]))&&eQ(i,["_url","name"],r),i);o=eZ("{name}:cancel",s._url),l=s._query,delete s._url,delete s._query,await this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal})}else{let t,n,s=(t={},null!=(n=e0(e,["name"]))&&eQ(t,["_url","name"],n),t);o=eZ("{name}:cancel",s._url),l=s._query,delete s._url,delete s._query,await this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(i=e.config)?void 0:i.httpOptions,abortSignal:null==(r=e.config)?void 0:r.abortSignal})}}async tuneInternal(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI()){let o,l,s,a,u,d=(o={},null!=(l=e0(e,["baseModel"]))&&eQ(o,["baseModel"],l),null!=(s=e0(e,["preTunedModel"]))&&eQ(o,["preTunedModel"],s),null!=(a=e0(e,["trainingDataset"]))&&eQ(o,["supervisedTuningSpec","trainingDatasetUri"],function(e,t){let n=e0(e,["gcsUri"]);void 0!==t&&null!=n&&eQ(t,["supervisedTuningSpec","trainingDatasetUri"],n);let i=e0(e,["vertexDatasetResource"]);if(void 0!==t&&null!=i&&eQ(t,["supervisedTuningSpec","trainingDatasetUri"],i),void 0!==e0(e,["examples"]))throw Error("examples parameter is not supported in Vertex AI.");return{}}(a,o)),null!=(u=e0(e,["config"]))&&function(e,t){var n,i;let r,o,l,s=e0(e,["validationDataset"]);void 0!==t&&null!=s&&eQ(t,["supervisedTuningSpec"],(i={},r={},null!=(o=e0(n=s,["gcsUri"]))&&eQ(r,["validationDatasetUri"],o),l=e0(n,["vertexDatasetResource"]),void 0!==i&&null!=l&&eQ(i,["supervisedTuningSpec","trainingDatasetUri"],l),r));let a=e0(e,["tunedModelDisplayName"]);void 0!==t&&null!=a&&eQ(t,["tunedModelDisplayName"],a);let u=e0(e,["description"]);void 0!==t&&null!=u&&eQ(t,["description"],u);let d=e0(e,["epochCount"]);void 0!==t&&null!=d&&eQ(t,["supervisedTuningSpec","hyperParameters","epochCount"],d);let p=e0(e,["learningRateMultiplier"]);void 0!==t&&null!=p&&eQ(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],p);let c=e0(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=c&&eQ(t,["supervisedTuningSpec","exportLastCheckpointOnly"],c);let h=e0(e,["adapterSize"]);if(void 0!==t&&null!=h&&eQ(t,["supervisedTuningSpec","hyperParameters","adapterSize"],h),void 0!==e0(e,["batchSize"]))throw Error("batchSize parameter is not supported in Vertex AI.");if(void 0!==e0(e,["learningRate"]))throw Error("learningRate parameter is not supported in Vertex AI.");let f=e0(e,["labels"]);void 0!==t&&null!=f&&eQ(t,["labels"],f)}(u,o),o);return i=eZ("tuningJobs",d._url),r=d._query,delete d._url,delete d._query,this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(d),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>nD(e))}throw Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let i="",r={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o,l,s,a,u,d=(o={},null!=(l=e0(e,["baseModel"]))&&eQ(o,["baseModel"],l),null!=(s=e0(e,["preTunedModel"]))&&eQ(o,["preTunedModel"],s),null!=(a=e0(e,["trainingDataset"]))&&eQ(o,["tuningTask","trainingData"],function(e){let t={};if(void 0!==e0(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==e0(e,["vertexDatasetResource"]))throw Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=e0(e,["examples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),eQ(t,["examples","examples"],e)}return t}(a)),null!=(u=e0(e,["config"]))&&function(e,t){if(void 0!==e0(e,["validationDataset"]))throw Error("validationDataset parameter is not supported in Gemini API.");let n=e0(e,["tunedModelDisplayName"]);if(void 0!==t&&null!=n&&eQ(t,["displayName"],n),void 0!==e0(e,["description"]))throw Error("description parameter is not supported in Gemini API.");let i=e0(e,["epochCount"]);void 0!==t&&null!=i&&eQ(t,["tuningTask","hyperparameters","epochCount"],i);let r=e0(e,["learningRateMultiplier"]);if(null!=r&&eQ({},["tuningTask","hyperparameters","learningRateMultiplier"],r),void 0!==e0(e,["exportLastCheckpointOnly"]))throw Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(void 0!==e0(e,["preTunedModelCheckpointId"]))throw Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(void 0!==e0(e,["adapterSize"]))throw Error("adapterSize parameter is not supported in Gemini API.");let o=e0(e,["batchSize"]);void 0!==t&&null!=o&&eQ(t,["tuningTask","hyperparameters","batchSize"],o);let l=e0(e,["learningRate"]);if(void 0!==t&&null!=l&&eQ(t,["tuningTask","hyperparameters","learningRate"],l),void 0!==e0(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.")}(u,o),o);return i=eZ("tunedModels",d._url),r=d._query,delete d._url,delete d._query,this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(d),httpMethod:"POST",httpOptions:null==(t=e.config)?void 0:t.httpOptions,abortSignal:null==(n=e.config)?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t,n,i,r,o,l;return t={},null!=(n=e0(e,["sdkHttpResponse"]))&&eQ(t,["sdkHttpResponse"],n),null!=(i=e0(e,["name"]))&&eQ(t,["name"],i),null!=(r=e0(e,["metadata"]))&&eQ(t,["metadata"],r),null!=(o=e0(e,["done"]))&&eQ(t,["done"],o),null!=(l=e0(e,["error"]))&&eQ(t,["error"],l),t})}}}class nL{async download(e,t){throw Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}let nj="x-goog-upload-status";async function nq(e,t,n){var i,r,o;let l=0,s=0,a=new e2(new Response),u="upload";for(l=e.size;s<l;){let o=Math.min(8388608,l-s),d=e.slice(s,s+o);s+o>=l&&(u+=", finalize");let p=0,c=1e3;for(;p<3&&(null==(i=null==(a=await n.request({path:"",body:d,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(s),"Content-Length":String(o)}}}))?void 0:a.headers)||!i[nj]);)p++,await function(e){return new Promise(t=>setTimeout(t,e))}(c),c*=2;if(s+=o,(null==(r=null==a?void 0:a.headers)?void 0:r[nj])!=="active")break;if(l<=s)throw Error("All content has been uploaded, but the upload status is not finalized.")}let d=await (null==a?void 0:a.json());if((null==(o=null==a?void 0:a.headers)?void 0:o[nj])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return d.file}async function nG(e){return{size:e.size,type:e.type}}class nF{async upload(e,t,n){if("string"==typeof e)throw Error("File path is not supported in browser uploader.");return await nq(e,t,n)}async stat(e){if("string"!=typeof e)return await nG(e);throw Error("File path is not supported in browser uploader.")}}class nB{create(e,t,n){return new nH(e,t,n)}}class nH{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.send(e)}close(){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.close()}}let nV="x-goog-api-key";class n${constructor(e){this.apiKey=e}async addAuthHeaders(e){if(null===e.get(nV)){if(this.apiKey.startsWith("auth_tokens/"))throw Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw Error("API key is missing. Please provide a valid API key.");e.append(nV,this.apiKey)}}}let nJ={get url(){return`file://${e.P("src/services/geminiService.ts")}`}}.env.VITE_GEMINI_API_KEY||"";nJ||console.error("Gemini API key is missing. Please add VITE_GEMINI_API_KEY to your .env file");let nY=new class{constructor(e){var i;if(null==e.apiKey)throw Error("An API Key must be set when running in a browser");if(e.project||e.location)throw Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=null!=(i=e.vertexai)&&i,this.apiKey=e.apiKey;const r=function(e,i,r,o){return(null==e?void 0:e.baseUrl)?e.baseUrl:i?null!=n?n:r:null!=t?t:o}(e.httpOptions,e.vertexai,void 0,void 0);r&&(e.httpOptions?e.httpOptions.baseUrl=r:e.httpOptions={baseUrl:r}),this.apiVersion=e.apiVersion;const o=new n$(this.apiKey);this.apiClient=new ng({auth:o,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:"gl-node/web",uploader:new nF,downloader:new nL}),this.models=new nN(this.apiClient),this.live=new nO(this.apiClient,o,new nB),this.batches=new tY(this.apiClient),this.chats=new t1(this.models,this.apiClient),this.caches=new tK(this.apiClient),this.files=new t4(this.apiClient),this.operations=new nx(this.apiClient),this.authTokens=new nU(this.apiClient),this.tunings=new nk(this.apiClient)}}({apiKey:nJ});async function nW(e,t,n,i,r,o,l){if(!nJ)throw Error("Gemini API key is not configured. Please add your API key to the .env file.");if("initial"===n)return{imageUrl:await nX(e,t,void 0,o),position:{x:50,y:50,scale:1,rotation:0}};if((i?.toLowerCase().includes("change lighting only")||i?.toLowerCase().includes("maintain current position"))&&l&&o)return{imageUrl:await nK(l,o),position:r||{x:50,y:50,scale:1,rotation:0}};{let n=function(e,t){let n=e.toLowerCase(),i={...t};if(n.includes("left")?i.x=Math.max(10,t.x-10):n.includes("right")&&(i.x=Math.min(90,t.x+10)),n.includes("up")||n.includes("top")?i.y=Math.max(10,t.y-10):(n.includes("down")||n.includes("bottom"))&&(i.y=Math.min(90,t.y+10)),n.includes("rotate")){let e=n.match(/(\d+)/);e?i.rotation=(t.rotation+parseInt(e[1]))%360:i.rotation=(t.rotation+45)%360}return n.includes("smaller")||n.includes("shrink")?i.scale=Math.max(.5,t.scale-.1):(n.includes("larger")||n.includes("bigger"))&&(i.scale=Math.min(2,t.scale+.1)),n.includes("center")?(i.x=50,i.y=50):n.includes("corner")&&(n.includes("top")&&n.includes("left")?(i.x=20,i.y=20):n.includes("top")&&n.includes("right")?(i.x=80,i.y=20):n.includes("bottom")&&n.includes("left")?(i.x=20,i.y=80):n.includes("bottom")&&n.includes("right")&&(i.x=80,i.y=80)),i}(i||"",r||{x:50,y:50,scale:1,rotation:0});return{imageUrl:await nX(e,t,function(e,t,n){let i=e.toLowerCase();if(i.includes("change lighting only")||i.includes("maintain current position"))return`Adjust only the lighting and atmospheric conditions: ${n}. Keep the tiny home and all other elements in their current positions.`;let r=`Reposition the ${t.name} tiny home in this scene: `;return i.includes("left")&&(r+="move it to the left, "),i.includes("right")&&(r+="move it to the right, "),(i.includes("up")||i.includes("back"))&&(r+="move it further back, "),(i.includes("down")||i.includes("forward"))&&(r+="move it closer, "),r+="keeping realistic proportions. Keep the property scene unchanged except for the tiny home position.",n&&(r+=` Lighting conditions: ${n}`),r}(i||"",t,o),o),position:n}}}async function nK(e,t){let n=e.includes("base64,")?e.split("base64,")[1]:e,i=await n0(e),r=`Using the provided photograph, change only the lighting and atmosphere: ${t}. Keep everything else exactly the same - same positions, same structures, same composition. Only adjust lighting, shadows, and atmospheric conditions.`;console.log(`Using aspect ratio for lighting edit: ${i}`),console.log("Sending conversational lighting edit to Gemini API");let o=await nY.models.generateContent({model:"gemini-2.5-flash-image",config:{responseModalities:["IMAGE","TEXT"],imageConfig:{aspectRatio:i}},contents:[{role:"user",parts:[{inlineData:{mimeType:"image/jpeg",data:n}},{text:r}]}]});if(!o.candidates||!o.candidates[0].content||!o.candidates[0].content.parts)throw Error("No response from Gemini API");let l=o.candidates[0].content.parts.find(e=>e.inlineData);if(l?.inlineData){console.log("Found lighting-edited image in response!");let{mimeType:e,data:t}=l.inlineData;return`data:${e};base64,${t}`}let s=o.candidates[0].content.parts.filter(e=>e.text).map(e=>e.text).join("");throw Error(`No image generated during lighting edit. API Response: ${s||"No response text"}`)}async function nz(e){return new Promise((t,n)=>{let i=document.createElement("canvas"),r=i.getContext("2d");if(!r)return void n(Error("Failed to get canvas context"));let o=new Image;o.crossOrigin="anonymous",o.onload=()=>{i.width=o.width,i.height=o.height,r.drawImage(o,0,0);let n=new Image;n.crossOrigin="anonymous",n.onload=()=>{let e,o,l=n.width/n.height;l>1?(e=120,o=120/l):(o=120,e=120*l);let s=i.height-o-20;r.globalAlpha=.6,r.drawImage(n,20,s,e,o),r.font='bold 18px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif',r.fillStyle="white",r.globalAlpha=.6;let a=20+e+12,u=s+o/2+7;r.fillText("www.unit2go.co.nz",a,u),r.globalAlpha=.4,r.fillStyle="black",r.fillText("www.unit2go.co.nz",a+1,u+1),t(i.toDataURL("image/png"))},n.onerror=()=>{console.warn("Failed to load watermark, returning original image"),t(e)},n.src="/unit2go-logo.png"},o.onerror=()=>n(Error("Failed to load main image for watermarking")),o.src=e})}async function nX(e,t,n,i){let r=await n1(e.file),o=await n2(t.imageUrl),l=await nQ(e.file),s=n||`Using the provided property photo, add only the ${t.name} tiny home (${t.dimensions.length}m \xd7 ${t.dimensions.width}m \xd7 ${t.dimensions.height}m) from the second image. Place it naturally where it looks most realistic, orienting the rectangular structure parallel to visible features like fences, paths, decks, or property boundaries. Keep the property photo exactly the same - same lighting, same colors, same background, same sky, same ground. Only add the tiny home with realistic shadows and reflections.${i?` ${i}`:""}`;console.log(`Detected aspect ratio: ${l}`);let a="gemini-2.5-flash-image",u=[{role:"user",parts:[{inlineData:{mimeType:e.file.type||"image/jpeg",data:r}},{inlineData:{mimeType:"image/png",data:o}},{text:s}]}];console.log("Sending request to Gemini API with model:",a);let d=await nY.models.generateContent({model:a,config:{responseModalities:["IMAGE","TEXT"],imageConfig:{aspectRatio:l}},contents:u});if(!d.candidates||!d.candidates[0].content||!d.candidates[0].content.parts)throw Error("No response from Gemini API");let p=d.candidates[0].content.parts.find(e=>e.inlineData);if(p?.inlineData){console.log("Found image in response!");let{mimeType:e,data:t}=p.inlineData;return`data:${e};base64,${t}`}let c=d.candidates[0].content.parts.filter(e=>e.text).map(e=>e.text).join("");throw Error(`No image generated. API Response: ${c||"No response text"}`)}function nZ(e){return .1>Math.abs(e-1)?"1:1":.1>Math.abs(e-4/3)?"4:3":.1>Math.abs(e-3/4)?"3:4":.1>Math.abs(e-16/9)?"16:9":.1>Math.abs(e-9/16)?"9:16":.1>Math.abs(e-1.5)?"3:2":.1>Math.abs(e-2/3)?"2:3":.1>Math.abs(e-5/4)?"5:4":.1>Math.abs(e-.8)?"4:5":.1>Math.abs(e-21/9)?"21:9":e>1.5?"16:9":e>1.2?"4:3":e>.9?"1:1":e>.6?"3:4":"9:16"}async function nQ(e){return new Promise((t,n)=>{let i=new Image,r=URL.createObjectURL(e);i.onload=()=>{let e=i.width/i.height;URL.revokeObjectURL(r),t(nZ(e))},i.onerror=()=>{URL.revokeObjectURL(r),n(Error("Failed to load image for aspect ratio detection"))},i.src=r})}async function n0(e){return new Promise((t,n)=>{let i=new Image;i.onload=()=>{t(nZ(i.width/i.height))},i.onerror=()=>{n(Error("Failed to load image from data URL"))},i.src=e})}async function n1(e){return new Promise((t,n)=>{let i=new FileReader;i.onloadend=()=>{t(i.result.split(",")[1])},i.onerror=n,i.readAsDataURL(e)})}async function n2(e){return new Promise((t,n)=>{let i=new Image;i.crossOrigin="anonymous",i.onload=()=>{let e=document.createElement("canvas");e.width=i.width,e.height=i.height;let r=e.getContext("2d");r?(r.drawImage(i,0,0),t(e.toDataURL("image/png").split(",")[1])):n(Error("Failed to get canvas context"))},i.onerror=()=>n(Error("Failed to load tiny home image")),i.src=e})}async function n6(e,t,n,i){let r=await n1(e.file),o=await n2(t.imageUrl),l=n.includes("base64,")?n.split("base64,")[1]:n,s=await nQ(e.file),a=`Using the provided property photo, add only the ${t.name} tiny home from the second image at the position shown in the wireframe guide (third image). Orient the rectangular structure parallel to visible features like fences, paths, decks, or property boundaries. Keep the property photo exactly the same - same lighting, same colors, same background. Only add the tiny home with realistic shadows and reflections matching the wireframe position.${i?` ${i}`:""}`;console.log(`Using aspect ratio for wireframe guide: ${s}`);let u="gemini-2.5-flash-image",d=[{role:"user",parts:[{inlineData:{mimeType:e.file.type||"image/jpeg",data:r}},{inlineData:{mimeType:"image/png",data:o}},{inlineData:{mimeType:"image/png",data:l}},{text:a}]}];console.log("Sending wireframe-guided request to Gemini API with model:",u);let p=await nY.models.generateContent({model:u,config:{responseModalities:["IMAGE","TEXT"],imageConfig:{aspectRatio:s}},contents:d});if(!p.candidates||!p.candidates[0].content||!p.candidates[0].content.parts)throw Error("No response from Gemini API");let c=p.candidates[0].content.parts.find(e=>e.inlineData);if(c?.inlineData){console.log("Found image in wireframe-guided response!");let{mimeType:e,data:t}=c.inlineData;return`data:${e};base64,${t}`}let h=p.candidates[0].content.parts.filter(e=>e.text).map(e=>e.text).join("");throw Error(`No image generated with wireframe guide. API Response: ${h||"No response text"}`)}async function n4(e,t){let n=e.includes("base64,")?e.split("base64,")[1]:e,i=await n0(e),r=`Using the provided photograph, change only: ${t}. Keep everything else exactly the same. Only modify what was specifically requested.`;console.log(`Using aspect ratio for conversational edit: ${i}`),console.log("Sending conversational edit request to Gemini API");let o=await nY.models.generateContent({model:"gemini-2.5-flash-image",config:{responseModalities:["IMAGE","TEXT"],imageConfig:{aspectRatio:i}},contents:[{role:"user",parts:[{inlineData:{mimeType:"image/png",data:n}},{text:r}]}]});if(!o.candidates||!o.candidates[0].content||!o.candidates[0].content.parts)throw Error("No response from Gemini API");let l=o.candidates[0].content.parts.find(e=>e.inlineData);if(l?.inlineData){console.log("Found image in conversational edit response!");let{mimeType:e,data:t}=l.inlineData;return`data:${e};base64,${t}`}let s=o.candidates[0].content.parts.filter(e=>e.text).map(e=>e.text).join("");throw Error(`No image generated for conversational edit. API Response: ${s||"No response text"}`)}var n8=e.i(16847);let n3={get url(){return`file://${e.P("src/services/fluxService.ts")}`}}.env.VITE_FAL_API_KEY||"";async function n5(e){try{console.log("Generating depth map with MiDaS...");let t=await n8.subscribe("fal-ai/imageutils/depth",{input:{image_url:e}});return console.log("Depth map generated successfully"),{imageUrl:t.image.url,width:t.image.width,height:t.image.height}}catch(e){throw console.error("Error generating depth map:",e),Error("Failed to generate depth map")}}async function n9(e){return new Promise((t,n)=>{let i=new FileReader;i.onloadend=()=>t(i.result),i.onerror=n,i.readAsDataURL(e)})}async function n7(e,t){try{var n;if(!n3)throw Error("FAL API key is not configured. Please add your API key to the .env file.");console.log("Converting property image to data URL...");let t=await n9(e.propertyImage);console.log("Generating depth map for positioning control...");let i=await n5(t),r=(n=e.lightingPrompt,`Composite the tiny home from the reference image naturally onto this property where it looks most realistic given the terrain and available space.

Preserve both the property photo and tiny home design exactly. Only add these integration elements:
- Natural contact shadows beneath the tiny home
- Ground interaction where the foundation meets terrain
- Lighting adjustments to match the property photo
- Window reflections matching the sky/environment

The tiny home should appear as if it was physically present when the property photo was taken.${n?` ${n}`:""}`);console.log("Calling FLUX.1 image-to-image with ControlNet for compositing...");let o=await n8.subscribe("fal-ai/flux-general/image-to-image",{input:{image_url:t,prompt:r,reference_image_url:e.tinyHomeImageUrl,reference_strength:.95,control_image_url:i.imageUrl,controlnet_conditioning_scale:e.controlnetStrength||.9,strength:.3,num_inference_steps:28,guidance_scale:3.5,seed:Math.floor(1e6*Math.random()),enable_safety_checker:!0}});if(!o.images||0===o.images.length)throw Error("No images generated by FLUX API");return console.log("FLUX generation successful!"),o.images[0].url}catch(e){throw console.error("Error generating with FLUX:",e),e}}n3||console.error("FAL API key is missing. Please add VITE_FAL_API_KEY to your .env file"),n8.config({credentials:n3});let ie={get url(){return`file://${e.P("src/services/imageGenerationService.ts")}`}}.env.VITE_IMAGE_MODEL_PROVIDER||"gemini";async function it(e,t,n){if("flux"!==ie)return console.log("Using Gemini 2.5 Flash Image for generation..."),ii(e,t,n);console.log("Using FLUX.1 for image generation...");try{return await n7({propertyImage:e.file,tinyHomeImageUrl:t.imageUrl,lightingPrompt:n,controlnetStrength:.9},t)}catch(i){return console.error("FLUX generation failed, falling back to Gemini:",i),ii(e,t,n)}}async function ii(e,t,n){return(await nW(e,t,"initial",void 0,void 0,n)).imageUrl}console.log(`Image generation model provider: ${ie}`),e.s(["default",0,function({uploadedImage:e,selectedTinyHome:t,wireframeGuideImage:n}){let[i,r]=(0,ez.useState)(!1),[o,l]=(0,ez.useState)(null),[s,a]=(0,ez.useState)({x:50,y:50,scale:1,rotation:0}),[u,d]=(0,ez.useState)(null),[p,c]=(0,ez.useState)(!1),[h,f]=(0,ez.useState)(12),[m,g]=(0,ez.useState)(0),[y,v]=(0,ez.useState)(""),[E,A]=(0,ez.useState)([]),[I,T]=(0,ez.useState)(-1),[_,b]=(0,ez.useState)(!1),[O,C]=(0,ez.useState)(1),[S,w]=(0,ez.useState)({x:0,y:0}),[R,P]=(0,ez.useState)(!1),[N,x]=(0,ez.useState)({x:0,y:0}),U=["The AI intelligently scales your tiny home based on surrounding objects","Try different times of day to see how lighting affects the appearance","Each generation creates a unique placement - experiment to find your favorite","Use the position controls for fine-tuning the placement","Download your image to share with family, friends, or planning consultants","The visualization helps you make confident decisions about your tiny home placement","Use conversational editing to customize the scene with natural language","The AI aligns with fence lines and boundaries for realistic placement"],M=e=>e>=7&&e<8?"NEW ZEALAND SUNRISE LIGHTING: Apply subtle and realistic New Zealand sunrise lighting with gentle warm tones. The sun is low on the horizon creating moderate shadows. The sky shows soft oranges and pinks. Keep lighting natural and understated - avoid oversaturation. Surfaces have warm but realistic illumination":e>=8&&e<11?"NEW ZEALAND MORNING LIGHTING: Apply clear, natural New Zealand morning sunlight with realistic intensity. Create well-defined but natural shadows and a blue sky. The lighting should feel fresh and natural with good visibility - avoid oversaturation":e>=11&&e<15?"NEW ZEALAND MIDDAY LIGHTING: Apply natural New Zealand midday sun from overhead with realistic intensity. Create short shadows directly under objects with clear but natural illumination. Keep lighting realistic and natural. The sky should be blue and colors should appear natural":e>=15&&e<18?"NEW ZEALAND AFTERNOON LIGHTING: Apply warm, natural New Zealand afternoon sunlight with moderately long shadows. Gentle warm tones appear on surfaces with comfortable natural lighting. Keep effects subtle and realistic - avoid oversaturation":e>=18&&e<19?"NEW ZEALAND GOLDEN HOUR: Apply New Zealand natural golden hour lighting with subtle warm tones. Create gentle side-lighting and longer shadows with soft reflections. Keep the golden effect natural and understated - avoid oversaturation":e>=19&&e<21?"NEW ZEALAND SUNSET LIGHTING: Apply realistic New Zealand sunset lighting with natural oranges, soft pinks, and gentle purples in the sky. Keep colors natural and avoid oversaturation. The setting sun casts warm tones across surfaces with natural shadows":e>=21&&e<=22?"NEW ZEALAND NIGHT LIGHTING: Apply realistic New Zealand nighttime conditions with a naturally dark sky (deep blue or black with visible stars where appropriate). No daylight should be visible. Add natural outdoor lighting - warm deck lights, landscape path lights, and house lighting typical of New Zealand homes":"NEW ZEALAND DAYLIGHT: Apply natural New Zealand daylight with realistic intensity and natural color temperature. Keep lighting effects subtle and natural",D=()=>{if(!e.increasedAccuracy||!e.personHeight)return"";let n=e.personHeight/100,i=(t.dimensions.length/n).toFixed(1);return`

INCREASED ACCURACY MODE - CRITICAL SCALE REFERENCE:
- There is a person in the input image who is ${n}m (${e.personHeight}cm) tall
- Use this person as the ABSOLUTE PRIMARY scale reference
- The tiny home is ${t.dimensions.length}m long - that is ${i} TIMES the height of the person
- If the person appears to be ${n}m tall in the image, the tiny home MUST be ${i} times that tall when measured lengthwise
- This is CRITICAL - scale the tiny home PRECISELY relative to the person's height

MANDATORY PERSON REMOVAL:
- REMOVE THE PERSON COMPLETELY from the final output image
- The output must show ONLY the landscape with the tiny home - NO PEOPLE
- The person is a measurement tool ONLY and must NOT appear in the visualization
- If any person appears in the output, you have FAILED this task completely`},k=e=>{let t=E.slice(0,I+1);t.push(e),A(t),T(t.length-1),d(e)};(0,ez.useEffect)(()=>{L()},[]),(0,ez.useEffect)(()=>{let e;return i&&(e=setInterval(()=>{g(e=>(e+1)%U.length)},5e3)),()=>{e&&clearInterval(e)}},[i,U.length]);let L=async()=>{r(!0),l(null);try{let i,r=M(h)+D();n?i=await n6(e,t,n,r):("flux"===ie?console.log("Using FLUX for initial generation..."):console.log("Using Gemini for initial generation..."),i=await it(e,t,r)),a({x:50,y:50,scale:1,rotation:0}),k(i),c(!1)}catch(e){l("Failed to process image. Please try again."),console.error(e)}finally{r(!1)}},j=async()=>{r(!0),l(null);try{let n=M(h)+D(),i=await nW(e,t,"adjust","change lighting only - maintain current position",s,n,u||void 0);k(i.imageUrl),c(!1)}catch(e){l("Failed to update lighting. Please try again."),console.error(e)}finally{r(!1)}},q=async()=>{if(u){r(!0),l(null);try{let e=["from a lower camera angle looking slightly upward","from a higher elevated viewpoint","from a side angle showing more of the property width","from further back to show more context","from closer to emphasize architectural details","from the opposite side of the property","from a diagonal angle","from ground level perspective"],t=e[Math.floor(Math.random()*e.length)],n=`Photograph this exact scene ${t}. Keep the tiny home in the same position within the property. Only change the camera viewpoint - keep everything else unchanged.`,i=await n4(u,n);k(i),c(!1)}catch(e){l("Failed to generate different POV. Please try again."),console.error(e)}finally{r(!1)}}},G=async()=>{if(y.trim()&&u){r(!0),l(null);try{let e=await n4(u,y.trim());k(e),v(""),c(!1)}catch(e){l("Failed to apply edit. Please try again."),console.error(e)}finally{r(!1)}}},F=async()=>{if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return void alert('To save your image: Long-press the image above and select "Save to Photos" or "Download Image"');try{let t=u&&!p?u:e.url,n=await nz(t),i=document.createElement("a");i.href=n,i.download=p?`original-space-${Date.now()}.jpg`:`unit2go-visualization-${Date.now()}.jpg`,i.click()}catch(e){console.error("Download failed:",e),alert("Unable to download image. Please right-click the image and save it manually.")}},B=()=>{b(!1),C(1),w({x:0,y:0})},H=async()=>{await F()},V=()=>{P(!1)};return(0,eK.jsxs)("div",{className:"visualizer",children:[(0,eK.jsxs)("div",{className:"visualization-wrapper",children:[(0,eK.jsxs)("div",{className:"visualization-container",children:[i&&(0,eK.jsxs)("div",{className:"processing-overlay",children:[(0,eK.jsx)("div",{className:"spinner"}),(0,eK.jsx)("p",{className:"processing-text",children:"Processing your image..."}),(0,eK.jsx)("p",{className:"processing-tip",children:U[m]})]}),u?(0,eK.jsx)("img",{src:p?e.url:u,alt:p?"Original space":"Tiny home visualization",className:"result-image clickable",onClick:()=>{u&&(b(!0),C(1),w({x:0,y:0}))},style:{cursor:"pointer"}}):(0,eK.jsx)("img",{src:e.url,alt:"Original",className:"result-image"}),o&&(0,eK.jsxs)("div",{className:"error-overlay",children:[(0,eK.jsx)("p",{children:o}),(0,eK.jsx)("button",{onClick:L,children:"Retry"})]})]}),u&&(0,eK.jsx)("p",{className:"image-disclaimer",children:"Generated images are artistic representations and may not be to exact scale"}),u&&(0,eK.jsxs)("div",{className:"conversational-edit-section",children:[(0,eK.jsx)("h3",{children:"Edit Your Visualization"}),(0,eK.jsx)("p",{className:"control-info",children:'Make natural language edits to your image. Try: "make the sky more cloudy", "add some trees", "change the grass to gravel", etc.'}),(0,eK.jsxs)("div",{className:"edit-input-group",children:[(0,eK.jsx)("input",{type:"text",value:y,onChange:e=>v(e.target.value),onKeyPress:e=>{"Enter"===e.key&&!i&&y.trim()&&G()},placeholder:"Describe the changes you'd like to make...",className:"edit-input",disabled:i}),(0,eK.jsx)("button",{className:"apply-button",onClick:G,disabled:i||!y.trim(),children:"Apply Edit"})]}),(0,eK.jsxs)("div",{className:"edit-examples",children:[(0,eK.jsx)("strong",{children:"Example edits:"}),(0,eK.jsxs)("ul",{children:[(0,eK.jsx)("li",{children:'"make the sky more cloudy"'}),(0,eK.jsx)("li",{children:'"add some trees in the background"'}),(0,eK.jsx)("li",{children:'"change the grass to gravel or paving"'}),(0,eK.jsx)("li",{children:'"make the lighting warmer"'}),(0,eK.jsx)("li",{children:'"add a garden bed near the tiny home"'})]})]})]})]}),(0,eK.jsxs)("div",{className:"controls",children:[(0,eK.jsxs)("div",{className:"control-panel",children:[(0,eK.jsx)("h3",{children:"View Controls"}),(0,eK.jsxs)("div",{className:"regenerate-section",children:[(0,eK.jsxs)("div",{className:"history-controls",children:[(0,eK.jsx)("button",{className:"history-button",onClick:()=>{if(I>0){let e=I-1;T(e),d(E[e]),c(!1)}},disabled:i||I<=0,title:"Undo",children:" Undo"}),(0,eK.jsx)("button",{className:"history-button",onClick:()=>{if(I<E.length-1){let e=I+1;T(e),d(E[e]),c(!1)}},disabled:i||I>=E.length-1,title:"Redo",children:"Redo "})]}),(0,eK.jsx)("p",{className:"control-info",children:"Step backward or forward through your edits"}),(0,eK.jsx)("button",{className:"pov-button",onClick:q,disabled:i||!u,children:"Generate Different POV"}),(0,eK.jsx)("p",{className:"control-info",children:"Try a different camera angle and perspective"}),(0,eK.jsx)("button",{className:"toggle-button",onClick:()=>{c(!p)},disabled:i||!u,children:p?"Show Tiny Home":"Show Original"}),(0,eK.jsx)("p",{className:"control-info",children:"Toggle between original and visualization"})]})]}),(0,eK.jsxs)("div",{className:"control-panel",children:[(0,eK.jsx)("h3",{children:"Lighting & Time of Day"}),(0,eK.jsxs)("div",{className:"time-control",children:[(0,eK.jsxs)("div",{className:"time-display",children:[(0,eK.jsx)("span",{className:"time-value",children:0===h?"12:00 AM":h<12?`${h}:00 AM`:12===h?"12:00 PM":`${h-12}:00 PM`}),(0,eK.jsx)("span",{className:"time-description",children:h>=7&&h<8?"sunrise":h>=8&&h<11?"morning":h>=11&&h<15?"midday":h>=15&&h<18?"afternoon":h>=18&&h<19?"golden hour":h>=19&&h<21?"sunset":h>=21&&h<=22?"night":"daylight"})]}),(0,eK.jsx)("input",{type:"range",min:"7",max:"22",value:h,onChange:e=>f(parseInt(e.target.value)),className:"time-slider",disabled:i}),(0,eK.jsx)("button",{className:"apply-button",onClick:j,disabled:i,children:"Apply Lighting"})]})]}),(0,eK.jsxs)("div",{className:"control-panel",children:[(0,eK.jsx)("h3",{children:"Your Tiny Home"}),(0,eK.jsxs)("div",{className:"tiny-home-info",children:[(0,eK.jsx)("h4",{children:t.name}),(0,eK.jsxs)("p",{className:"info-row",children:[(0,eK.jsx)("span",{className:"info-label",children:"Dimensions:"}),(0,eK.jsxs)("span",{children:[t.dimensions.length,"m  ",t.dimensions.width,"m"]})]}),(0,eK.jsxs)("p",{className:"info-row",children:[(0,eK.jsx)("span",{className:"info-label",children:"Height:"}),(0,eK.jsxs)("span",{children:[t.dimensions.height,"m"]})]}),(0,eK.jsxs)("p",{className:"info-row",children:[(0,eK.jsx)("span",{className:"info-label",children:"Price:"}),(0,eK.jsxs)("span",{className:"price",children:["$",t.price.toLocaleString()]})]}),t.productUrl&&(0,eK.jsx)("a",{href:t.productUrl,target:"_blank",rel:"noopener noreferrer",className:"product-link-button",children:"Learn More"})]}),(0,eK.jsxs)("button",{className:"download-button",onClick:F,disabled:!u,children:[(0,eK.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,eK.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,eK.jsx)("polyline",{points:"7 10 12 15 17 10"}),(0,eK.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Download Image"]})]})]}),_&&u&&(0,eK.jsx)("div",{className:"lightbox-overlay",onClick:B,children:(0,eK.jsxs)("div",{className:"lightbox-content",onClick:e=>e.stopPropagation(),children:[(0,eK.jsx)("button",{className:"lightbox-close",onClick:B,"aria-label":"Close",children:(0,eK.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,eK.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,eK.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),(0,eK.jsxs)("div",{className:"zoom-controls",children:[(0,eK.jsx)("button",{className:"zoom-button",onClick:()=>{C(e=>Math.min(e+.5,4))},disabled:O>=4,"aria-label":"Zoom in",children:(0,eK.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,eK.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,eK.jsx)("path",{d:"M21 21l-4.35-4.35"}),(0,eK.jsx)("line",{x1:"11",y1:"8",x2:"11",y2:"14"}),(0,eK.jsx)("line",{x1:"8",y1:"11",x2:"14",y2:"11"})]})}),(0,eK.jsxs)("span",{className:"zoom-level",children:[Math.round(100*O),"%"]}),(0,eK.jsx)("button",{className:"zoom-button",onClick:()=>{C(e=>{let t=Math.max(e-.5,1);return 1===t&&w({x:0,y:0}),t})},disabled:O<=1,"aria-label":"Zoom out",children:(0,eK.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,eK.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,eK.jsx)("path",{d:"M21 21l-4.35-4.35"}),(0,eK.jsx)("line",{x1:"8",y1:"11",x2:"14",y2:"11"})]})}),O>1&&(0,eK.jsx)("button",{className:"zoom-button zoom-reset",onClick:()=>{C(1),w({x:0,y:0})},"aria-label":"Reset zoom",children:(0,eK.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,eK.jsx)("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}),(0,eK.jsx)("path",{d:"M21 3v5h-5"}),(0,eK.jsx)("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}),(0,eK.jsx)("path",{d:"M3 21v-5h5"})]})})]}),(0,eK.jsx)("div",{className:"lightbox-image-container",onWheel:e=>{e.preventDefault();let t=e.deltaY>0?-.1:.1;C(e=>{let n=Math.max(1,Math.min(e+t,4));return 1===n&&w({x:0,y:0}),n})},onMouseDown:e=>{O>1&&(P(!0),x({x:e.clientX-S.x,y:e.clientY-S.y}))},onMouseMove:e=>{R&&O>1&&w({x:e.clientX-N.x,y:e.clientY-N.y})},onMouseUp:V,onMouseLeave:V,style:{cursor:O>1?R?"grabbing":"grab":"default",overflow:"hidden"},children:(0,eK.jsx)("img",{src:p?e.url:u,alt:p?"Original space":"Tiny home visualization",className:"lightbox-image",style:{transform:`scale(${O}) translate(${S.x/O}px, ${S.y/O}px)`,transition:R?"none":"transform 0.2s ease"},draggable:!1})}),(0,eK.jsxs)("button",{className:"lightbox-download",onClick:H,children:[(0,eK.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,eK.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,eK.jsx)("polyline",{points:"7 10 12 15 17 10"}),(0,eK.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Download Image"]})]})})]})}],13292)},95187,e=>{e.n(e.i(13292))}]);